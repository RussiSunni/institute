import{_ as w,u as g,P as x,G as f,l as v,T as P,r as I,o as p,c as m,b as h,a as k,F as _,p as T,d as b,e as A,f as u,g as $}from"./main-5c2316d7.js";import{u as B}from"./SkillTreeStore-6d68f2c0.js";import{S as E}from"./SkillPanel-894fcdaf.js";import"./transform-9f729428.js";import{h as F}from"./pixi_viewport-2e17a743.js";import{h as L}from"./index-0536990b.js";import{t as M}from"./tree-6e85cfa8.js";import{a as N}from"./link-afe1ff0a.js";const G={setup(){const e=g(),s=B();return{userDetailsStore:e,skillTreeStore:s}},data(){return{width:800,height:600,skill:{id:null,children:[],isMastered:null,isUnlocked:null,name:null},tree:{},root:{},isSkillInfoPanelShown:!1}},components:{SkillPanel:E},async mounted(){this.skillTreeStore.userSkills.length==0&&await this.skillTreeStore.getUserSkills(),this.skill={name:"SKILLS",sprite:null,children:this.skillTreeStore.userSkills};const e=new F({screenWidth:this.width,screenHeight:this.height,worldWidth:this.width,worldHeight:this.height,events:this.$pixiApp.renderer.events});this.$pixiApp.stage.addChild(e),e.center=new x(100,0),e.setZoom(.1),e.drag({wheelScroll:2,factor:2}).pinch({percent:2,factor:2}).wheel().decelerate().clampZoom({minScale:.001,maxScale:10}),document.querySelector("#skilltree").appendChild(this.$pixiApp.view),this.getAlgorithm()},methods:{getAlgorithm(){var e=[];e=JSON.parse(JSON.stringify(this.skill.children));function s(t){for(var i=t.length;i--;){if(t[i].type=="super"&&t[i].position!="end"){var a=[],d=[];for(let r=0;r<t[i].children.length;r++)t[i].children[r].type=="sub"?a.push(t[i].children[r]):d.push(t[i].children[r]);var S={skill_name:t[i].skill_name,type:"super",position:"end",children:a};t[i].children=[],t[i].children.push(S);for(let r=0;r<d.length;r++)t[i].children.push(d[r])}typeof t[i]<"u"&&t[i].children&&Array.isArray(t[i].children)&&t[i].children.length>0&&s(t[i].children)}}s(e);var l={skill_name:"My skills",children:e};const o=8e3;this.root=L(l);const n=35,c=o/(this.root.height+1);this.tree=M().nodeSize([n,c]),this.tree(this.root),this.drawTree()},drawTree(){var e=this.root.descendants();const s=this.root.links();for(const l of s)this.drawLink(l);for(const l of e)this.drawNode(l)},drawNode(e){const s=new f;s.lineStyle(0),s.beginFill(0,1),s.drawCircle(e.y,e.x,15),s.endFill(),this.$pixiApp.stage.children[0].addChild(s),s.eventMode="static",s.cursor="pointer",s.on("pointerdown",n=>{var c={id:e.data.id,isMastered:e.data.is_mastered,isUnlocked:e.data.is_accessible,name:e.data.skill_name};this.skill=c,this.isSkillInfoPanelShown||this.showInfoPanel()});const l=new v({fontFamily:"Arial",fontSize:12,fill:"#000",stroke:"#fff",strokeThickness:3}),o=new P(e.data.skill_name,l);o.anchor.set(0,.5),o.x=e.y+10,o.y=e.x,this.$pixiApp.stage.children[0].addChild(o)},drawLink(e){var l=N().x(d=>d.y).y(d=>d.x)(e),o=l.substring(l.indexOf("M")+1,l.lastIndexOf("C"));const n=o.split(",");var c=l.split("C")[1],t=c.split(",");const i=new f;var a;e.target.data.is_mastered==1?a=4:a=2,(e.source.data.type=="super"&&e.target.data.position=="end"||e.target.data.type=="sub")&&(a=1),i.lineStyle(a,0,1),i.position.x=n[0],i.position.y=n[1],i.bezierCurveTo(t[0]-n[0],t[1]-n[1],t[2]-n[0],t[3]-n[1],t[4]-n[0],t[5]-n[1]),this.$pixiApp.stage.children[0].addChild(i)},showInfoPanel(){this.isSkillInfoPanelShown||(this.isSkillInfoPanelShown=!0,screen.width>800?document.getElementById("skillInfoPanel").style.width="474px":document.getElementById("skillInfoPanel").style.height="474px")},hideInfoPanel(){this.isSkillInfoPanelShown&&(screen.width>800?document.getElementById("skillInfoPanel").style.width="0px":document.getElementById("skillInfoPanel").style.height="0px",document.getElementById("sidepanel-backdrop").style.display="none",this.isSkillInfoPanelShown=!1)}}},y=e=>(T("data-v-8c153652"),e=e(),b(),e),z={id:"wrapper"},D=y(()=>h("div",{id:"skilltree"},null,-1)),O=y(()=>h("div",{id:"sidepanel-backdrop"},null,-1));function U(e,s,l,o,n,c){const t=I("SkillPanel");return p(),m(_,null,[h("button",{id:"print-btn",class:"btn btn-info",onClick:s[0]||(s[0]=i=>e.printPDF())}," Print "),h("div",z,[k(t,{skill:n.skill},null,8,["skill"]),D,O])],64)}const V=w(G,[["render",U],["__scopeId","data-v-8c153652"]]);const W=h("div",{id:"purple-banner"},null,-1),H=h("span",null,"Loading...",-1),Y={__name:"PixiTidyTreeView",setup(e){return(s,l)=>(p(),m(_,null,[W,(p(),A($,null,{default:u(()=>[k(V)]),fallback:u(()=>[H]),_:1}))],64))}};export{Y as default};
