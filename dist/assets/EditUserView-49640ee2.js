import{u as f}from"./UsersStore-03aa775a.js";import{u as _}from"./InstructorStudentsStore-7033ae43.js";import{_ as p,o as l,c as a,a as s,t as c,w as n,l as d,C as h,F as g,r as v,n as b,j as S}from"./main-b39c1666.js";const I={setup(){const t=f(),e=_();return{usersStore:t,instructorStudentsStore:e}},data(){return{userId:this.$route.params.id,user:{},image:"",instructors:[],instructorId:null}},async mounted(){this.usersStore.users.length<1&&await this.usersStore.getUsers(),this.instructorStudentsStore.instructorStudentsList.length==0&&await this.instructorStudentsStore.getInstructorStudentsList(),this.getInstructors()},methods:{getUser(){fetch("/users/show/"+this.userId).then(function(t){return t.json()}).then(t=>this.user=t).then(()=>{this.image=this.user.avatar})},getInstructors(){for(let t=0;t<this.usersStore.users.length;t++)this.usersStore.users[t].role=="instructor"&&this.instructors.push(this.usersStore.users[t]);for(let t=0;t<this.instructorStudentsStore.instructorStudentsList.length;t++)this.instructorStudentsStore.instructorStudentsList[t].student_id==this.userId&&(this.instructorId=this.instructorStudentsStore.instructorStudentsList[t].instructor_id);this.getUser()},ValidateForm(){this.user.first_name==""||this.user.first_name==null?alert("Please add a first name."):this.user.last_name==""||this.user.last_name==null?alert("Please add a last name."):this.user.username==""||this.user.username==null?alert("Please add a username."):this.user.email==""||this.user.email==null?alert("Please add an email address."):this.Submit()},ValidateEmail(){/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/.test(this.user.email)||alert("Please enter a valid email address")},Submit(){const t={method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({firstname:this.user.first_name,lastname:this.user.last_name,username:this.user.username,email:this.user.email,avatar:this.user.avatar,role:this.user.role,password:this.user.password})};var e="/users/"+this.userId+"/edit";fetch(e,t).then(()=>{if(this.user.role=="student"){const m={method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({instructor_id:this.instructorId})};var u="/users/"+this.userId+"/edit/instructor";fetch(u,m)}}).then(()=>{this.$router.push("/users")})},onFileChange(t){var e=t.target.files||t.dataTransfer.files;e.length&&this.createImage(e[0])},createImage(t){new Image;var e=new FileReader,u=this;e.onload=m=>{u.image=m.target.result,this.image=m.target.result,this.user.avatar=this.image},e.readAsDataURL(t)},removeImage:function(t){this.image="",this.user.avatar=this.image}}},w={class:"container mt-3"},y=s("h1",null,"Edit User",-1),U={class:"mb-3"},V={for:"firstname",class:"form-label"},k={class:"mb-3"},x=s("label",{for:"lastname",class:"form-label"},"Last name",-1),C={class:"mb-3"},F=s("label",{class:"form-label"},"Username",-1),E={class:"mb-3"},L=s("label",{class:"form-label"},"Email address",-1),P={class:"mb-3 row"},T=s("label",{for:"avatar",class:"form-label"},"Avatar",-1),B={key:0},N=s("p",{style:{"font-size":"14px"}},[s("em",null,"Maximum file size 15mb")],-1),j={key:1},O=["src"],R={class:"mb-3"},D=s("label",{class:"form-label"},"Role",-1),M=s("option",{value:"admin"},"admin",-1),q=s("option",{value:"instructor"},"instructor",-1),z=s("option",{value:"student"},"student",-1),A=[M,q,z],J={key:0,class:"mb-3"},G=s("label",{class:"form-label"},"Instructor",-1),H=["value"],K={class:"mb-3"},Q=s("label",{class:"form-label"},"Password",-1);function W(t,e,u,m,i,o){return l(),a("div",w,[y,s("div",U,[s("label",V,"First name "+c(t.firstName),1),n(s("input",{"onUpdate:modelValue":e[0]||(e[0]=r=>i.user.first_name=r),type:"text",class:"form-control"},null,512),[[d,i.user.first_name]])]),s("div",k,[x,n(s("input",{"onUpdate:modelValue":e[1]||(e[1]=r=>i.user.last_name=r),type:"text",class:"form-control"},null,512),[[d,i.user.last_name]])]),s("div",C,[F,n(s("input",{"onUpdate:modelValue":e[2]||(e[2]=r=>i.user.username=r),type:"text",class:"form-control"},null,512),[[d,i.user.username]])]),s("div",E,[L,n(s("input",{"onUpdate:modelValue":e[3]||(e[3]=r=>i.user.email=r),type:"email",class:"form-control",onBlur:e[4]||(e[4]=(...r)=>o.ValidateEmail&&o.ValidateEmail(...r))},null,544),[[d,i.user.email]])]),s("div",P,[T,i.image?(l(),a("div",j,[s("p",null,[s("img",{src:i.image,height:"200",style:{"background-color":"lightgrey"}},null,8,O)]),s("p",null,[s("button",{class:"btn btn-warning",onClick:e[6]||(e[6]=(...r)=>o.removeImage&&o.removeImage(...r))},"Remove image")])])):(l(),a("div",B,[s("input",{class:"form-control",type:"file",accept:"image/*",onChange:e[5]||(e[5]=(...r)=>o.onFileChange&&o.onFileChange(...r))},null,32),N]))]),s("div",R,[D,n(s("select",{"onUpdate:modelValue":e[7]||(e[7]=r=>i.user.role=r),class:"form-select"},A,512),[[h,i.user.role]])]),i.user.role=="student"?(l(),a("div",J,[G,n(s("select",{"onUpdate:modelValue":e[8]||(e[8]=r=>i.instructorId=r),class:"form-select"},[(l(!0),a(g,null,v(i.instructors,r=>(l(),a("option",{value:r.id},c(r.username),9,H))),256))],512),[[h,i.instructorId]])])):b("",!0),s("div",K,[Q,n(s("input",{"onUpdate:modelValue":e[9]||(e[9]=r=>i.user.password=r),type:"text",class:"form-control"},null,512),[[d,i.user.password]])]),s("button",{class:"btn btn-dark",onClick:e[10]||(e[10]=r=>o.ValidateForm())},"Submit")])}const X=p(I,[["render",W]]),ss={__name:"EditUserView",setup(t){return(e,u)=>(l(),S(X))}};export{ss as default};
