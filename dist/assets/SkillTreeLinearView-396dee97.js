import{_ as b,u as L,S as N,r as j,o as k,c as y,b as p,a as w,p as z,d as I,e as R,f as v,g as U,F as $}from"./main-8ebb6752.js";import{u as B}from"./SkillTreeStore-e92b9010.js";import{u as F,S as P,h as A,t as M}from"./transform-aee16665.js";import{S as O}from"./fontfaceobserver.standalone-4ac10533.js";import{c as D,a as H,z as q,s as E}from"./zoom-52dce2f4.js";function V(t,s){return t==null||s==null?NaN:t<s?-1:t>s?1:t>=s?0:NaN}const J={setup(){const t=L(),s=B(),o=F();return{userDetailsStore:t,skillTreeStore:s,skillTagsStore:o}},data(){return{stageContents:[],isSkillInfoPanelShown:!1,regularLockedUnmasteredNodeSprite:null,radius:0,width:null,height:null,radiusMultiplier:64,firstLevelNodeSize:100,regularNodeSize:50,subSkillRadius:50,skill:{id:null,children:[],isMastered:null,isUnlocked:null,container:null,name:null,description:null,tagIDs:[],sprite:null},isRecentered:!1,svg:null}},components:{SkillTreeFilter:P,SkillPanel:O},async mounted(){this.skillTreeStore.userSkills.length==0&&await this.skillTreeStore.getUserSkills(),this.width=window.innerWidth,this.height=window.innerHeight,this.radius=Math.min(this.width,this.height)/2;const t=N.from("center-node.png");this.skill={name:"SKILLS",sprite:t,children:this.skillTreeStore.userSkills},this.getAlgorithm()},methods:{getAlgorithm(){var t=[];t=JSON.parse(JSON.stringify(this.skill.children));function s(e){for(var i=e.length;i--;){if(e[i].type=="super"&&e[i].position!="end"){var m=[],g=[];for(let a=0;a<e[i].children.length;a++)e[i].children[a].type=="sub"?m.push(e[i].children[a]):g.push(e[i].children[a]);var T={skill_name:e[i].skill_name,type:"super",position:"end",children:m};e[i].children=[],e[i].children.push(T);for(let a=0;a<g.length;a++)e[i].children.push(g[a])}typeof e[i]<"u"&&e[i].children&&Array.isArray(e[i].children)&&e[i].children.length>0&&s(e[i].children)}}s(t);var o={name:null,children:t};const c=8e3,r=A(o),d=30,u=c/(r.height+1),l=M().nodeSize([d,u]);r.sort((e,i)=>V(e.data.name,i.data.name)),l(r);let n=1/0,h=-n;r.each(e=>{e.x>h&&(h=e.x),e.x<n&&(n=e.x)});const f=h-n+d*2;this.svg=D("svg").attr("id","linearTree").attr("width",c).attr("height",f).attr("viewBox",[-u/3,n-d,c,f]).attr("style","max-width: 100%; height: auto; font: 10px sans-serif;");const _=this.svg.append("g");_.append("g").attr("fill","none").attr("stroke-opacity",1).selectAll().data(r.links()).join("path").attr("d",H().x(e=>e.y).y(e=>e.x)).attr("stroke",function(e){return e.target.data.position=="end"?"#FF0000":"#000"}).attr("stroke-width",function(e){return e.target.data.position=="end"?4:e.target.data.is_mastered==1?8:1.5});const S=_.append("g").attr("stroke-linejoin","round").attr("stroke-width",3).selectAll().data(r.descendants()).join("g").attr("transform",e=>`translate(${e.y},${e.x})`);S.append("circle").attr("fill",e=>e.children?"#555":"#000").attr("r",2.5),S.append("text").attr("dy","0.31em").attr("x",e=>e.children?-6:6).attr("text-anchor",e=>e.children?"end":"start").text(e=>e.data.skill_name).clone(!0).lower().attr("stroke",function(e){return e.data.position=="end"?"red":"white"}),this.svg.call(q().extent([[0,0],[this.width,this.height]]).scaleExtent([.1,20]).on("zoom",x));function x({transform:e}){_.attr("transform",e)}document.querySelector("#skilltree").append(this.svg.node())},printPDF(){var t=document.getElementById("linearTree"),s=E(t),o=s.node(),c=new XMLSerializer,r=c.serializeToString(o),d={svg:r,treeType:"linear"},u=JSON.stringify(d),l=new XMLHttpRequest;l.responseType="arraybuffer",l.open("POST","/skilltree/print-pdf",!0),l.setRequestHeader("Content-type","application/json;charset=UTF-8"),l.setRequestHeader("Accept","application/json, text/plain, */*"),l.send(u),l.onload=function(){if(this.readyState==4&&this.status==200){let h=new Blob([l.response],{type:"application/pdf"});const f=window.URL.createObjectURL(h);var n=document.createElement("a");document.body.appendChild(n),n.style="display: none",n.href=f,n.download="My-Skill-Tree.pdf",n.click(),window.URL.revokeObjectURL(f)}}}}},W=t=>(z("data-v-5c3319d9"),t=t(),I(),t),X={class:"flex-container skill-tree-container"},K={id:"wrapper"},G={id:"skilltree"},Q=W(()=>p("div",{id:"sidepanel-backdrop"},null,-1));function Y(t,s,o,c,r,d){const u=j("SkillPanel");return k(),y("div",X,[p("button",{id:"print-btn",class:"btn btn-info",onClick:s[0]||(s[0]=l=>d.printPDF())}," Print "),p("div",K,[p("div",G,[w(u,{skill:r.skill},null,8,["skill"])]),Q])])}const Z=b(J,[["render",Y],["__scopeId","data-v-5c3319d9"]]);const C=p("div",{id:"purple-banner"},null,-1),ee=p("span",null,"Loading...",-1),le={__name:"SkillTreeLinearView",setup(t){return(s,o)=>(k(),y($,null,[C,(k(),R(U,null,{default:v(()=>[w(Z)]),fallback:v(()=>[ee]),_:1}))],64))}};export{le as default};
