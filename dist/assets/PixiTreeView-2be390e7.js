import{j as w,_ as v,u as x,k as T,S as b,l as g,m,n as r,C as I,T as P,q as L,G as N,s as $,x as M,y as z,e as B,o as p,c as _,a as h,h as y,F as S,p as C,b as j,f as E,g as k,z as R}from"./main-57f5b5f9.js";import"./fontfaceobserver.standalone-0001e4a0.js";w("skillTags",{state:()=>({skillTagsList:[]}),actions:{async getSkillTagsList(){const i=await(await fetch("/skill-tags/list")).json();this.skillTagsList=i}}});const A={setup(){const e=x(),i=T();return{userDetailsStore:e,skillTreeStore:i}},data(){return{width:null,height:null,skill:{id:null,children:[],isMastered:null,isUnlocked:null,name:null},tree:{},root:{},isSkillInfoPanelShown:!1,dx:null,dy:null,data:{},radius:0,radiusMultiplier:256,firstLevelNodeSize:500,secondLevelNodeSize:100,regularNodeSize:50,subSkillRadius:50}},components:{SkillPanel:b},created(){this.$radialTreeContainer.visible=!0,this.$tidyTreeContainer.visible=!1,this.$pixiApp.renderer.background.color=0},async mounted(){this.skillTreeStore.userSkills.length==0&&await this.skillTreeStore.getUserSkills(),this.$radialTreeContainer.children.length==0&&(this.width=window.innerWidth,this.height=window.innerHeight,this.radius=Math.min(this.width,this.height)/2-30,this.skill={name:"SKILLS",sprite:null,children:this.skillTreeStore.userSkills},this.getAlgorithm()),document.querySelector("#skilltree").appendChild(this.$pixiApp.view)},methods:{getAlgorithm(){var e=[];e=JSON.parse(JSON.stringify(this.skill.children));function i(a){for(var l=a.length;l--;)a[l].type=="sub"&&a.splice(l,1),typeof a[l]<"u"&&a[l].children&&Array.isArray(a[l].children)&&a[l].children.length>0&&i(a[l].children)}i(e),this.data={skill_name:"My skills",children:e};const t=g().size([2*Math.PI,this.radius*this.radiusMultiplier]).separation((a,l)=>(a.parent==l.parent?1:2)/a.depth);this.root=t(m(this.data)),this.drawTree()},drawTree(){const e=r.from("center-node.png");e.x=this.root.x,e.y=this.root.y,e.anchor.set(.5),this.$radialTreeContainer.addChild(e);const i=this.root.descendants(),t=this.root.links();for(const a of t)this.drawLink(a);for(const a of i)this.drawNode(a)},drawNode(e){let i=new I;i.x=Math.cos(e.x)*e.y,i.y=Math.sin(e.x)*e.y,this.$radialTreeContainer.addChild(i);var t=new r;e.data.level=="grade_school"?e.data.is_mastered?t=r.from("images/skill-tree-nodes/grade-school-mastered.png"):e.data.is_accessible?t=r.from("images/skill-tree-nodes/grade-school-unlocked.png"):t=r.from("images/skill-tree-nodes/grade-school-locked.png"):e.data.level=="middle_school"?e.data.is_mastered?t=r.from("images/skill-tree-nodes/middle-school-mastered.png"):e.data.is_accessible?t=r.from("images/skill-tree-nodes/middle-school-unlocked.png"):t=r.from("images/skill-tree-nodes/middle-school-locked.png"):e.data.level=="high_school"?e.data.is_mastered?t=r.from("images/skill-tree-nodes/high-school-mastered.png"):e.data.is_accessible?t=r.from("images/skill-tree-nodes/middle-school-unlocked.png"):t=r.from("images/skill-tree-nodes/middle-school-locked.png"):e.data.level=="college"?e.data.is_mastered?t=r.from("images/skill-tree-nodes/college-mastered.png"):e.data.is_accessible?t=r.from("images/skill-tree-nodes/middle-school-unlocked.png"):t=r.from("images/skill-tree-nodes/middle-school-locked.png"):e.data.level=="phd"?e.data.is_mastered?t=r.from("images/skill-tree-nodes/phd-mastered.png"):e.data.is_accessible?t=r.from("images/skill-tree-nodes/middle-school-unlocked.png"):t=r.from("images/skill-tree-nodes/middle-school-locked.png"):e.data.level=="domain"&&(t=r.from("images/skill-tree-nodes/domain.png")),t.anchor.set(.5),e.depth==1?(t.width=this.firstLevelNodeSize,t.height=this.firstLevelNodeSize):e.depth==2?(t.width=this.secondLevelNodeSize,t.height=this.secondLevelNodeSize):(t.width=this.regularNodeSize,t.height=this.regularNodeSize),i.addChild(t),t.eventMode="static",t.cursor="pointer",t.on("pointerdown",n=>{var c={id:e.data.id,isMastered:e.data.is_mastered,isUnlocked:e.data.is_accessible,name:e.data.skill_name};this.skill=c,this.isSkillInfoPanelShown||this.showInfoPanel()});let a,l;e.depth==0?(a=200,l="#000000"):e.depth==1?(a=100,l="#ffffff"):(a=50,l="#ffffff");const o=new P({fontFamily:"Poppins900",fontSize:a,fill:l,align:"center"}),d=new L(e.data.skill_name,o);d.anchor.set(.5),d.scale.set(.5,.5),i.addChild(d)},drawLink(e){const i=new N;e.target.data.is_mastered=="1"?i.lineStyle(16,16777215,1):i.lineStyle(2,16777215,1);var t=Math.cos(e.source.x)*e.source.y,a=Math.sin(e.source.x)*e.source.y;i.moveTo(t,a);var l=Math.cos(e.target.x)*e.target.y,o=Math.sin(e.target.x)*e.target.y;i.lineTo(l,o),this.$radialTreeContainer.addChild(i)},showInfoPanel(){this.isSkillInfoPanelShown||(this.isSkillInfoPanelShown=!0,screen.width>800?document.getElementById("skillInfoPanel").style.width="474px":document.getElementById("skillInfoPanel").style.height="474px",this.skill.isMastered=="1"?document.getElementById("mastery-checkbox").checked=!0:document.getElementById("mastery-checkbox").checked=!1)},hideInfoPanel(){this.isSkillInfoPanelShown&&(screen.width>800?document.getElementById("skillInfoPanel").style.width="0px":document.getElementById("skillInfoPanel").style.height="0px",document.getElementById("sidepanel-backdrop").style.display="none",this.isSkillInfoPanelShown=!1)},async printPDF(){await this.createSVGTree();var e=document.getElementById("linearTree"),i=$(e),t=i.node(),a=new XMLSerializer,l=a.serializeToString(t),o={svg:l,treeType:"linear"},d=JSON.stringify(o),n=new XMLHttpRequest;n.responseType="arraybuffer",n.open("POST","/skilltree/print-pdf",!0),n.setRequestHeader("Content-type","application/json;charset=UTF-8"),n.setRequestHeader("Accept","application/json, text/plain, */*"),n.send(d),n.onload=function(){if(this.readyState==4&&this.status==200){let f=new Blob([n.response],{type:"application/pdf"});const s=window.URL.createObjectURL(f);var c=document.createElement("a");document.body.appendChild(c),c.style="display: none",c.href=s,c.download="My-Skill-Tree.pdf",c.click(),window.URL.revokeObjectURL(s)}}},createSVGTree(){const e=m(this.data),i=15,t=this.width/(e.height+1);g().nodeSize([i,t])(e);let l=1/0,o=-l;e.each(s=>{s.x>o&&(o=s.x),s.x<l&&(l=s.x)});const d=o-l+this.dx*2;let n=M("svg").attr("id","linearTree").attr("width",this.width).attr("height",d).attr("viewBox",[-t/3,l-i,this.width,d]).attr("style","max-width: 100%; height: auto; font: 10px sans-serif;");const c=n.append("g");c.append("g").attr("fill","none").attr("stroke-opacity",1).selectAll().data(e.links()).join("path").attr("d",z().x(s=>s.y).y(s=>s.x)).attr("stroke",function(s){return"#000"}).attr("stroke-width",function(s){return s.target.data.is_mastered==1?8:1.5}).style("stroke-dasharray",function(s){if(s.source.data.type=="super"&&s.target.data.position=="end"||s.target.data.type=="sub")return 5});const f=c.append("g").attr("stroke-linejoin","round").attr("stroke-width",3).selectAll().data(e.descendants()).join("g").attr("transform",s=>`translate(${s.y},${s.x})`);f.append("circle").attr("fill",s=>s.children?"#555":"#000").attr("r",2.5),f.append("text").style("font-weight",function(s){return s.data.type=="super"?"700":"400"}).style("font-style",function(s){if(s.data.type=="sub")return"italic"}).attr("dy","0.31em").attr("x",s=>s.children?-6:6).attr("text-anchor",s=>s.children?"end":"start").text(function(s){return s.data.position=="end"?"":s.data.skill_name}).clone(!0).lower().attr("stroke",function(s){return"white"}),document.querySelector("#SVGskilltree").append(n.node())}}},u=e=>(C("data-v-83e8d9de"),e=e(),j(),e),U={id:"wrapper"},V=u(()=>h("div",{id:"skilltree"},null,-1)),F=u(()=>h("div",{id:"SVGskilltree"},null,-1)),G=u(()=>h("div",{id:"sidepanel-backdrop"},null,-1));function O(e,i,t,a,l,o){const d=B("SkillPanel");return p(),_(S,null,[h("button",{id:"print-btn",class:"btn btn-info",onClick:i[0]||(i[0]=n=>o.printPDF())}," Print "),h("div",U,[y(d,{skill:l.skill},null,8,["skill"]),V,F,G])],64)}const q=v(A,[["render",O],["__scopeId","data-v-83e8d9de"]]);const H=h("div",{id:"purple-banner"},null,-1),D=h("span",null,"Loading...",-1),Y={__name:"PixiTreeView",setup(e){return(i,t)=>(p(),_(S,null,[H,(p(),E(R,null,{default:k(()=>[y(q)]),fallback:k(()=>[D]),_:1}))],64))}};export{Y as default};
