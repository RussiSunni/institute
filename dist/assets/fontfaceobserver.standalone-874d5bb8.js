import{l as N,C as Q,R as _,P as w,m as G}from"./main-c7634075.js";var J=Object.defineProperty,$=(d,t,i)=>t in d?J(d,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):d[t]=i,o=(d,t,i)=>($(d,typeof t!="symbol"?t+"":t,i),i);class f{constructor(t){o(this,"parent"),o(this,"paused"),this.parent=t,this.paused=!1}destroy(){}down(t){return!1}move(t){return!1}up(t){return!1}wheel(t){return!1}update(t){}resize(){}reset(){}pause(){this.paused=!0}resume(){this.paused=!1}}var tt=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},q={exports:{}};(function(d,t){(function(){var i,s;s=function(e){return d.exports=e},i={linear:function(e,n,h,r){return h*e/r+n},easeInQuad:function(e,n,h,r){return h*(e/=r)*e+n},easeOutQuad:function(e,n,h,r){return-h*(e/=r)*(e-2)+n},easeInOutQuad:function(e,n,h,r){return(e/=r/2)<1?h/2*e*e+n:-h/2*(--e*(e-2)-1)+n},easeInCubic:function(e,n,h,r){return h*(e/=r)*e*e+n},easeOutCubic:function(e,n,h,r){return h*((e=e/r-1)*e*e+1)+n},easeInOutCubic:function(e,n,h,r){return(e/=r/2)<1?h/2*e*e*e+n:h/2*((e-=2)*e*e+2)+n},easeInQuart:function(e,n,h,r){return h*(e/=r)*e*e*e+n},easeOutQuart:function(e,n,h,r){return-h*((e=e/r-1)*e*e*e-1)+n},easeInOutQuart:function(e,n,h,r){return(e/=r/2)<1?h/2*e*e*e*e+n:-h/2*((e-=2)*e*e*e-2)+n},easeInQuint:function(e,n,h,r){return h*(e/=r)*e*e*e*e+n},easeOutQuint:function(e,n,h,r){return h*((e=e/r-1)*e*e*e*e+1)+n},easeInOutQuint:function(e,n,h,r){return(e/=r/2)<1?h/2*e*e*e*e*e+n:h/2*((e-=2)*e*e*e*e+2)+n},easeInSine:function(e,n,h,r){return-h*Math.cos(e/r*(Math.PI/2))+h+n},easeOutSine:function(e,n,h,r){return h*Math.sin(e/r*(Math.PI/2))+n},easeInOutSine:function(e,n,h,r){return-h/2*(Math.cos(Math.PI*e/r)-1)+n},easeInExpo:function(e,n,h,r){return e===0?n:h*Math.pow(2,10*(e/r-1))+n},easeOutExpo:function(e,n,h,r){return e===r?n+h:h*(-Math.pow(2,-10*e/r)+1)+n},easeInOutExpo:function(e,n,h,r){return(e/=r/2)<1?h/2*Math.pow(2,10*(e-1))+n:h/2*(-Math.pow(2,-10*--e)+2)+n},easeInCirc:function(e,n,h,r){return-h*(Math.sqrt(1-(e/=r)*e)-1)+n},easeOutCirc:function(e,n,h,r){return h*Math.sqrt(1-(e=e/r-1)*e)+n},easeInOutCirc:function(e,n,h,r){return(e/=r/2)<1?-h/2*(Math.sqrt(1-e*e)-1)+n:h/2*(Math.sqrt(1-(e-=2)*e)+1)+n},easeInElastic:function(e,n,h,r){var a,p,c;return c=1.70158,p=0,a=h,e===0||(e/=r),p||(p=r*.3),a<Math.abs(h)?(a=h,c=p/4):c=p/(2*Math.PI)*Math.asin(h/a),-(a*Math.pow(2,10*(e-=1))*Math.sin((e*r-c)*(2*Math.PI)/p))+n},easeOutElastic:function(e,n,h,r){var a,p,c;return c=1.70158,p=0,a=h,e===0||(e/=r),p||(p=r*.3),a<Math.abs(h)?(a=h,c=p/4):c=p/(2*Math.PI)*Math.asin(h/a),a*Math.pow(2,-10*e)*Math.sin((e*r-c)*(2*Math.PI)/p)+h+n},easeInOutElastic:function(e,n,h,r){var a,p,c;return c=1.70158,p=0,a=h,e===0||(e/=r/2),p||(p=r*(.3*1.5)),a<Math.abs(h)?(a=h,c=p/4):c=p/(2*Math.PI)*Math.asin(h/a),e<1?-.5*(a*Math.pow(2,10*(e-=1))*Math.sin((e*r-c)*(2*Math.PI)/p))+n:a*Math.pow(2,-10*(e-=1))*Math.sin((e*r-c)*(2*Math.PI)/p)*.5+h+n},easeInBack:function(e,n,h,r,a){return a===void 0&&(a=1.70158),h*(e/=r)*e*((a+1)*e-a)+n},easeOutBack:function(e,n,h,r,a){return a===void 0&&(a=1.70158),h*((e=e/r-1)*e*((a+1)*e+a)+1)+n},easeInOutBack:function(e,n,h,r,a){return a===void 0&&(a=1.70158),(e/=r/2)<1?h/2*(e*e*(((a*=1.525)+1)*e-a))+n:h/2*((e-=2)*e*(((a*=1.525)+1)*e+a)+2)+n},easeInBounce:function(e,n,h,r){var a;return a=i.easeOutBounce(r-e,0,h,r),h-a+n},easeOutBounce:function(e,n,h,r){return(e/=r)<1/2.75?h*(7.5625*e*e)+n:e<2/2.75?h*(7.5625*(e-=1.5/2.75)*e+.75)+n:e<2.5/2.75?h*(7.5625*(e-=2.25/2.75)*e+.9375)+n:h*(7.5625*(e-=2.625/2.75)*e+.984375)+n},easeInOutBounce:function(e,n,h,r){var a;return e<r/2?(a=i.easeInBounce(e*2,0,h,r),a*.5+n):(a=i.easeOutBounce(e*2-r,0,h,r),a*.5+h*.5+n)}},s(i)}).call(tt)})(q);const U=q.exports;function V(d,t){if(d){if(typeof d=="function")return d;if(typeof d=="string")return U[d]}else return U[t]}const et={removeOnInterrupt:!1,ease:"linear",time:1e3};class it extends f{constructor(t,i={}){super(t),o(this,"options"),o(this,"startX"),o(this,"startY"),o(this,"deltaX"),o(this,"deltaY"),o(this,"keepCenter"),o(this,"startWidth",null),o(this,"startHeight",null),o(this,"deltaWidth",null),o(this,"deltaHeight",null),o(this,"width",null),o(this,"height",null),o(this,"time",0),this.options=Object.assign({},et,i),this.options.ease=V(this.options.ease),this.setupPosition(),this.setupZoom(),this.time=0}setupPosition(){typeof this.options.position<"u"?(this.startX=this.parent.center.x,this.startY=this.parent.center.y,this.deltaX=this.options.position.x-this.parent.center.x,this.deltaY=this.options.position.y-this.parent.center.y,this.keepCenter=!1):this.keepCenter=!0}setupZoom(){this.width=null,this.height=null,typeof this.options.scale<"u"?this.width=this.parent.screenWidth/this.options.scale:typeof this.options.scaleX<"u"||typeof this.options.scaleY<"u"?(typeof this.options.scaleX<"u"&&(this.width=this.parent.screenWidth/this.options.scaleX),typeof this.options.scaleY<"u"&&(this.height=this.parent.screenHeight/this.options.scaleY)):(typeof this.options.width<"u"&&(this.width=this.options.width),typeof this.options.height<"u"&&(this.height=this.options.height)),this.width!==null&&(this.startWidth=this.parent.screenWidthInWorldPixels,this.deltaWidth=this.width-this.startWidth),this.height!==null&&(this.startHeight=this.parent.screenHeightInWorldPixels,this.deltaHeight=this.height-this.startHeight)}down(){return this.options.removeOnInterrupt&&this.parent.plugins.remove("animate"),!1}complete(){this.parent.plugins.remove("animate"),this.width!==null&&this.parent.fitWidth(this.width,this.keepCenter,this.height===null),this.height!==null&&this.parent.fitHeight(this.height,this.keepCenter,this.width===null),!this.keepCenter&&this.options.position&&this.parent.moveCenter(this.options.position),this.parent.emit("animate-end",this.parent),this.options.callbackOnComplete&&this.options.callbackOnComplete(this.parent)}update(t){if(this.paused)return;this.time+=t;const i=new w(this.parent.scale.x,this.parent.scale.y);if(this.time>=this.options.time){const s=this.parent.width,e=this.parent.height;this.complete(),(s!==this.parent.width||e!==this.parent.height)&&this.parent.emit("zoomed",{viewport:this.parent,original:i,type:"animate"})}else{const s=this.options.ease(this.time,0,1,this.options.time);if(this.width!==null){const e=this.startWidth,n=this.deltaWidth;this.parent.fitWidth(e+n*s,this.keepCenter,this.height===null)}if(this.height!==null){const e=this.startHeight,n=this.deltaHeight;this.parent.fitHeight(e+n*s,this.keepCenter,this.width===null)}if(this.width===null?this.parent.scale.x=this.parent.scale.y:this.height===null&&(this.parent.scale.y=this.parent.scale.x),!this.keepCenter){const e=this.startX,n=this.startY,h=this.deltaX,r=this.deltaY,a=new w(this.parent.x,this.parent.y);this.parent.moveCenter(e+h*s,n+r*s),this.parent.emit("moved",{viewport:this.parent,original:a,type:"animate"})}(this.width||this.height)&&this.parent.emit("zoomed",{viewport:this.parent,original:i,type:"animate"})}}}const st={sides:"all",friction:.5,time:150,ease:"easeInOutSine",underflow:"center",bounceBox:null};class nt extends f{constructor(t,i={}){super(t),o(this,"options"),o(this,"left"),o(this,"top"),o(this,"right"),o(this,"bottom"),o(this,"underflowX"),o(this,"underflowY"),o(this,"ease"),o(this,"toX"),o(this,"toY"),this.options=Object.assign({},st,i),this.ease=V(this.options.ease,"easeInOutSine"),this.options.sides?this.options.sides==="all"?this.top=this.bottom=this.left=this.right=!0:this.options.sides==="horizontal"?(this.right=this.left=!0,this.top=this.bottom=!1):this.options.sides==="vertical"?(this.left=this.right=!1,this.top=this.bottom=!0):(this.top=this.options.sides.indexOf("top")!==-1,this.bottom=this.options.sides.indexOf("bottom")!==-1,this.left=this.options.sides.indexOf("left")!==-1,this.right=this.options.sides.indexOf("right")!==-1):this.left=this.top=this.right=this.bottom=!1;const s=this.options.underflow.toLowerCase();s==="center"?(this.underflowX=0,this.underflowY=0):(this.underflowX=s.indexOf("left")!==-1?-1:s.indexOf("right")!==-1?1:0,this.underflowY=s.indexOf("top")!==-1?-1:s.indexOf("bottom")!==-1?1:0),this.reset()}isActive(){return this.toX!==null||this.toY!==null}down(){return this.toX=this.toY=null,!1}up(){return this.bounce(),!1}update(t){if(!this.paused){if(this.bounce(),this.toX){const i=this.toX;i.time+=t,this.parent.emit("moved",{viewport:this.parent,type:"bounce-x"}),i.time>=this.options.time?(this.parent.x=i.end,this.toX=null,this.parent.emit("bounce-x-end",this.parent)):this.parent.x=this.ease(i.time,i.start,i.delta,this.options.time)}if(this.toY){const i=this.toY;i.time+=t,this.parent.emit("moved",{viewport:this.parent,type:"bounce-y"}),i.time>=this.options.time?(this.parent.y=i.end,this.toY=null,this.parent.emit("bounce-y-end",this.parent)):this.parent.y=this.ease(i.time,i.start,i.delta,this.options.time)}}}calcUnderflowX(){let t;switch(this.underflowX){case-1:t=0;break;case 1:t=this.parent.screenWidth-this.parent.screenWorldWidth;break;default:t=(this.parent.screenWidth-this.parent.screenWorldWidth)/2}return t}calcUnderflowY(){let t;switch(this.underflowY){case-1:t=0;break;case 1:t=this.parent.screenHeight-this.parent.screenWorldHeight;break;default:t=(this.parent.screenHeight-this.parent.screenWorldHeight)/2}return t}oob(){const t=this.options.bounceBox;if(t){const i=typeof t.x>"u"?0:t.x,s=typeof t.y>"u"?0:t.y,e=typeof t.width>"u"?this.parent.worldWidth:t.width,n=typeof t.height>"u"?this.parent.worldHeight:t.height;return{left:this.parent.left<i,right:this.parent.right>e,top:this.parent.top<s,bottom:this.parent.bottom>n,topLeft:new w(i*this.parent.scale.x,s*this.parent.scale.y),bottomRight:new w(e*this.parent.scale.x-this.parent.screenWidth,n*this.parent.scale.y-this.parent.screenHeight)}}return{left:this.parent.left<0,right:this.parent.right>this.parent.worldWidth,top:this.parent.top<0,bottom:this.parent.bottom>this.parent.worldHeight,topLeft:new w(0,0),bottomRight:new w(this.parent.worldWidth*this.parent.scale.x-this.parent.screenWidth,this.parent.worldHeight*this.parent.scale.y-this.parent.screenHeight)}}bounce(){var t,i;if(this.paused)return;let s,e=this.parent.plugins.get("decelerate",!0);e&&(e.x||e.y)&&(e.x&&e.percentChangeX===((t=e.options)==null?void 0:t.friction)||e.y&&e.percentChangeY===((i=e.options)==null?void 0:i.friction))&&(s=this.oob(),(s.left&&this.left||s.right&&this.right)&&(e.percentChangeX=this.options.friction),(s.top&&this.top||s.bottom&&this.bottom)&&(e.percentChangeY=this.options.friction));const n=this.parent.plugins.get("drag",!0)||{},h=this.parent.plugins.get("pinch",!0)||{};if(e=e||{},!(n!=null&&n.active)&&!(h!=null&&h.active)&&(!this.toX||!this.toY)&&(!e.x||!e.y)){s=s||this.oob();const r=s.topLeft,a=s.bottomRight;if(!this.toX&&!e.x){let p=null;s.left&&this.left?p=this.parent.screenWorldWidth<this.parent.screenWidth?this.calcUnderflowX():-r.x:s.right&&this.right&&(p=this.parent.screenWorldWidth<this.parent.screenWidth?this.calcUnderflowX():-a.x),p!==null&&this.parent.x!==p&&(this.toX={time:0,start:this.parent.x,delta:p-this.parent.x,end:p},this.parent.emit("bounce-x-start",this.parent))}if(!this.toY&&!e.y){let p=null;s.top&&this.top?p=this.parent.screenWorldHeight<this.parent.screenHeight?this.calcUnderflowY():-r.y:s.bottom&&this.bottom&&(p=this.parent.screenWorldHeight<this.parent.screenHeight?this.calcUnderflowY():-a.y),p!==null&&this.parent.y!==p&&(this.toY={time:0,start:this.parent.y,delta:p-this.parent.y,end:p},this.parent.emit("bounce-y-start",this.parent))}}}reset(){this.toX=this.toY=null,this.bounce()}}const ht={left:!1,right:!1,top:!1,bottom:!1,direction:null,underflow:"center"};class ot extends f{constructor(t,i={}){super(t),o(this,"options"),o(this,"last"),o(this,"noUnderflow"),o(this,"underflowX"),o(this,"underflowY"),this.options=Object.assign({},ht,i),this.options.direction&&(this.options.left=this.options.direction==="x"||this.options.direction==="all"?!0:null,this.options.right=this.options.direction==="x"||this.options.direction==="all"?!0:null,this.options.top=this.options.direction==="y"||this.options.direction==="all"?!0:null,this.options.bottom=this.options.direction==="y"||this.options.direction==="all"?!0:null),this.parseUnderflow(),this.last={x:null,y:null,scaleX:null,scaleY:null},this.update()}parseUnderflow(){const t=this.options.underflow.toLowerCase();t==="none"?this.noUnderflow=!0:t==="center"?(this.underflowX=this.underflowY=0,this.noUnderflow=!1):(this.underflowX=t.indexOf("left")!==-1?-1:t.indexOf("right")!==-1?1:0,this.underflowY=t.indexOf("top")!==-1?-1:t.indexOf("bottom")!==-1?1:0,this.noUnderflow=!1)}move(){return this.update(),!1}update(){if(this.paused||this.parent.x===this.last.x&&this.parent.y===this.last.y&&this.parent.scale.x===this.last.scaleX&&this.parent.scale.y===this.last.scaleY)return;const t=new w(this.parent.x,this.parent.y),i=this.parent.plugins.decelerate||{};if(this.options.left!==null||this.options.right!==null){let s=!1;if(!this.noUnderflow&&this.parent.screenWorldWidth<this.parent.screenWidth)switch(this.underflowX){case-1:this.parent.x!==0&&(this.parent.x=0,s=!0);break;case 1:this.parent.x!==this.parent.screenWidth-this.parent.screenWorldWidth&&(this.parent.x=this.parent.screenWidth-this.parent.screenWorldWidth,s=!0);break;default:this.parent.x!==(this.parent.screenWidth-this.parent.screenWorldWidth)/2&&(this.parent.x=(this.parent.screenWidth-this.parent.screenWorldWidth)/2,s=!0)}else this.options.left!==null&&this.parent.left<(this.options.left===!0?0:this.options.left)&&(this.parent.x=-(this.options.left===!0?0:this.options.left)*this.parent.scale.x,i.x=0,s=!0),this.options.right!==null&&this.parent.right>(this.options.right===!0?this.parent.worldWidth:this.options.right)&&(this.parent.x=-(this.options.right===!0?this.parent.worldWidth:this.options.right)*this.parent.scale.x+this.parent.screenWidth,i.x=0,s=!0);s&&this.parent.emit("moved",{viewport:this.parent,original:t,type:"clamp-x"})}if(this.options.top!==null||this.options.bottom!==null){let s=!1;if(!this.noUnderflow&&this.parent.screenWorldHeight<this.parent.screenHeight)switch(this.underflowY){case-1:this.parent.y!==0&&(this.parent.y=0,s=!0);break;case 1:this.parent.y!==this.parent.screenHeight-this.parent.screenWorldHeight&&(this.parent.y=this.parent.screenHeight-this.parent.screenWorldHeight,s=!0);break;default:this.parent.y!==(this.parent.screenHeight-this.parent.screenWorldHeight)/2&&(this.parent.y=(this.parent.screenHeight-this.parent.screenWorldHeight)/2,s=!0)}else this.options.top!==null&&this.parent.top<(this.options.top===!0?0:this.options.top)&&(this.parent.y=-(this.options.top===!0?0:this.options.top)*this.parent.scale.y,i.y=0,s=!0),this.options.bottom!==null&&this.parent.bottom>(this.options.bottom===!0?this.parent.worldHeight:this.options.bottom)&&(this.parent.y=-(this.options.bottom===!0?this.parent.worldHeight:this.options.bottom)*this.parent.scale.y+this.parent.screenHeight,i.y=0,s=!0);s&&this.parent.emit("moved",{viewport:this.parent,original:t,type:"clamp-y"})}this.last.x=this.parent.x,this.last.y=this.parent.y,this.last.scaleX=this.parent.scale.x,this.last.scaleY=this.parent.scale.y}reset(){this.update()}}const rt={minWidth:null,minHeight:null,maxWidth:null,maxHeight:null,minScale:null,maxScale:null};class at extends f{constructor(t,i={}){super(t),o(this,"options"),this.options=Object.assign({},rt,i),this.clamp()}resize(){this.clamp()}clamp(){if(!this.paused){if(this.options.minWidth||this.options.minHeight||this.options.maxWidth||this.options.maxHeight){let t=this.parent.worldScreenWidth,i=this.parent.worldScreenHeight;if(this.options.minWidth!==null&&t<this.options.minWidth){const s=this.parent.scale.x;this.parent.fitWidth(this.options.minWidth,!1,!1,!0),this.parent.scale.y*=this.parent.scale.x/s,t=this.parent.worldScreenWidth,i=this.parent.worldScreenHeight,this.parent.emit("zoomed",{viewport:this.parent,type:"clamp-zoom"})}if(this.options.maxWidth!==null&&t>this.options.maxWidth){const s=this.parent.scale.x;this.parent.fitWidth(this.options.maxWidth,!1,!1,!0),this.parent.scale.y*=this.parent.scale.x/s,t=this.parent.worldScreenWidth,i=this.parent.worldScreenHeight,this.parent.emit("zoomed",{viewport:this.parent,type:"clamp-zoom"})}if(this.options.minHeight!==null&&i<this.options.minHeight){const s=this.parent.scale.y;this.parent.fitHeight(this.options.minHeight,!1,!1,!0),this.parent.scale.x*=this.parent.scale.y/s,t=this.parent.worldScreenWidth,i=this.parent.worldScreenHeight,this.parent.emit("zoomed",{viewport:this.parent,type:"clamp-zoom"})}if(this.options.maxHeight!==null&&i>this.options.maxHeight){const s=this.parent.scale.y;this.parent.fitHeight(this.options.maxHeight,!1,!1,!0),this.parent.scale.x*=this.parent.scale.y/s,this.parent.emit("zoomed",{viewport:this.parent,type:"clamp-zoom"})}}else if(this.options.minScale||this.options.maxScale){const t={x:null,y:null},i={x:null,y:null};if(typeof this.options.minScale=="number")t.x=this.options.minScale,t.y=this.options.minScale;else if(this.options.minScale!==null){const n=this.options.minScale;t.x=typeof n.x>"u"?null:n.x,t.y=typeof n.y>"u"?null:n.y}if(typeof this.options.maxScale=="number")i.x=this.options.maxScale,i.y=this.options.maxScale;else if(this.options.maxScale!==null){const n=this.options.maxScale;i.x=typeof n.x>"u"?null:n.x,i.y=typeof n.y>"u"?null:n.y}let s=this.parent.scale.x,e=this.parent.scale.y;t.x!==null&&s<t.x&&(s=t.x),i.x!==null&&s>i.x&&(s=i.x),t.y!==null&&e<t.y&&(e=t.y),i.y!==null&&e>i.y&&(e=i.y),(s!==this.parent.scale.x||e!==this.parent.scale.y)&&(this.parent.scale.set(s,e),this.parent.emit("zoomed",{viewport:this.parent,type:"clamp-zoom"}))}}}reset(){this.clamp()}}const pt={friction:.98,bounce:.8,minSpeed:.01},k=16;class lt extends f{constructor(t,i={}){super(t),o(this,"options"),o(this,"x"),o(this,"y"),o(this,"percentChangeX"),o(this,"percentChangeY"),o(this,"saved"),o(this,"timeSinceRelease"),this.options=Object.assign({},pt,i),this.saved=[],this.timeSinceRelease=0,this.reset(),this.parent.on("moved",s=>this.handleMoved(s))}down(){return this.saved=[],this.x=this.y=null,!1}isActive(){return!!(this.x||this.y)}move(){if(this.paused)return!1;const t=this.parent.input.count();return(t===1||t>1&&!this.parent.plugins.get("pinch",!0))&&(this.saved.push({x:this.parent.x,y:this.parent.y,time:performance.now()}),this.saved.length>60&&this.saved.splice(0,30)),!1}handleMoved(t){if(this.saved.length){const i=this.saved[this.saved.length-1];t.type==="clamp-x"&&t.original?i.x===t.original.x&&(i.x=this.parent.x):t.type==="clamp-y"&&t.original&&i.y===t.original.y&&(i.y=this.parent.y)}}up(){if(this.parent.input.count()===0&&this.saved.length){const t=performance.now();for(const i of this.saved)if(i.time>=t-100){const s=t-i.time;this.x=(this.parent.x-i.x)/s,this.y=(this.parent.y-i.y)/s,this.percentChangeX=this.percentChangeY=this.options.friction,this.timeSinceRelease=0;break}}return!1}activate(t){t=t||{},typeof t.x<"u"&&(this.x=t.x,this.percentChangeX=this.options.friction),typeof t.y<"u"&&(this.y=t.y,this.percentChangeY=this.options.friction)}update(t){if(this.paused)return;const i=this.x||this.y,s=this.timeSinceRelease,e=this.timeSinceRelease+t;if(this.x){const n=this.percentChangeX,h=Math.log(n);this.parent.x+=this.x*k/h*(Math.pow(n,e/k)-Math.pow(n,s/k)),this.x*=Math.pow(this.percentChangeX,t/k)}if(this.y){const n=this.percentChangeY,h=Math.log(n);this.parent.y+=this.y*k/h*(Math.pow(n,e/k)-Math.pow(n,s/k)),this.y*=Math.pow(this.percentChangeY,t/k)}this.timeSinceRelease+=t,this.x&&this.y?Math.abs(this.x)<this.options.minSpeed&&Math.abs(this.y)<this.options.minSpeed&&(this.x=0,this.y=0):(Math.abs(this.x||0)<this.options.minSpeed&&(this.x=0),Math.abs(this.y||0)<this.options.minSpeed&&(this.y=0)),i&&this.parent.emit("moved",{viewport:this.parent,type:"decelerate"})}reset(){this.x=this.y=null}}const ct={direction:"all",pressDrag:!0,wheel:!0,wheelScroll:1,reverse:!1,clampWheel:!1,underflow:"center",factor:1,mouseButtons:"all",keyToPress:null,ignoreKeyToPressOnTouch:!1,lineHeight:20,wheelSwapAxes:!1};class dt extends f{constructor(t,i={}){super(t),o(this,"options"),o(this,"moved"),o(this,"reverse"),o(this,"xDirection"),o(this,"yDirection"),o(this,"keyIsPressed"),o(this,"mouse"),o(this,"underflowX"),o(this,"underflowY"),o(this,"last"),o(this,"current"),o(this,"windowEventHandlers",[]),this.options=Object.assign({},ct,i),this.moved=!1,this.reverse=this.options.reverse?1:-1,this.xDirection=!this.options.direction||this.options.direction==="all"||this.options.direction==="x",this.yDirection=!this.options.direction||this.options.direction==="all"||this.options.direction==="y",this.keyIsPressed=!1,this.parseUnderflow(),this.mouseButtons(this.options.mouseButtons),this.options.keyToPress&&this.handleKeyPresses(this.options.keyToPress)}handleKeyPresses(t){const i=e=>{t.includes(e.code)&&(this.keyIsPressed=!0)},s=e=>{t.includes(e.code)&&(this.keyIsPressed=!1)};this.addWindowEventHandler("keyup",s),this.addWindowEventHandler("keydown",i)}addWindowEventHandler(t,i){window.addEventListener(t,i),this.windowEventHandlers.push({event:t,handler:i})}destroy(){this.windowEventHandlers.forEach(({event:t,handler:i})=>{window.removeEventListener(t,i)})}mouseButtons(t){!t||t==="all"?this.mouse=[!0,!0,!0]:this.mouse=[t.indexOf("left")!==-1,t.indexOf("middle")!==-1,t.indexOf("right")!==-1]}parseUnderflow(){const t=this.options.underflow.toLowerCase();t==="center"?(this.underflowX=0,this.underflowY=0):(t.includes("left")?this.underflowX=-1:t.includes("right")?this.underflowX=1:this.underflowX=0,t.includes("top")?this.underflowY=-1:t.includes("bottom")?this.underflowY=1:this.underflowY=0)}checkButtons(t){const i=t.pointerType==="mouse",s=this.parent.input.count();return!!((s===1||s>1&&!this.parent.plugins.get("pinch",!0))&&(!i||this.mouse[t.button]))}checkKeyPress(t){return!this.options.keyToPress||this.keyIsPressed||this.options.ignoreKeyToPressOnTouch&&t.data.pointerType==="touch"}down(t){return this.paused||!this.options.pressDrag?!1:this.checkButtons(t)&&this.checkKeyPress(t)?(this.last={x:t.global.x,y:t.global.y},this.current=t.pointerId,!0):(this.last=null,!1)}get active(){return this.moved}move(t){if(this.paused||!this.options.pressDrag)return!1;if(this.last&&this.current===t.data.pointerId){const i=t.global.x,s=t.global.y,e=this.parent.input.count();if(e===1||e>1&&!this.parent.plugins.get("pinch",!0)){const n=i-this.last.x,h=s-this.last.y;if(this.moved||this.xDirection&&this.parent.input.checkThreshold(n)||this.yDirection&&this.parent.input.checkThreshold(h)){const r={x:i,y:s};return this.xDirection&&(this.parent.x+=(r.x-this.last.x)*this.options.factor),this.yDirection&&(this.parent.y+=(r.y-this.last.y)*this.options.factor),this.last=r,this.moved||this.parent.emit("drag-start",{event:t,screen:new w(this.last.x,this.last.y),world:this.parent.toWorld(new w(this.last.x,this.last.y)),viewport:this.parent}),this.moved=!0,this.parent.emit("moved",{viewport:this.parent,type:"drag"}),!0}}else this.moved=!1}return!1}up(t){if(this.paused)return!1;const i=this.parent.input.touches;if(i.length===1){const s=i[0];return s.last&&(this.last={x:s.last.x,y:s.last.y},this.current=s.id),this.moved=!1,!0}else if(this.last&&this.moved){const s=new w(this.last.x,this.last.y);return this.parent.emit("drag-end",{event:t,screen:s,world:this.parent.toWorld(s),viewport:this.parent}),this.last=null,this.moved=!1,!0}return!1}wheel(t){if(this.paused)return!1;if(this.options.wheel){const i=this.parent.plugins.get("wheel",!0);if(!i||!i.options.wheelZoom&&!t.ctrlKey){const s=t.deltaMode?this.options.lineHeight:1,e=[t.deltaX,t.deltaY],[n,h]=this.options.wheelSwapAxes?e.reverse():e;return this.xDirection&&(this.parent.x+=n*s*this.options.wheelScroll*this.reverse),this.yDirection&&(this.parent.y+=h*s*this.options.wheelScroll*this.reverse),this.options.clampWheel&&this.clamp(),this.parent.emit("wheel-scroll",this.parent),this.parent.emit("moved",{viewport:this.parent,type:"wheel"}),this.parent.options.passiveWheel||t.preventDefault(),this.parent.options.stopPropagation&&t.stopPropagation(),!0}}return!1}resume(){this.last=null,this.paused=!1}clamp(){const t=this.parent.plugins.get("decelerate",!0)||{};if(this.options.clampWheel!=="y")if(this.parent.screenWorldWidth<this.parent.screenWidth)switch(this.underflowX){case-1:this.parent.x=0;break;case 1:this.parent.x=this.parent.screenWidth-this.parent.screenWorldWidth;break;default:this.parent.x=(this.parent.screenWidth-this.parent.screenWorldWidth)/2}else this.parent.left<0?(this.parent.x=0,t.x=0):this.parent.right>this.parent.worldWidth&&(this.parent.x=-this.parent.worldWidth*this.parent.scale.x+this.parent.screenWidth,t.x=0);if(this.options.clampWheel!=="x")if(this.parent.screenWorldHeight<this.parent.screenHeight)switch(this.underflowY){case-1:this.parent.y=0;break;case 1:this.parent.y=this.parent.screenHeight-this.parent.screenWorldHeight;break;default:this.parent.y=(this.parent.screenHeight-this.parent.screenWorldHeight)/2}else this.parent.top<0&&(this.parent.y=0,t.y=0),this.parent.bottom>this.parent.worldHeight&&(this.parent.y=-this.parent.worldHeight*this.parent.scale.y+this.parent.screenHeight,t.y=0)}}const ut={speed:0,acceleration:null,radius:null};class mt extends f{constructor(t,i,s={}){super(t),o(this,"options"),o(this,"target"),o(this,"velocity"),this.target=i,this.options=Object.assign({},ut,s),this.velocity={x:0,y:0}}update(t){if(this.paused)return;const i=this.parent.center;let s=this.target.x,e=this.target.y;if(this.options.radius)if(Math.sqrt(Math.pow(this.target.y-i.y,2)+Math.pow(this.target.x-i.x,2))>this.options.radius){const r=Math.atan2(this.target.y-i.y,this.target.x-i.x);s=this.target.x-Math.cos(r)*this.options.radius,e=this.target.y-Math.sin(r)*this.options.radius}else return;const n=s-i.x,h=e-i.y;if(n||h)if(this.options.speed)if(this.options.acceleration){const r=Math.atan2(e-i.y,s-i.x),a=Math.sqrt(Math.pow(n,2)+Math.pow(h,2));if(a){const p=(Math.pow(this.velocity.x,2)+Math.pow(this.velocity.y,2))/(2*this.options.acceleration);a>p?this.velocity={x:Math.min(this.velocity.x+(this.options.acceleration*t,this.options.speed)),y:Math.min(this.velocity.y+(this.options.acceleration*t,this.options.speed))}:this.velocity={x:Math.max(this.velocity.x-this.options.acceleration*this.options.speed,0),y:Math.max(this.velocity.y-this.options.acceleration*this.options.speed,0)};const c=Math.cos(r)*this.velocity.x,y=Math.sin(r)*this.velocity.y,X=Math.abs(c)>Math.abs(n)?s:i.x+c,O=Math.abs(y)>Math.abs(h)?e:i.y+y;this.parent.moveCenter(X,O),this.parent.emit("moved",{viewport:this.parent,type:"follow"})}}else{const r=Math.atan2(e-i.y,s-i.x),a=Math.cos(r)*this.options.speed,p=Math.sin(r)*this.options.speed,c=Math.abs(a)>Math.abs(n)?s:i.x+a,y=Math.abs(p)>Math.abs(h)?e:i.y+p;this.parent.moveCenter(c,y),this.parent.emit("moved",{viewport:this.parent,type:"follow"})}else this.parent.moveCenter(s,e),this.parent.emit("moved",{viewport:this.parent,type:"follow"})}}const gt={radius:null,distance:null,top:null,bottom:null,left:null,right:null,speed:8,reverse:!1,noDecelerate:!1,linear:!1,allowButtons:!1};class wt extends f{constructor(t,i={}){super(t),o(this,"options"),o(this,"reverse"),o(this,"radiusSquared"),o(this,"left"),o(this,"top"),o(this,"right"),o(this,"bottom"),o(this,"horizontal"),o(this,"vertical"),this.options=Object.assign({},gt,i),this.reverse=this.options.reverse?1:-1,this.radiusSquared=typeof this.options.radius=="number"?Math.pow(this.options.radius,2):null,this.resize()}resize(){const t=this.options.distance;t!==null?(this.left=t,this.top=t,this.right=this.parent.screenWidth-t,this.bottom=this.parent.screenHeight-t):this.options.radius||(this.left=this.options.left,this.top=this.options.top,this.right=this.options.right===null?null:this.parent.screenWidth-this.options.right,this.bottom=this.options.bottom===null?null:this.parent.screenHeight-this.options.bottom)}down(){return this.paused||this.options.allowButtons||(this.horizontal=this.vertical=null),!1}move(t){if(this.paused||t.pointerType!=="mouse"&&t.pointerId!==1||!this.options.allowButtons&&t.buttons!==0)return!1;const i=t.global.x,s=t.global.y;if(this.radiusSquared){const e=this.parent.toScreen(this.parent.center);if(Math.pow(e.x-i,2)+Math.pow(e.y-s,2)>=this.radiusSquared){const n=Math.atan2(e.y-s,e.x-i);this.options.linear?(this.horizontal=Math.round(Math.cos(n))*this.options.speed*this.reverse*(60/1e3),this.vertical=Math.round(Math.sin(n))*this.options.speed*this.reverse*(60/1e3)):(this.horizontal=Math.cos(n)*this.options.speed*this.reverse*(60/1e3),this.vertical=Math.sin(n)*this.options.speed*this.reverse*(60/1e3))}else this.horizontal&&this.decelerateHorizontal(),this.vertical&&this.decelerateVertical(),this.horizontal=this.vertical=0}else this.left!==null&&i<this.left?this.horizontal=Number(this.reverse)*this.options.speed*(60/1e3):this.right!==null&&i>this.right?this.horizontal=-1*this.reverse*this.options.speed*(60/1e3):(this.decelerateHorizontal(),this.horizontal=0),this.top!==null&&s<this.top?this.vertical=Number(this.reverse)*this.options.speed*(60/1e3):this.bottom!==null&&s>this.bottom?this.vertical=-1*this.reverse*this.options.speed*(60/1e3):(this.decelerateVertical(),this.vertical=0);return!1}decelerateHorizontal(){const t=this.parent.plugins.get("decelerate",!0);this.horizontal&&t&&!this.options.noDecelerate&&t.activate({x:this.horizontal*this.options.speed*this.reverse/(1e3/60)})}decelerateVertical(){const t=this.parent.plugins.get("decelerate",!0);this.vertical&&t&&!this.options.noDecelerate&&t.activate({y:this.vertical*this.options.speed*this.reverse/(1e3/60)})}up(){return this.paused||(this.horizontal&&this.decelerateHorizontal(),this.vertical&&this.decelerateVertical(),this.horizontal=this.vertical=null),!1}update(){if(!this.paused&&(this.horizontal||this.vertical)){const t=this.parent.center;this.horizontal&&(t.x+=this.horizontal*this.options.speed),this.vertical&&(t.y+=this.vertical*this.options.speed),this.parent.moveCenter(t),this.parent.emit("moved",{viewport:this.parent,type:"mouse-edges"})}}}const ft={noDrag:!1,percent:1,center:null,factor:1,axis:"all"};class yt extends f{constructor(t,i={}){super(t),o(this,"options"),o(this,"active",!1),o(this,"pinching",!1),o(this,"moved",!1),o(this,"lastCenter"),this.options=Object.assign({},ft,i)}down(){return this.parent.input.count()>=2?(this.active=!0,!0):!1}isAxisX(){return["all","x"].includes(this.options.axis)}isAxisY(){return["all","y"].includes(this.options.axis)}move(t){if(this.paused||!this.active)return!1;const i=t.global.x,s=t.global.y,e=this.parent.input.touches;if(e.length>=2){const n=e[0],h=e[1],r=n.last&&h.last?Math.sqrt(Math.pow(h.last.x-n.last.x,2)+Math.pow(h.last.y-n.last.y,2)):null;if(n.id===t.pointerId?n.last={x:i,y:s,data:t}:h.id===t.pointerId&&(h.last={x:i,y:s,data:t}),r){let a;const p=new w(n.last.x+(h.last.x-n.last.x)/2,n.last.y+(h.last.y-n.last.y)/2);this.options.center||(a=this.parent.toLocal(p));let c=Math.sqrt(Math.pow(h.last.x-n.last.x,2)+Math.pow(h.last.y-n.last.y,2));c=c===0?c=1e-10:c;const y=(1-r/c)*this.options.percent*(this.isAxisX()?this.parent.scale.x:this.parent.scale.y);this.isAxisX()&&(this.parent.scale.x+=y),this.isAxisY()&&(this.parent.scale.y+=y),this.parent.emit("zoomed",{viewport:this.parent,type:"pinch",center:p});const X=this.parent.plugins.get("clamp-zoom",!0);if(X&&X.clamp(),this.options.center)this.parent.moveCenter(this.options.center);else{const O=this.parent.toGlobal(a);this.parent.x+=(p.x-O.x)*this.options.factor,this.parent.y+=(p.y-O.y)*this.options.factor,this.parent.emit("moved",{viewport:this.parent,type:"pinch"})}!this.options.noDrag&&this.lastCenter&&(this.parent.x+=(p.x-this.lastCenter.x)*this.options.factor,this.parent.y+=(p.y-this.lastCenter.y)*this.options.factor,this.parent.emit("moved",{viewport:this.parent,type:"pinch"})),this.lastCenter=p,this.moved=!0}else this.pinching||(this.parent.emit("pinch-start",this.parent),this.pinching=!0);return!0}return!1}up(){return this.pinching&&this.parent.input.touches.length<=1?(this.active=!1,this.lastCenter=null,this.pinching=!1,this.moved=!1,this.parent.emit("pinch-end",this.parent),!0):!1}}const xt={topLeft:!1,friction:.8,time:1e3,ease:"easeInOutSine",interrupt:!0,removeOnComplete:!1,removeOnInterrupt:!1,forceStart:!1};class vt extends f{constructor(t,i,s,e={}){super(t),o(this,"options"),o(this,"ease"),o(this,"x"),o(this,"y"),o(this,"percent"),o(this,"snapping"),o(this,"deltaX"),o(this,"deltaY"),o(this,"startX"),o(this,"startY"),this.options=Object.assign({},xt,e),this.ease=V(e.ease,"easeInOutSine"),this.x=i,this.y=s,this.options.forceStart&&this.snapStart()}snapStart(){this.percent=0,this.snapping={time:0};const t=this.options.topLeft?this.parent.corner:this.parent.center;this.deltaX=this.x-t.x,this.deltaY=this.y-t.y,this.startX=t.x,this.startY=t.y,this.parent.emit("snap-start",this.parent)}wheel(){return this.options.removeOnInterrupt&&this.parent.plugins.remove("snap"),!1}down(){return this.options.removeOnInterrupt?this.parent.plugins.remove("snap"):this.options.interrupt&&(this.snapping=null),!1}up(){if(this.parent.input.count()===0){const t=this.parent.plugins.get("decelerate",!0);t&&(t.x||t.y)&&(t.percentChangeX=t.percentChangeY=this.options.friction)}return!1}update(t){if(!this.paused&&!(this.options.interrupt&&this.parent.input.count()!==0))if(this.snapping){const i=this.snapping;i.time+=t;let s,e,n;const h=this.startX,r=this.startY,a=this.deltaX,p=this.deltaY;if(i.time>this.options.time)s=!0,e=h+a,n=r+p;else{const c=this.ease(i.time,0,1,this.options.time);e=h+a*c,n=r+p*c}this.options.topLeft?this.parent.moveCorner(e,n):this.parent.moveCenter(e,n),this.parent.emit("moved",{viewport:this.parent,type:"snap"}),s&&(this.options.removeOnComplete&&this.parent.plugins.remove("snap"),this.parent.emit("snap-end",this.parent),this.snapping=null)}else{const i=this.options.topLeft?this.parent.corner:this.parent.center;(i.x!==this.x||i.y!==this.y)&&this.snapStart()}}}const bt={width:0,height:0,time:1e3,ease:"easeInOutSine",center:null,interrupt:!0,removeOnComplete:!1,removeOnInterrupt:!1,forceStart:!1,noMove:!1};class Wt extends f{constructor(t,i={}){super(t),o(this,"options"),o(this,"ease"),o(this,"xScale"),o(this,"yScale"),o(this,"xIndependent"),o(this,"yIndependent"),o(this,"snapping"),this.options=Object.assign({},bt,i),this.ease=V(this.options.ease),this.xIndependent=!1,this.yIndependent=!1,this.xScale=0,this.yScale=0,this.options.width>0&&(this.xScale=t.screenWidth/this.options.width,this.xIndependent=!0),this.options.height>0&&(this.yScale=t.screenHeight/this.options.height,this.yIndependent=!0),this.xScale=this.xIndependent?this.xScale:this.yScale,this.yScale=this.yIndependent?this.yScale:this.xScale,this.options.time===0?(t.container.scale.x=this.xScale,t.container.scale.y=this.yScale,this.options.removeOnComplete&&this.parent.plugins.remove("snap-zoom")):i.forceStart&&this.createSnapping()}createSnapping(){const t=this.parent.worldScreenWidth,i=this.parent.worldScreenHeight,s=this.parent.screenWidth/this.xScale,e=this.parent.screenHeight/this.yScale;this.snapping={time:0,startX:t,startY:i,deltaX:s-t,deltaY:e-i},this.parent.emit("snap-zoom-start",this.parent)}resize(){this.snapping=null,this.options.width>0&&(this.xScale=this.parent.screenWidth/this.options.width),this.options.height>0&&(this.yScale=this.parent.screenHeight/this.options.height),this.xScale=this.xIndependent?this.xScale:this.yScale,this.yScale=this.yIndependent?this.yScale:this.xScale}wheel(){return this.options.removeOnInterrupt&&this.parent.plugins.remove("snap-zoom"),!1}down(){return this.options.removeOnInterrupt?this.parent.plugins.remove("snap-zoom"):this.options.interrupt&&(this.snapping=null),!1}update(t){if(this.paused||this.options.interrupt&&this.parent.input.count()!==0)return;let i;if(!this.options.center&&!this.options.noMove&&(i=this.parent.center),!this.snapping)(this.parent.scale.x!==this.xScale||this.parent.scale.y!==this.yScale)&&this.createSnapping();else if(this.snapping){const s=this.snapping;if(s.time+=t,s.time>=this.options.time)this.parent.scale.set(this.xScale,this.yScale),this.options.removeOnComplete&&this.parent.plugins.remove("snap-zoom"),this.parent.emit("snap-zoom-end",this.parent),this.snapping=null;else{const n=this.snapping,h=this.ease(n.time,n.startX,n.deltaX,this.options.time),r=this.ease(n.time,n.startY,n.deltaY,this.options.time);this.parent.scale.x=this.parent.screenWidth/h,this.parent.scale.y=this.parent.screenHeight/r}const e=this.parent.plugins.get("clamp-zoom",!0);e&&e.clamp(),this.options.noMove||(this.options.center?this.parent.moveCenter(this.options.center):this.parent.moveCenter(i))}}resume(){this.snapping=null,super.resume()}}const Ht={percent:.1,smooth:!1,interrupt:!0,reverse:!1,center:null,lineHeight:20,axis:"all",keyToPress:null,trackpadPinch:!1,wheelZoom:!0};class Mt extends f{constructor(t,i={}){super(t),o(this,"options"),o(this,"smoothing"),o(this,"smoothingCenter"),o(this,"smoothingCount"),o(this,"keyIsPressed"),this.options=Object.assign({},Ht,i),this.keyIsPressed=!1,this.options.keyToPress&&this.handleKeyPresses(this.options.keyToPress)}handleKeyPresses(t){window.addEventListener("keydown",i=>{t.includes(i.code)&&(this.keyIsPressed=!0)}),window.addEventListener("keyup",i=>{t.includes(i.code)&&(this.keyIsPressed=!1)})}checkKeyPress(){return!this.options.keyToPress||this.keyIsPressed}down(){return this.options.interrupt&&(this.smoothing=null),!1}isAxisX(){return["all","x"].includes(this.options.axis)}isAxisY(){return["all","y"].includes(this.options.axis)}update(){if(this.smoothing){const t=this.smoothingCenter,i=this.smoothing;let s;this.options.center||(s=this.parent.toLocal(t)),this.isAxisX()&&(this.parent.scale.x+=i.x),this.isAxisY()&&(this.parent.scale.y+=i.y),this.parent.emit("zoomed",{viewport:this.parent,type:"wheel"});const e=this.parent.plugins.get("clamp-zoom",!0);if(e&&e.clamp(),this.options.center)this.parent.moveCenter(this.options.center);else{const n=this.parent.toGlobal(s);this.parent.x+=t.x-n.x,this.parent.y+=t.y-n.y}this.parent.emit("moved",{viewport:this.parent,type:"wheel"}),this.smoothingCount++,this.smoothingCount>=this.options.smooth&&(this.smoothing=null)}}pinch(t){if(this.paused)return;const i=this.parent.input.getPointerPosition(t),s=-t.deltaY*(t.deltaMode?this.options.lineHeight:1)/200,e=Math.pow(2,(1+this.options.percent)*s);let n;this.options.center||(n=this.parent.toLocal(i)),this.isAxisX()&&(this.parent.scale.x*=e),this.isAxisY()&&(this.parent.scale.y*=e),this.parent.emit("zoomed",{viewport:this.parent,type:"wheel"});const h=this.parent.plugins.get("clamp-zoom",!0);if(h&&h.clamp(),this.options.center)this.parent.moveCenter(this.options.center);else{const r=this.parent.toGlobal(n);this.parent.x+=i.x-r.x,this.parent.y+=i.y-r.y}this.parent.emit("moved",{viewport:this.parent,type:"wheel"}),this.parent.emit("wheel-start",{event:t,viewport:this.parent})}wheel(t){if(this.paused||!this.checkKeyPress())return!1;if(t.ctrlKey&&this.options.trackpadPinch)this.pinch(t);else if(this.options.wheelZoom){const i=this.parent.input.getPointerPosition(t),s=(this.options.reverse?-1:1)*-t.deltaY*(t.deltaMode?this.options.lineHeight:1)/500,e=Math.pow(2,(1+this.options.percent)*s);if(this.options.smooth){const n={x:this.smoothing?this.smoothing.x*(this.options.smooth-this.smoothingCount):0,y:this.smoothing?this.smoothing.y*(this.options.smooth-this.smoothingCount):0};this.smoothing={x:((this.parent.scale.x+n.x)*e-this.parent.scale.x)/this.options.smooth,y:((this.parent.scale.y+n.y)*e-this.parent.scale.y)/this.options.smooth},this.smoothingCount=0,this.smoothingCenter=i}else{let n;this.options.center||(n=this.parent.toLocal(i)),this.isAxisX()&&(this.parent.scale.x*=e),this.isAxisY()&&(this.parent.scale.y*=e),this.parent.emit("zoomed",{viewport:this.parent,type:"wheel"});const h=this.parent.plugins.get("clamp-zoom",!0);if(h&&h.clamp(),this.options.center)this.parent.moveCenter(this.options.center);else{const r=this.parent.toGlobal(n);this.parent.x+=i.x-r.x,this.parent.y+=i.y-r.y}}this.parent.emit("moved",{viewport:this.parent,type:"wheel"}),this.parent.emit("wheel-start",{event:t,viewport:this.parent})}return!this.parent.options.passiveWheel}}class St{constructor(t){o(this,"viewport"),o(this,"clickedAvailable"),o(this,"isMouseDown"),o(this,"last"),o(this,"wheelFunction"),o(this,"touches"),this.viewport=t,this.touches=[],this.addListeners()}addListeners(){this.viewport.interactive=!0,this.viewport.forceHitArea||(this.viewport.hitArea=new _(0,0,this.viewport.worldWidth,this.viewport.worldHeight)),this.viewport.on("pointerdown",this.down,this),this.viewport.options.allowPreserveDragOutside?this.viewport.on("globalpointermove",this.move,this):this.viewport.on("pointermove",this.move,this),this.viewport.on("pointerup",this.up,this),this.viewport.on("pointerupoutside",this.up,this),this.viewport.on("pointercancel",this.up,this),this.viewport.options.allowPreserveDragOutside||this.viewport.on("pointerleave",this.up,this),this.wheelFunction=t=>this.handleWheel(t),this.viewport.options.events.domElement.addEventListener("wheel",this.wheelFunction,{passive:this.viewport.options.passiveWheel}),this.isMouseDown=!1}destroy(){this.viewport.options.events.domElement.removeEventListener("wheel",this.wheelFunction)}down(t){if(!(this.viewport.pause||!this.viewport.worldVisible)){if(t.pointerType==="mouse"?this.isMouseDown=!0:this.get(t.pointerId)||this.touches.push({id:t.pointerId,last:null}),this.count()===1){this.last=t.global.clone();const i=this.viewport.plugins.get("decelerate",!0),s=this.viewport.plugins.get("bounce",!0);(!i||!i.isActive())&&(!s||!s.isActive())?this.clickedAvailable=!0:this.clickedAvailable=!1}else this.clickedAvailable=!1;this.viewport.plugins.down(t)&&this.viewport.options.stopPropagation&&t.stopPropagation()}}clear(){this.isMouseDown=!1,this.touches=[],this.last=null}checkThreshold(t){return Math.abs(t)>=this.viewport.threshold}move(t){if(this.viewport.pause||!this.viewport.worldVisible)return;const i=this.viewport.plugins.move(t);if(this.clickedAvailable&&this.last){const s=t.global.x-this.last.x,e=t.global.y-this.last.y;(this.checkThreshold(s)||this.checkThreshold(e))&&(this.clickedAvailable=!1)}i&&this.viewport.options.stopPropagation&&t.stopPropagation()}up(t){if(this.viewport.pause||!this.viewport.worldVisible)return;t.pointerType==="mouse"&&(this.isMouseDown=!1),t.pointerType!=="mouse"&&this.remove(t.pointerId);const i=this.viewport.plugins.up(t);this.clickedAvailable&&this.count()===0&&this.last&&(this.viewport.emit("clicked",{event:t,screen:this.last,world:this.viewport.toWorld(this.last),viewport:this.viewport}),this.clickedAvailable=!1),i&&this.viewport.options.stopPropagation&&t.stopPropagation()}getPointerPosition(t){const i=new w;return this.viewport.options.events.mapPositionToPoint(i,t.clientX,t.clientY),i}handleWheel(t){if(this.viewport.pause||!this.viewport.worldVisible)return;const i=this.viewport.toLocal(this.getPointerPosition(t));this.viewport.left<=i.x&&i.x<=this.viewport.right&&this.viewport.top<=i.y&&i.y<=this.viewport.bottom&&this.viewport.plugins.wheel(t)&&!this.viewport.options.passiveWheel&&t.preventDefault()}pause(){this.touches=[],this.isMouseDown=!1}get(t){for(const i of this.touches)if(i.id===t)return i;return null}remove(t){for(let i=0;i<this.touches.length;i++)if(this.touches[i].id===t){this.touches.splice(i,1);return}}count(){return(this.isMouseDown?1:0)+this.touches.length}}const E=["drag","pinch","wheel","follow","mouse-edges","decelerate","animate","bounce","snap-zoom","clamp-zoom","snap","clamp"];class Ct{constructor(t){o(this,"plugins"),o(this,"list"),o(this,"viewport"),this.viewport=t,this.list=[],this.plugins={}}add(t,i,s=E.length){const e=this.plugins[t];e&&e.destroy(),this.plugins[t]=i;const n=E.indexOf(t);n!==-1&&E.splice(n,1),E.splice(s,0,t),this.sort()}get(t,i){var s;return i&&(s=this.plugins[t])!=null&&s.paused?null:this.plugins[t]}update(t){for(const i of this.list)i.update(t)}resize(){for(const t of this.list)t.resize()}reset(){for(const t of this.list)t.reset()}removeAll(){this.list.forEach(t=>{t.destroy()}),this.plugins={},this.sort()}remove(t){var i;this.plugins[t]&&((i=this.plugins[t])==null||i.destroy(),delete this.plugins[t],this.viewport.emit("plugin-remove",t),this.sort())}pause(t){var i;(i=this.plugins[t])==null||i.pause()}resume(t){var i;(i=this.plugins[t])==null||i.resume()}sort(){this.list=[];for(const t of E)this.plugins[t]&&this.list.push(this.plugins[t])}down(t){let i=!1;for(const s of this.list)s.down(t)&&(i=!0);return i}move(t){let i=!1;for(const s of this.viewport.plugins.list)s.move(t)&&(i=!0);return i}up(t){let i=!1;for(const s of this.list)s.up(t)&&(i=!0);return i}wheel(t){let i=!1;for(const s of this.list)s.wheel(t)&&(i=!0);return i}}const kt={screenWidth:window.innerWidth,screenHeight:window.innerHeight,worldWidth:null,worldHeight:null,threshold:5,passiveWheel:!0,stopPropagation:!1,forceHitArea:null,noTicker:!1,disableOnContextMenu:!1,ticker:N.shared,allowPreserveDragOutside:!1};class It extends Q{constructor(t){super(),o(this,"moving"),o(this,"screenWidth"),o(this,"screenHeight"),o(this,"threshold"),o(this,"input"),o(this,"plugins"),o(this,"zooming"),o(this,"lastViewport"),o(this,"options"),o(this,"_dirty"),o(this,"_forceHitArea"),o(this,"_hitAreaDefault"),o(this,"_pause"),o(this,"tickerFunction"),o(this,"_worldWidth"),o(this,"_worldHeight"),o(this,"_disableOnContextMenu",i=>i.preventDefault()),this.options={...kt,...t},this.screenWidth=this.options.screenWidth,this.screenHeight=this.options.screenHeight,this._worldWidth=this.options.worldWidth,this._worldHeight=this.options.worldHeight,this.forceHitArea=this.options.forceHitArea,this.threshold=this.options.threshold,this.options.disableOnContextMenu&&this.options.events.domElement.addEventListener("contextmenu",this._disableOnContextMenu),this.options.noTicker||(this.tickerFunction=()=>this.update(this.options.ticker.elapsedMS),this.options.ticker.add(this.tickerFunction)),this.input=new St(this),this.plugins=new Ct(this)}destroy(t){!this.options.noTicker&&this.tickerFunction&&this.options.ticker.remove(this.tickerFunction),this.options.disableOnContextMenu&&this.options.events.domElement.removeEventListener("contextmenu",this._disableOnContextMenu),this.input.destroy(),super.destroy(t)}update(t){this.pause||(this.plugins.update(t),this.lastViewport&&(this.lastViewport.x!==this.x||this.lastViewport.y!==this.y?this.moving=!0:this.moving&&(this.emit("moved-end",this),this.moving=!1),this.lastViewport.scaleX!==this.scale.x||this.lastViewport.scaleY!==this.scale.y?this.zooming=!0:this.zooming&&(this.emit("zoomed-end",this),this.zooming=!1)),this.forceHitArea||(this._hitAreaDefault=new _(this.left,this.top,this.worldScreenWidth,this.worldScreenHeight),this.hitArea=this._hitAreaDefault),this._dirty=this._dirty||!this.lastViewport||this.lastViewport.x!==this.x||this.lastViewport.y!==this.y||this.lastViewport.scaleX!==this.scale.x||this.lastViewport.scaleY!==this.scale.y,this.lastViewport={x:this.x,y:this.y,scaleX:this.scale.x,scaleY:this.scale.y},this.emit("frame-end",this))}resize(t=window.innerWidth,i=window.innerHeight,s,e){this.screenWidth=t,this.screenHeight=i,typeof s<"u"&&(this._worldWidth=s),typeof e<"u"&&(this._worldHeight=e),this.plugins.resize(),this.dirty=!0}get worldWidth(){return this._worldWidth?this._worldWidth:this.width/this.scale.x}set worldWidth(t){this._worldWidth=t,this.plugins.resize()}get worldHeight(){return this._worldHeight?this._worldHeight:this.height/this.scale.y}set worldHeight(t){this._worldHeight=t,this.plugins.resize()}getVisibleBounds(){return new _(this.left,this.top,this.worldScreenWidth,this.worldScreenHeight)}toWorld(t,i){return arguments.length===2?this.toLocal(new w(t,i)):this.toLocal(t)}toScreen(t,i){return arguments.length===2?this.toGlobal(new w(t,i)):this.toGlobal(t)}get worldScreenWidth(){return this.screenWidth/this.scale.x}get worldScreenHeight(){return this.screenHeight/this.scale.y}get screenWorldWidth(){return this.worldWidth*this.scale.x}get screenWorldHeight(){return this.worldHeight*this.scale.y}get center(){return new w(this.worldScreenWidth/2-this.x/this.scale.x,this.worldScreenHeight/2-this.y/this.scale.y)}set center(t){this.moveCenter(t)}moveCenter(...t){let i,s;typeof t[0]=="number"?(i=t[0],s=t[1]):(i=t[0].x,s=t[0].y);const e=(this.worldScreenWidth/2-i)*this.scale.x,n=(this.worldScreenHeight/2-s)*this.scale.y;return(this.x!==e||this.y!==n)&&(this.position.set(e,n),this.plugins.reset(),this.dirty=!0),this}get corner(){return new w(-this.x/this.scale.x,-this.y/this.scale.y)}set corner(t){this.moveCorner(t)}moveCorner(...t){let i,s;return t.length===1?(i=-t[0].x*this.scale.x,s=-t[0].y*this.scale.y):(i=-t[0]*this.scale.x,s=-t[1]*this.scale.y),(i!==this.x||s!==this.y)&&(this.position.set(i,s),this.plugins.reset(),this.dirty=!0),this}get screenWidthInWorldPixels(){return this.screenWidth/this.scale.x}get screenHeightInWorldPixels(){return this.screenHeight/this.scale.y}findFitWidth(t){return this.screenWidth/t}findFitHeight(t){return this.screenHeight/t}findFit(t,i){const s=this.screenWidth/t,e=this.screenHeight/i;return Math.min(s,e)}findCover(t,i){const s=this.screenWidth/t,e=this.screenHeight/i;return Math.max(s,e)}fitWidth(t=this.worldWidth,i,s=!0,e){let n;i&&(n=this.center),this.scale.x=this.screenWidth/t,s&&(this.scale.y=this.scale.x);const h=this.plugins.get("clamp-zoom",!0);return!e&&h&&h.clamp(),i&&n&&this.moveCenter(n),this}fitHeight(t=this.worldHeight,i,s=!0,e){let n;i&&(n=this.center),this.scale.y=this.screenHeight/t,s&&(this.scale.x=this.scale.y);const h=this.plugins.get("clamp-zoom",!0);return!e&&h&&h.clamp(),i&&n&&this.moveCenter(n),this}fitWorld(t){let i;t&&(i=this.center),this.scale.x=this.screenWidth/this.worldWidth,this.scale.y=this.screenHeight/this.worldHeight,this.scale.x<this.scale.y?this.scale.y=this.scale.x:this.scale.x=this.scale.y;const s=this.plugins.get("clamp-zoom",!0);return s&&s.clamp(),t&&i&&this.moveCenter(i),this}fit(t,i=this.worldWidth,s=this.worldHeight){let e;t&&(e=this.center),this.scale.x=this.screenWidth/i,this.scale.y=this.screenHeight/s,this.scale.x<this.scale.y?this.scale.y=this.scale.x:this.scale.x=this.scale.y;const n=this.plugins.get("clamp-zoom",!0);return n&&n.clamp(),t&&e&&this.moveCenter(e),this}setZoom(t,i){let s;i&&(s=this.center),this.scale.set(t);const e=this.plugins.get("clamp-zoom",!0);return e&&e.clamp(),i&&s&&this.moveCenter(s),this}zoomPercent(t,i){return this.setZoom(this.scale.x+this.scale.x*t,i)}zoom(t,i){return this.fitWidth(t+this.worldScreenWidth,i),this}get scaled(){return this.scale.x}set scaled(t){this.setZoom(t,!0)}snapZoom(t){return this.plugins.add("snap-zoom",new Wt(this,t)),this}OOB(){return{left:this.left<0,right:this.right>this.worldWidth,top:this.top<0,bottom:this.bottom>this.worldHeight,cornerPoint:new w(this.worldWidth*this.scale.x-this.screenWidth,this.worldHeight*this.scale.y-this.screenHeight)}}get right(){return-this.x/this.scale.x+this.worldScreenWidth}set right(t){this.x=-t*this.scale.x+this.screenWidth,this.plugins.reset()}get left(){return-this.x/this.scale.x}set left(t){this.x=-t*this.scale.x,this.plugins.reset()}get top(){return-this.y/this.scale.y}set top(t){this.y=-t*this.scale.y,this.plugins.reset()}get bottom(){return-this.y/this.scale.y+this.worldScreenHeight}set bottom(t){this.y=-t*this.scale.y+this.screenHeight,this.plugins.reset()}get dirty(){return!!this._dirty}set dirty(t){this._dirty=t}get forceHitArea(){return this._forceHitArea}set forceHitArea(t){t?(this._forceHitArea=t,this.hitArea=t):(this._forceHitArea=null,this.hitArea=new _(0,0,this.worldWidth,this.worldHeight))}drag(t){return this.plugins.add("drag",new dt(this,t)),this}clamp(t){return this.plugins.add("clamp",new ot(this,t)),this}decelerate(t){return this.plugins.add("decelerate",new lt(this,t)),this}bounce(t){return this.plugins.add("bounce",new nt(this,t)),this}pinch(t){return this.plugins.add("pinch",new yt(this,t)),this}snap(t,i,s){return this.plugins.add("snap",new vt(this,t,i,s)),this}follow(t,i){return this.plugins.add("follow",new mt(this,t,i)),this}wheel(t){return this.plugins.add("wheel",new Mt(this,t)),this}animate(t){return this.plugins.add("animate",new it(this,t)),this}clampZoom(t){return this.plugins.add("clamp-zoom",new at(this,t)),this}mouseEdges(t){return this.plugins.add("mouse-edges",new wt(this,t)),this}get pause(){return!!this._pause}set pause(t){this._pause=t,this.lastViewport=null,this.moving=!1,this.zooming=!1,t&&this.input.pause()}ensureVisible(t,i,s,e,n){n&&(s>this.worldScreenWidth||e>this.worldScreenHeight)&&(this.fit(!0,s,e),this.emit("zoomed",{viewport:this,type:"ensureVisible"}));let h=!1;t<this.left?(this.left=t,h=!0):t+s>this.right&&(this.right=t+s,h=!0),i<this.top?(this.top=i,h=!0):i+e>this.bottom&&(this.bottom=i+e,h=!0),h&&this.emit("moved",{viewport:this,type:"ensureVisible"})}}var K={exports:{}};(function(d){(function(){function t(l,m){document.addEventListener?l.addEventListener("scroll",m,!1):l.attachEvent("scroll",m)}function i(l){document.body?l():document.addEventListener?document.addEventListener("DOMContentLoaded",function m(){document.removeEventListener("DOMContentLoaded",m),l()}):document.attachEvent("onreadystatechange",function m(){(document.readyState=="interactive"||document.readyState=="complete")&&(document.detachEvent("onreadystatechange",m),l())})}function s(l){this.g=document.createElement("div"),this.g.setAttribute("aria-hidden","true"),this.g.appendChild(document.createTextNode(l)),this.h=document.createElement("span"),this.i=document.createElement("span"),this.m=document.createElement("span"),this.j=document.createElement("span"),this.l=-1,this.h.style.cssText="max-width:none;display:inline-block;position:absolute;height:100%;width:100%;overflow:scroll;font-size:16px;",this.i.style.cssText="max-width:none;display:inline-block;position:absolute;height:100%;width:100%;overflow:scroll;font-size:16px;",this.j.style.cssText="max-width:none;display:inline-block;position:absolute;height:100%;width:100%;overflow:scroll;font-size:16px;",this.m.style.cssText="display:inline-block;width:200%;height:200%;font-size:16px;max-width:none;",this.h.appendChild(this.m),this.i.appendChild(this.j),this.g.appendChild(this.h),this.g.appendChild(this.i)}function e(l,m){l.g.style.cssText="max-width:none;min-width:20px;min-height:20px;display:inline-block;overflow:hidden;position:absolute;width:auto;margin:0;padding:0;top:-999px;white-space:nowrap;font-synthesis:none;font:"+m+";"}function n(l){var m=l.g.offsetWidth,u=m+100;return l.j.style.width=u+"px",l.i.scrollLeft=u,l.h.scrollLeft=l.h.scrollWidth+100,l.l!==m?(l.l=m,!0):!1}function h(l,m){function u(){var x=S;n(x)&&x.g.parentNode!==null&&m(x.l)}var S=l;t(l.h,u),t(l.i,u),n(l)}function r(l,m,u){m=m||{},u=u||window,this.family=l,this.style=m.style||"normal",this.weight=m.weight||"normal",this.stretch=m.stretch||"normal",this.context=u}var a=null,p=null,c=null,y=null;function X(l){return p===null&&(O(l)&&/Apple/.test(window.navigator.vendor)?(l=/AppleWebKit\/([0-9]+)(?:\.([0-9]+))(?:\.([0-9]+))/.exec(window.navigator.userAgent),p=!!l&&603>parseInt(l[1],10)):p=!1),p}function O(l){return y===null&&(y=!!l.document.fonts),y}function z(l,m){var u=l.style,S=l.weight;if(c===null){var x=document.createElement("div");try{x.style.font="condensed 100px sans-serif"}catch{}c=x.style.font!==""}return[u,S,c?l.stretch:"","100px",m].join(" ")}r.prototype.load=function(l,m){var u=this,S=l||"BESbswy",x=0,I=m||3e3,B=new Date().getTime();return new Promise(function(j,F){if(O(u.context)&&!X(u.context)){var R=new Promise(function(P,Y){function b(){new Date().getTime()-B>=I?Y(Error(""+I+"ms timeout exceeded")):u.context.document.fonts.load(z(u,'"'+u.family+'"'),S).then(function(C){1<=C.length?P():setTimeout(b,25)},Y)}b()}),Z=new Promise(function(P,Y){x=setTimeout(function(){Y(Error(""+I+"ms timeout exceeded"))},I)});Promise.race([Z,R]).then(function(){clearTimeout(x),j(u)},F)}else i(function(){function P(){var g;(g=W!=-1&&H!=-1||W!=-1&&M!=-1||H!=-1&&M!=-1)&&((g=W!=H&&W!=M&&H!=M)||(a===null&&(g=/AppleWebKit\/([0-9]+)(?:\.([0-9]+))/.exec(window.navigator.userAgent),a=!!g&&(536>parseInt(g[1],10)||parseInt(g[1],10)===536&&11>=parseInt(g[2],10))),g=a&&(W==T&&H==T&&M==T||W==D&&H==D&&M==D||W==L&&H==L&&M==L)),g=!g),g&&(v.parentNode!==null&&v.parentNode.removeChild(v),clearTimeout(x),j(u))}function Y(){if(new Date().getTime()-B>=I)v.parentNode!==null&&v.parentNode.removeChild(v),F(Error(""+I+"ms timeout exceeded"));else{var g=u.context.document.hidden;(g===!0||g===void 0)&&(W=b.g.offsetWidth,H=C.g.offsetWidth,M=A.g.offsetWidth,P()),x=setTimeout(Y,50)}}var b=new s(S),C=new s(S),A=new s(S),W=-1,H=-1,M=-1,T=-1,D=-1,L=-1,v=document.createElement("div");v.dir="ltr",e(b,z(u,"sans-serif")),e(C,z(u,"serif")),e(A,z(u,"monospace")),v.appendChild(b.g),v.appendChild(C.g),v.appendChild(A.g),u.context.document.body.appendChild(v),T=b.g.offsetWidth,D=C.g.offsetWidth,L=A.g.offsetWidth,Y(),h(b,function(g){W=g,P()}),e(b,z(u,'"'+u.family+'",sans-serif')),h(C,function(g){H=g,P()}),e(C,z(u,'"'+u.family+'",serif')),h(A,function(g){M=g,P()}),e(A,z(u,'"'+u.family+'",monospace'))})})},d.exports=r})()})(K);var Ot=K.exports;const Pt=G(Ot);export{Pt as F,It as h};
