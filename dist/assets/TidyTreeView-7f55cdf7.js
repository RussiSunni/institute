import{_ as b,u as L,S as j,r as z,o as _,c as v,b as p,a as w,p as N,d as I,e as R,f as y,g as U,F as $}from"./main-cb49adad.js";import{u as B}from"./SkillTreeStore-4cee3586.js";import{u as P,S as A}from"./SkillTreeFilter-f587549d.js";import{S as M}from"./fontfaceobserver.standalone-ab93a454.js";import{h as O}from"./transform-9136d5be.js";import{c as F,z as D,s as H}from"./zoom-a80d6af8.js";import{a as q}from"./ascending-3ff63084.js";import{t as E}from"./tree-6111a21a.js";import{a as V}from"./link-afe1ff0a.js";const J={setup(){const s=L(),n=B(),l=P();return{userDetailsStore:s,skillTreeStore:n,skillTagsStore:l}},data(){return{stageContents:[],isSkillInfoPanelShown:!1,regularLockedUnmasteredNodeSprite:null,radius:0,width:null,height:null,radiusMultiplier:64,firstLevelNodeSize:100,regularNodeSize:50,subSkillRadius:50,skill:{id:null,children:[],isMastered:null,isUnlocked:null,container:null,name:null,description:null,tagIDs:[],sprite:null},isRecentered:!1,svg:null}},components:{SkillTreeFilter:A,SkillPanel:M},async mounted(){this.skillTreeStore.userSkills.length==0&&await this.skillTreeStore.getUserSkills(),this.width=window.innerWidth,this.height=window.innerHeight,this.radius=Math.min(this.width,this.height)/2;const s=j.from("center-node.png");this.skill={name:"SKILLS",sprite:s,children:this.skillTreeStore.userSkills},this.getAlgorithm()},methods:{getAlgorithm(){var s=[];s=JSON.parse(JSON.stringify(this.skill.children));function n(e){for(var t=e.length;t--;){if(e[t].type=="super"&&e[t].position!="end"){var S=[],g=[];for(let o=0;o<e[t].children.length;o++)e[t].children[o].type=="sub"?S.push(e[t].children[o]):g.push(e[t].children[o]);var T={skill_name:e[t].skill_name,type:"super",position:"end",children:S};e[t].children=[],e[t].children.push(T);for(let o=0;o<g.length;o++)e[t].children.push(g[o])}typeof e[t]<"u"&&e[t].children&&Array.isArray(e[t].children)&&e[t].children.length>0&&n(e[t].children)}}n(s);var l={name:null,children:s};const c=8e3,r=O(l),d=30,u=c/(r.height+1),a=E().nodeSize([d,u]);r.sort((e,t)=>q(e.data.name,t.data.name)),a(r);let i=1/0,h=-i;r.each(e=>{e.x>h&&(h=e.x),e.x<i&&(i=e.x)});const f=h-i+d*2;this.svg=F("svg").attr("id","linearTree").attr("width",c).attr("height",f).attr("viewBox",[-u/3,i-d,c,f]).attr("style","max-width: 100%; height: auto; font: 10px sans-serif;");const m=this.svg.append("g");m.append("g").attr("fill","none").attr("stroke-opacity",1).selectAll().data(r.links()).join("path").attr("d",V().x(e=>e.y).y(e=>e.x)).attr("stroke",function(e){return"#000"}).attr("stroke-width",function(e){return e.target.data.is_mastered==1?8:1.5}).style("stroke-dasharray",function(e){if(e.source.data.type=="super"&&e.target.data.position=="end"||e.target.data.type=="sub")return 5});const k=m.append("g").attr("stroke-linejoin","round").attr("stroke-width",3).selectAll().data(r.descendants()).join("g").attr("transform",e=>`translate(${e.y},${e.x})`);k.append("circle").attr("fill",e=>e.children?"#555":"#000").attr("r",2.5),k.append("text").style("font-weight",function(e){return e.data.type=="super"?"700":"400"}).style("font-style",function(e){if(e.data.type=="sub")return"italic"}).attr("dy","0.31em").attr("x",e=>e.children?-6:6).attr("text-anchor",e=>e.children?"end":"start").text(function(e){return e.data.position=="end"?"":e.data.skill_name}).clone(!0).lower().attr("stroke",function(e){return"white"}),this.svg.call(D().extent([[0,0],[this.width,this.height]]).scaleExtent([.1,20]).on("zoom",x));function x({transform:e}){m.attr("transform",e)}document.querySelector("#skilltree").append(this.svg.node())},printPDF(){var s=document.getElementById("linearTree"),n=H(s),l=n.node(),c=new XMLSerializer,r=c.serializeToString(l),d={svg:r,treeType:"linear"},u=JSON.stringify(d),a=new XMLHttpRequest;a.responseType="arraybuffer",a.open("POST","/skilltree/print-pdf",!0),a.setRequestHeader("Content-type","application/json;charset=UTF-8"),a.setRequestHeader("Accept","application/json, text/plain, */*"),a.send(u),a.onload=function(){if(this.readyState==4&&this.status==200){let h=new Blob([a.response],{type:"application/pdf"});const f=window.URL.createObjectURL(h);var i=document.createElement("a");document.body.appendChild(i),i.style="display: none",i.href=f,i.download="My-Skill-Tree.pdf",i.click(),window.URL.revokeObjectURL(f)}}}}},W=s=>(N("data-v-cb133569"),s=s(),I(),s),X={class:"flex-container skill-tree-container"},K={id:"wrapper"},G={id:"skilltree"},Q=W(()=>p("div",{id:"sidepanel-backdrop"},null,-1));function Y(s,n,l,c,r,d){const u=z("SkillPanel");return _(),v("div",X,[p("button",{id:"print-btn",class:"btn btn-info",onClick:n[0]||(n[0]=a=>d.printPDF())}," Print "),p("div",K,[p("div",G,[w(u,{skill:r.skill},null,8,["skill"])]),Q])])}const Z=b(J,[["render",Y],["__scopeId","data-v-cb133569"]]);const C=p("div",{id:"purple-banner"},null,-1),ee=p("span",null,"Loading...",-1),ce={__name:"TidyTreeView",setup(s){return(n,l)=>(_(),v($,null,[C,(_(),R(U,null,{default:y(()=>[w(Z)]),fallback:y(()=>[ee]),_:1}))],64))}};export{ce as default};
