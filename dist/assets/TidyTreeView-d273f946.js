import{_ as W,o as T,c as X,p as q,a as K,b as y,u as nt,d as st,r as L,e as M,F as j,f as ot,w as Y,S as rt}from"./main-2321eba8.js";import{S as at,h as F,t as R,a as lt,l as H,s as dt,c as ct}from"./link-9cda6fd9.js";import"./transform-9f729428.js";const S=(e,t)=>{const i=t.x-e.x,s=t.y-e.y;return Math.sqrt(i*i+s*s)},pt=(e,t)=>{const i=t.x-e.x,s=t.y-e.y;return ht(Math.atan2(s,i))},ft=(e,t,i)=>{const s={x:0,y:0};return i=$(i),s.x=e.x-t*Math.cos(i),s.y=e.y-t*Math.sin(i),s},$=e=>e*(Math.PI/180),ht=e=>e*(180/Math.PI),ut=e=>isNaN(e.buttons)?e.pressure!==0:e.buttons!==0,z=new Map,A=e=>{z.has(e)&&clearTimeout(z.get(e)),z.set(e,setTimeout(e,100))},O=(e,t,i)=>{const s=t.split(/[ ,]+/g);let n;for(let o=0;o<s.length;o+=1)n=s[o],e.addEventListener?e.addEventListener(n,i,!1):e.attachEvent&&e.attachEvent(n,i)},J=(e,t,i)=>{const s=t.split(/[ ,]+/g);let n;for(let o=0;o<s.length;o+=1)n=s[o],e.removeEventListener?e.removeEventListener(n,i):e.detachEvent&&e.detachEvent(n,i)},Q=e=>(e.preventDefault(),e.type.match(/^touch/)?e.changedTouches:e),U=()=>{const e=window.pageXOffset!==void 0?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,t=window.pageYOffset!==void 0?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop;return{x:e,y:t}},V=(e,t)=>{t.top||t.right||t.bottom||t.left?(e.style.top=t.top,e.style.right=t.right,e.style.bottom=t.bottom,e.style.left=t.left):(e.style.left=t.x+"px",e.style.top=t.y+"px")},B=(e,t,i)=>{const s=Z(e);for(let n in s)if(s.hasOwnProperty(n))if(typeof t=="string")s[n]=t+" "+i;else{let o="";for(let c=0,r=t.length;c<r;c+=1)o+=t[c]+" "+i+", ";s[n]=o.slice(0,-2)}return s},yt=(e,t)=>{const i=Z(e);for(let s in i)i.hasOwnProperty(s)&&(i[s]=t);return i},Z=e=>{const t={};return t[e]="",["webkit","Moz","o"].forEach(function(s){t[s+e.charAt(0).toUpperCase()+e.slice(1)]=""}),t},D=(e,t)=>{for(let i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);return e},vt=(e,t)=>{const i={};for(let s in e)e.hasOwnProperty(s)&&t.hasOwnProperty(s)?i[s]=t[s]:e.hasOwnProperty(s)&&(i[s]=e[s]);return i},N=(e,t)=>{if(e.length)for(let i=0,s=e.length;i<s;i+=1)t(e[i]);else t(e)},mt=(e,t,i)=>({x:Math.min(Math.max(e.x,t.x-i),t.x+i),y:Math.min(Math.max(e.y,t.y-i),t.y+i)});var gt="ontouchstart"in window,xt=!!window.PointerEvent,_t=!!window.MSPointerEvent,w={touch:{start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},mouse:{start:"mousedown",move:"mousemove",end:"mouseup"},pointer:{start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"},MSPointer:{start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}},g,k={};xt?g=w.pointer:_t?g=w.MSPointer:gt?(g=w.touch,k=w.mouse):g=w.mouse;function v(){}v.prototype.on=function(e,t){var i=this,s=e.split(/[ ,]+/g),n;i._handlers_=i._handlers_||{};for(var o=0;o<s.length;o+=1)n=s[o],i._handlers_[n]=i._handlers_[n]||[],i._handlers_[n].push(t);return i};v.prototype.off=function(e,t){var i=this;return i._handlers_=i._handlers_||{},e===void 0?i._handlers_={}:t===void 0?i._handlers_[e]=null:i._handlers_[e]&&i._handlers_[e].indexOf(t)>=0&&i._handlers_[e].splice(i._handlers_[e].indexOf(t),1),i};v.prototype.trigger=function(e,t){var i=this,s=e.split(/[ ,]+/g),n;i._handlers_=i._handlers_||{};for(var o=0;o<s.length;o+=1)n=s[o],i._handlers_[n]&&i._handlers_[n].length&&i._handlers_[n].forEach(function(c){c.call(i,{type:n,target:i},t)})};v.prototype.config=function(e){var t=this;t.options=t.defaults||{},e&&(t.options=vt(t.options,e))};v.prototype.bindEvt=function(e,t){var i=this;return i._domHandlers_=i._domHandlers_||{},i._domHandlers_[t]=function(){typeof i["on"+t]=="function"?i["on"+t].apply(i,arguments):console.warn('[WARNING] : Missing "on'+t+'" handler.')},O(e,g[t],i._domHandlers_[t]),k[t]&&O(e,k[t],i._domHandlers_[t]),i};v.prototype.unbindEvt=function(e,t){var i=this;return i._domHandlers_=i._domHandlers_||{},J(e,g[t],i._domHandlers_[t]),k[t]&&J(e,k[t],i._domHandlers_[t]),delete i._domHandlers_[t],this};function f(e,t){return this.identifier=t.identifier,this.position=t.position,this.frontPosition=t.frontPosition,this.collection=e,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(t),this.options.mode==="dynamic"&&(this.options.restOpacity=0),this.id=f.id,f.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}f.prototype=new v;f.constructor=f;f.id=0;f.prototype.buildEl=function(e){return this.ui={},this.options.dataOnly?this:(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front),this)};f.prototype.stylize=function(){if(this.options.dataOnly)return this;var e=this.options.fadeTime+"ms",t=yt("borderRadius","50%"),i=B("transition","opacity",e),s={};return s.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},s.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},s.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},D(s.el,i),this.options.shape==="circle"&&D(s.back,t),D(s.front,t),this.applyStyles(s),this};f.prototype.applyStyles=function(e){for(var t in this.ui)if(this.ui.hasOwnProperty(t))for(var i in e[t])this.ui[t].style[i]=e[t][i];return this};f.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)?this:(this.options.zone.appendChild(this.ui.el),this)};f.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)?this:(this.options.zone.removeChild(this.ui.el),this)};f.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()};f.prototype.show=function(e){var t=this;return t.options.dataOnly||(clearTimeout(t.removeTimeout),clearTimeout(t.showTimeout),clearTimeout(t.restTimeout),t.addToDom(),t.restCallback(),setTimeout(function(){t.ui.el.style.opacity=1},0),t.showTimeout=setTimeout(function(){t.trigger("shown",t.instance),typeof e=="function"&&e.call(this)},t.options.fadeTime)),t};f.prototype.hide=function(e){var t=this;if(t.options.dataOnly)return t;if(t.ui.el.style.opacity=t.options.restOpacity,clearTimeout(t.removeTimeout),clearTimeout(t.showTimeout),clearTimeout(t.restTimeout),t.removeTimeout=setTimeout(function(){var i=t.options.mode==="dynamic"?"none":"block";t.ui.el.style.display=i,typeof e=="function"&&e.call(t),t.trigger("hidden",t.instance)},t.options.fadeTime),t.options.restJoystick){const i=t.options.restJoystick,s={};s.x=i===!0||i.x!==!1?0:t.instance.frontPosition.x,s.y=i===!0||i.y!==!1?0:t.instance.frontPosition.y,t.setPosition(e,s)}return t};f.prototype.setPosition=function(e,t){var i=this;i.frontPosition={x:t.x,y:t.y};var s=i.options.fadeTime+"ms",n={};n.front=B("transition",["transform"],s);var o={front:{}};o.front={transform:"translate("+i.frontPosition.x+"px,"+i.frontPosition.y+"px)"},i.applyStyles(n),i.applyStyles(o),i.restTimeout=setTimeout(function(){typeof e=="function"&&e.call(i),i.restCallback()},i.options.fadeTime)};f.prototype.restCallback=function(){var e=this,t={};t.front=B("transition","none",""),e.applyStyles(t),e.trigger("rested",e.instance)};f.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}};f.prototype.computeDirection=function(e){var t=e.angle.radian,i=Math.PI/4,s=Math.PI/2,n,o,c;if(t>i&&t<i*3&&!e.lockX?n="up":t>-i&&t<=i&&!e.lockY?n="left":t>-i*3&&t<=-i&&!e.lockX?n="down":e.lockY||(n="right"),e.lockY||(t>-s&&t<s?o="left":o="right"),e.lockX||(t>0?c="up":c="down"),e.force>this.options.threshold){var r={},a;for(a in this.direction)this.direction.hasOwnProperty(a)&&(r[a]=this.direction[a]);var l={};this.direction={x:o,y:c,angle:n},e.direction=this.direction;for(a in r)r[a]===this.direction[a]&&(l[a]=!0);if(l.x&&l.y&&l.angle)return e;(!l.x||!l.y)&&this.trigger("plain",e),l.x||this.trigger("plain:"+o,e),l.y||this.trigger("plain:"+c,e),l.angle||this.trigger("dir dir:"+n,e)}else this.resetDirection();return e};function p(e,t){var i=this;i.nipples=[],i.idles=[],i.actives=[],i.ids=[],i.pressureIntervals={},i.manager=e,i.id=p.id,p.id+=1,i.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},i.config(t),(i.options.mode==="static"||i.options.mode==="semi")&&(i.options.multitouch=!1),i.options.multitouch||(i.options.maxNumberOfNipples=1);const s=getComputedStyle(i.options.zone.parentElement);return s&&s.display==="flex"&&(i.parentIsFlex=!0),i.updateBox(),i.prepareNipples(),i.bindings(),i.begin(),i.nipples}p.prototype=new v;p.constructor=p;p.id=0;p.prototype.prepareNipples=function(){var e=this,t=e.nipples;t.on=e.on.bind(e),t.off=e.off.bind(e),t.options=e.options,t.destroy=e.destroy.bind(e),t.ids=e.ids,t.id=e.id,t.processOnMove=e.processOnMove.bind(e),t.processOnEnd=e.processOnEnd.bind(e),t.get=function(i){if(i===void 0)return t[0];for(var s=0,n=t.length;s<n;s+=1)if(t[s].identifier===i)return t[s];return!1}};p.prototype.bindings=function(){var e=this;e.bindEvt(e.options.zone,"start"),e.options.zone.style.touchAction="none",e.options.zone.style.msTouchAction="none"};p.prototype.begin=function(){var e=this,t=e.options;if(t.mode==="static"){var i=e.createNipple(t.position,e.manager.getIdentifier());i.add(),e.idles.push(i)}};p.prototype.createNipple=function(e,t){var i=this,s=i.manager.scroll,n={},o=i.options,c={x:i.parentIsFlex?s.x:s.x+i.box.left,y:i.parentIsFlex?s.y:s.y+i.box.top};if(e.x&&e.y)n={x:e.x-c.x,y:e.y-c.y};else if(e.top||e.right||e.bottom||e.left){var r=document.createElement("DIV");r.style.display="hidden",r.style.top=e.top,r.style.right=e.right,r.style.bottom=e.bottom,r.style.left=e.left,r.style.position="absolute",o.zone.appendChild(r);var a=r.getBoundingClientRect();o.zone.removeChild(r),n=e,e={x:a.left+s.x,y:a.top+s.y}}var l=new f(i,{color:o.color,size:o.size,threshold:o.threshold,fadeTime:o.fadeTime,dataOnly:o.dataOnly,restJoystick:o.restJoystick,restOpacity:o.restOpacity,mode:o.mode,identifier:t,position:e,zone:o.zone,frontPosition:{x:0,y:0},shape:o.shape});return o.dataOnly||(V(l.ui.el,n),V(l.ui.front,l.frontPosition)),i.nipples.push(l),i.trigger("added "+l.identifier+":added",l),i.manager.trigger("added "+l.identifier+":added",l),i.bindNipple(l),l};p.prototype.updateBox=function(){var e=this;e.box=e.options.zone.getBoundingClientRect()};p.prototype.bindNipple=function(e){var t=this,i,s=function(n,o){i=n.type+" "+o.id+":"+n.type,t.trigger(i,o)};e.on("destroyed",t.onDestroyed.bind(t)),e.on("shown hidden rested dir plain",s),e.on("dir:up dir:right dir:down dir:left",s),e.on("plain:up plain:right plain:down plain:left",s)};p.prototype.pressureFn=function(e,t,i){var s=this,n=0;clearInterval(s.pressureIntervals[i]),s.pressureIntervals[i]=setInterval(function(){var o=e.force||e.pressure||e.webkitForce||0;o!==n&&(t.trigger("pressure",o),s.trigger("pressure "+t.identifier+":pressure",o),n=o)}.bind(s),100)};p.prototype.onstart=function(e){var t=this,i=t.options,s=e;e=Q(e),t.updateBox();var n=function(o){t.actives.length<i.maxNumberOfNipples?t.processOnStart(o):s.type.match(/^touch/)&&(Object.keys(t.manager.ids).forEach(function(c){if(Object.values(s.touches).findIndex(function(a){return a.identifier===c})<0){var r=[e[0]];r.identifier=c,t.processOnEnd(r)}}),t.actives.length<i.maxNumberOfNipples&&t.processOnStart(o))};return N(e,n),t.manager.bindDocument(),!1};p.prototype.processOnStart=function(e){var t=this,i=t.options,s,n=t.manager.getIdentifier(e),o=e.force||e.pressure||e.webkitForce||0,c={x:e.pageX,y:e.pageY},r=t.getOrCreate(n,c);r.identifier!==n&&t.manager.removeIdentifier(r.identifier),r.identifier=n;var a=function(d){d.trigger("start",d),t.trigger("start "+d.id+":start",d),d.show(),o>0&&t.pressureFn(e,d,d.identifier),t.processOnMove(e)};if((s=t.idles.indexOf(r))>=0&&t.idles.splice(s,1),t.actives.push(r),t.ids.push(r.identifier),i.mode!=="semi")a(r);else{var l=S(c,r.position);if(l<=i.catchDistance)a(r);else{r.destroy(),t.processOnStart(e);return}}return r};p.prototype.getOrCreate=function(e,t){var i=this,s=i.options,n;return/(semi|static)/.test(s.mode)?(n=i.idles[0],n?(i.idles.splice(0,1),n):s.mode==="semi"?i.createNipple(t,e):(console.warn("Coudln't find the needed nipple."),!1)):(n=i.createNipple(t,e),n)};p.prototype.processOnMove=function(e){var t=this,i=t.options,s=t.manager.getIdentifier(e),n=t.nipples.get(s),o=t.manager.scroll;if(!ut(e)){this.processOnEnd(e);return}if(!n){console.error("Found zombie joystick with ID "+s),t.manager.removeIdentifier(s);return}if(i.dynamicPage){var c=n.el.getBoundingClientRect();n.position={x:o.x+c.left,y:o.y+c.top}}n.identifier=s;var r=n.options.size/2,a={x:e.pageX,y:e.pageY};i.lockX&&(a.y=n.position.y),i.lockY&&(a.x=n.position.x);var l=S(a,n.position),d=pt(a,n.position),x=$(d),P=l/r,u={distance:l,position:a},b,m;if(n.options.shape==="circle"?(b=Math.min(l,r),m=ft(n.position,b,d)):(m=mt(a,n.position,r),b=S(m,n.position)),i.follow){if(l>r){let et=a.x-m.x,it=a.y-m.y;n.position.x+=et,n.position.y+=it,n.el.style.top=n.position.y-(t.box.top+o.y)+"px",n.el.style.left=n.position.x-(t.box.left+o.x)+"px",l=S(a,n.position)}}else a=m,l=b;var C=a.x-n.position.x,E=a.y-n.position.y;n.frontPosition={x:C,y:E},i.dataOnly||(n.ui.front.style.transform="translate("+C+"px,"+E+"px)");var _={identifier:n.identifier,position:a,force:P,pressure:e.force||e.pressure||e.webkitForce||0,distance:l,angle:{radian:x,degree:d},vector:{x:C/r,y:-E/r},raw:u,instance:n,lockX:i.lockX,lockY:i.lockY};_=n.computeDirection(_),_.angle={radian:$(180-d),degree:180-d},n.trigger("move",_),t.trigger("move "+n.id+":move",_)};p.prototype.processOnEnd=function(e){var t=this,i=t.options,s=t.manager.getIdentifier(e),n=t.nipples.get(s),o=t.manager.removeIdentifier(n.identifier);n&&(i.dataOnly||n.hide(function(){i.mode==="dynamic"&&(n.trigger("removed",n),t.trigger("removed "+n.id+":removed",n),t.manager.trigger("removed "+n.id+":removed",n),n.destroy())}),clearInterval(t.pressureIntervals[n.identifier]),n.resetDirection(),n.trigger("end",n),t.trigger("end "+n.id+":end",n),t.ids.indexOf(n.identifier)>=0&&t.ids.splice(t.ids.indexOf(n.identifier),1),t.actives.indexOf(n)>=0&&t.actives.splice(t.actives.indexOf(n),1),/(semi|static)/.test(i.mode)?t.idles.push(n):t.nipples.indexOf(n)>=0&&t.nipples.splice(t.nipples.indexOf(n),1),t.manager.unbindDocument(),/(semi|static)/.test(i.mode)&&(t.manager.ids[o.id]=o.identifier))};p.prototype.onDestroyed=function(e,t){var i=this;i.nipples.indexOf(t)>=0&&i.nipples.splice(i.nipples.indexOf(t),1),i.actives.indexOf(t)>=0&&i.actives.splice(i.actives.indexOf(t),1),i.idles.indexOf(t)>=0&&i.idles.splice(i.idles.indexOf(t),1),i.ids.indexOf(t.identifier)>=0&&i.ids.splice(i.ids.indexOf(t.identifier),1),i.manager.removeIdentifier(t.identifier),i.manager.unbindDocument()};p.prototype.destroy=function(){var e=this;e.unbindEvt(e.options.zone,"start"),e.nipples.forEach(function(i){i.destroy()});for(var t in e.pressureIntervals)e.pressureIntervals.hasOwnProperty(t)&&clearInterval(e.pressureIntervals[t]);e.trigger("destroyed",e.nipples),e.manager.unbindDocument(),e.off()};function h(e){var t=this;t.ids={},t.index=0,t.collections=[],t.scroll=U(),t.config(e),t.prepareCollections();var i=function(){var n;t.collections.forEach(function(o){o.forEach(function(c){n=c.el.getBoundingClientRect(),c.position={x:t.scroll.x+n.left,y:t.scroll.y+n.top}})})};O(window,"resize",function(){A(i)});var s=function(){t.scroll=U()};return O(window,"scroll",function(){A(s)}),t.collections}h.prototype=new v;h.constructor=h;h.prototype.prepareCollections=function(){var e=this;e.collections.create=e.create.bind(e),e.collections.on=e.on.bind(e),e.collections.off=e.off.bind(e),e.collections.destroy=e.destroy.bind(e),e.collections.get=function(t){var i;return e.collections.every(function(s){return i=s.get(t),!i}),i}};h.prototype.create=function(e){return this.createCollection(e)};h.prototype.createCollection=function(e){var t=this,i=new p(t,e);return t.bindCollection(i),t.collections.push(i),i};h.prototype.bindCollection=function(e){var t=this,i,s=function(n,o){i=n.type+" "+o.id+":"+n.type,t.trigger(i,o)};e.on("destroyed",t.onDestroyed.bind(t)),e.on("shown hidden rested dir plain",s),e.on("dir:up dir:right dir:down dir:left",s),e.on("plain:up plain:right plain:down plain:left",s)};h.prototype.bindDocument=function(){var e=this;e.binded||(e.bindEvt(document,"move").bindEvt(document,"end"),e.binded=!0)};h.prototype.unbindDocument=function(e){var t=this;(!Object.keys(t.ids).length||e===!0)&&(t.unbindEvt(document,"move").unbindEvt(document,"end"),t.binded=!1)};h.prototype.getIdentifier=function(e){var t;return e?(t=e.identifier===void 0?e.pointerId:e.identifier,t===void 0&&(t=this.latest||0)):t=this.index,this.ids[t]===void 0&&(this.ids[t]=this.index,this.index+=1),this.latest=t,this.ids[t]};h.prototype.removeIdentifier=function(e){var t={};for(var i in this.ids)if(this.ids[i]===e){t.id=i,t.identifier=this.ids[i],delete this.ids[i];break}return t};h.prototype.onmove=function(e){var t=this;return t.onAny("move",e),!1};h.prototype.onend=function(e){var t=this;return t.onAny("end",e),!1};h.prototype.oncancel=function(e){var t=this;return t.onAny("end",e),!1};h.prototype.onAny=function(e,t){var i=this,s,n="processOn"+e.charAt(0).toUpperCase()+e.slice(1);t=Q(t);var o=function(r,a,l){l.ids.indexOf(a)>=0&&(l[n](r),r._found_=!0)},c=function(r){s=i.getIdentifier(r),N(i.collections,o.bind(null,r,s)),r._found_||i.removeIdentifier(s)};return N(t,c),!1};h.prototype.destroy=function(){var e=this;e.unbindDocument(!0),e.ids={},e.index=0,e.collections.forEach(function(t){t.destroy()}),e.off()};h.prototype.onDestroyed=function(e,t){var i=this;if(i.collections.indexOf(t)<0)return!1;i.collections.splice(i.collections.indexOf(t),1)};const G=new h,wt={create:function(e){return G.create(e)},factory:G};const kt={setup(){},data(){return{holdTime:1,interval:null,fps:10}},computed:{},async mounted(){var e=wt.create({zone:document.getElementById("panJoystick"),mode:"static",position:{left:"25%",top:"25%"},color:"blue"});const t=Math.floor(1e3/this.fps)+1;e.on("dir:up plain:up dir:left plain:left dir:down plain:down dir:right plain:right",(s,n)=>{switch(clearInterval(this.interval),n.direction.angle){case"right":this.interval=setInterval(()=>{this.$parent.panX=this.$parent.panX-20,this.$parent.drawTree()},t);break;case"left":this.interval=setInterval(()=>{this.$parent.panX=this.$parent.panX+20,this.$parent.drawTree()},t);break;case"up":this.interval=setInterval(()=>{this.$parent.panY=this.$parent.panY+20,this.$parent.drawTree()},t);break;case"down":this.interval=setInterval(()=>{this.$parent.panY=this.$parent.panY-20,this.$parent.drawTree()},t);break}}).on("end",(s,n)=>{clearInterval(this.interval)});let i=document.getElementById("zoomRange");i.step="0.1",i.addEventListener("mouseup",()=>{this.$parent.scale=i.value,this.$parent.drawTree()}),i.addEventListener("touchend",()=>{this.$parent.scale=i.value,this.$parent.drawTree()})},watch:{},methods:{}},tt=e=>(q("data-v-d9f53b95"),e=e(),K(),e),bt={id:"controlsWrapper"},St=tt(()=>y("div",{id:"panJoystick"},null,-1)),Tt=tt(()=>y("div",{class:"slidecontainer"},[y("input",{type:"range",min:"0.108",max:"2",value:"0.108",class:"slider",id:"zoomRange",step:"0.05"})],-1)),Ot=[St,Tt];function It(e,t,i,s,n,o){return T(),X("div",bt,Ot)}const Pt=W(kt,[["render",It],["__scopeId","data-v-d9f53b95"]]);const Ct={setup(){const e=nt(),t=st();return{userDetailsStore:e,skillTreeStore:t}},data(){return{width:6e3,height:null,skill:{id:null,children:[],isMastered:null,isUnlocked:null,container:null,name:null,description:null,tagIDs:[],sprite:null,type:null},tree:{},root:{},context:{},hiddenCanvasContext:{},scaleMultiplier:.8,startDragOffset:{x:0,y:0},mouseDown:!1,r:1.5,nodes:[],nextCol:1,colToNode:{},isSkillInfoPanelShown:!1,scale:1,panX:0,panY:0,hiddenCanvasInitiated:!1,data:{}}},components:{SkillPanel:at,JoystickControl:Pt},async mounted(){this.skillTreeStore.userSkills.length==0&&await this.skillTreeStore.getUserSkills(),this.height=window.innerHeight,this.skill={name:"SKILLS",sprite:null,children:this.skillTreeStore.userSkills},this.getAlgorithm();let e=document.getElementById("hidden-canvas");this.hiddenCanvasContext=e.getContext("2d"),e.style.display="none",canvas.addEventListener("click",t=>{this.nodes;var i=t.layerX,s=t.layerY,n=this.hiddenCanvasContext,o=n.getImageData(i,s,1,1).data,c="rgb("+o[0]+","+o[1]+","+o[2]+")",r=this.colToNode[c];r&&(r.renderCol=r.__pickColor,this.skill.name=r.data.skill_name,this.skill.id=r.data.id,this.skill.type=r.data.type,this.showInfoPanel())})},methods:{getAlgorithm(){var e=[];e=JSON.parse(JSON.stringify(this.skill.children));function t(a){for(var l=a.length;l--;){if(a[l].type=="super"&&a[l].position!="end"){var d=[],x=[];for(let u=0;u<a[l].children.length;u++)a[l].children[u].type=="sub"?d.push(a[l].children[u]):x.push(a[l].children[u]);var P={skill_name:a[l].skill_name,type:"super",position:"end",children:d};a[l].children=[],a[l].children.push(P);for(let u=0;u<x.length;u++)a[l].children.push(x[u])}typeof a[l]<"u"&&a[l].children&&Array.isArray(a[l].children)&&a[l].children.length>0&&t(a[l].children)}}t(e),this.data={skill_name:"My skills",children:e},this.root=F(this.data);const i=24,s=this.width/(this.root.height+1);this.tree=R().nodeSize([i,s]),this.root.sort((a,l)=>lt(a.data.name,l.data.name)),this.tree(this.root);let n=1/0,o=-n;this.root.each(a=>{a.x>o&&(o=a.x),a.x<n&&(n=a.x)});var c=document.getElementById("canvas");c.width=this.width,c.height=this.height,this.context=c.getContext("2d");let r=document.getElementById("hidden-canvas");this.hiddenCanvasContext=r.getContext("2d"),this.drawTree()},drawTree(){this.nodes=this.root.descendants(),this.context.save(),this.hiddenCanvasContext.save(),this.context.clearRect(0,0,this.context.canvas.width,this.context.canvas.height),this.hiddenCanvasContext.clearRect(0,0,this.hiddenCanvasContext.canvas.width,this.hiddenCanvasContext.canvas.height),this.context.scale(this.scale,this.scale),this.hiddenCanvasContext.scale(this.scale,this.scale),this.context.translate(this.panX,this.panY),this.hiddenCanvasContext.translate(this.panX,this.panY);const e=this.root.links();this.context.beginPath();for(const t of e)this.drawLink(t);this.context.beginPath();for(const t of this.nodes)t.renderCol?this.context.fillStyle=t.renderCol:this.context.fillStyle="RGBA(105, 105, 105, 0.8)",t.__pickColor===void 0&&(t.__pickColor=this.genColor(),this.colToNode[t.__pickColor]=t),this.hiddenCanvasContext.fillStyle=t.__pickColor,this.drawNode(t);this.hiddenCanvasContext.restore(),this.context.restore()},drawNode(e){let t=this.context,i=this.hiddenCanvasContext;t.beginPath(),t.moveTo(e.y,e.x),t.arc(e.y,e.x,10,0,2*Math.PI),t.fillStyle="#000",t.fill(),this.scale>.6&&(t.beginPath(),t.strokeStyle="#FFF",t.lineWidth=4,t.strokeText(e.data.skill_name,e.y+10,e.x+2),t.fillStyle="#000",t.fillText(e.data.skill_name,e.y+10,e.x+2)),i.beginPath(),i.moveTo(e.y,e.x),i.arc(e.y,e.x,10,0,2*Math.PI),i.fill()},drawLink(e){const t=H().x(i=>i.y).y(i=>i.x).context(this.context);e.target.data.is_mastered==1?this.context.lineWidth=4:this.context.lineWidth=1,e.source.data.type=="super"&&e.target.data.position=="end"||e.target.data.type=="sub"?this.context.setLineDash([5,3]):this.context.setLineDash([]),this.context.beginPath(),t(e),this.context.strokeStyle="#000",this.context.stroke()},genColor(){var e=[];this.nextCol<16777215&&(e.push(this.nextCol&255),e.push((this.nextCol&65280)>>8),e.push((this.nextCol&16711680)>>16),this.nextCol+=100);var t="rgb("+e.join(",")+")";return t},showInfoPanel(){this.isSkillInfoPanelShown||(this.isSkillInfoPanelShown=!0,screen.width>800?document.getElementById("skillInfoPanel").style.width="474px":document.getElementById("skillInfoPanel").style.height="474px")},hideInfoPanel(){this.isSkillInfoPanelShown&&(screen.width>800?document.getElementById("skillInfoPanel").style.width="0px":document.getElementById("skillInfoPanel").style.height="0px",document.getElementById("sidepanel-backdrop").style.display="none",this.isSkillInfoPanelShown=!1)},async printPDF(){await this.createSVGTree();var e=document.getElementById("linearTree"),t=dt(e),i=t.node(),s=new XMLSerializer,n=s.serializeToString(i),o={svg:n,treeType:"linear"},c=JSON.stringify(o),r=new XMLHttpRequest;r.responseType="arraybuffer",r.open("POST","/skilltree/print-pdf",!0),r.setRequestHeader("Content-type","application/json;charset=UTF-8"),r.setRequestHeader("Accept","application/json, text/plain, */*"),r.send(c),r.onload=function(){if(this.readyState==4&&this.status==200){let l=new Blob([r.response],{type:"application/pdf"});const d=window.URL.createObjectURL(l);var a=document.createElement("a");document.body.appendChild(a),a.style="display: none",a.href=d,a.download="My-Skill-Tree.pdf",a.click(),window.URL.revokeObjectURL(d)}}},createSVGTree(){const e=F(this.data),t=15,i=this.width/(e.height+1);R().nodeSize([t,i])(e);let n=1/0,o=-n;e.each(d=>{d.x>o&&(o=d.x),d.x<n&&(n=d.x)});const c=o-n+t*2;let r=ct("svg").attr("id","linearTree").attr("width",this.width).attr("height",c).attr("viewBox",[-i/3,n-t,this.width,c]).attr("style","max-width: 100%; height: auto; font: 10px sans-serif;");const a=r.append("g");a.append("g").attr("fill","none").attr("stroke-opacity",1).selectAll().data(e.links()).join("path").attr("d",H().x(d=>d.y).y(d=>d.x)).attr("stroke",function(d){return"#000"}).attr("stroke-width",function(d){return d.target.data.is_mastered==1?8:1.5}).style("stroke-dasharray",function(d){if(d.source.data.type=="super"&&d.target.data.position=="end"||d.target.data.type=="sub")return 5});const l=a.append("g").attr("stroke-linejoin","round").attr("stroke-width",3).selectAll().data(e.descendants()).join("g").attr("transform",d=>`translate(${d.y},${d.x})`);l.append("circle").attr("fill",d=>d.children?"#555":"#000").attr("r",2.5),l.append("text").style("font-weight",function(d){return d.data.type=="super"?"700":"400"}).style("font-style",function(d){if(d.data.type=="sub")return"italic"}).attr("dy","0.31em").attr("x",d=>d.children?-6:6).attr("text-anchor",d=>d.children?"end":"start").text(function(d){return d.data.position=="end"?"":d.data.skill_name}).clone(!0).lower().attr("stroke",function(d){return"white"}),document.querySelector("#SVGskilltree").append(r.node())}}},I=e=>(q("data-v-a1c4f95c"),e=e(),K(),e),Et={id:"wrapper"},zt=I(()=>y("canvas",{id:"canvas",width:"1500",height:"1500"},null,-1)),Dt=I(()=>y("canvas",{id:"hidden-canvas",width:"1500",height:"1500"},null,-1)),Mt=I(()=>y("div",{id:"SVGskilltree"},null,-1)),$t=I(()=>y("div",{id:"sidepanel-backdrop"},null,-1));function Nt(e,t,i,s,n,o){const c=L("SkillPanel"),r=L("JoystickControl");return T(),X(j,null,[y("button",{id:"print-btn",class:"btn btn-info",onClick:t[0]||(t[0]=a=>o.printPDF())}," Print "),y("div",Et,[M(c,{skill:n.skill},null,8,["skill"]),zt,Dt,Mt,M(r),$t])],64)}const Xt=W(Ct,[["render",Nt],["__scopeId","data-v-a1c4f95c"]]);const Bt=y("div",{id:"thin-purple-banner"},null,-1),Lt=y("span",null,"Loading...",-1),Ht={__name:"TidyTreeView",setup(e){return(t,i)=>(T(),X(j,null,[Bt,(T(),ot(rt,null,{default:Y(()=>[M(Xt)]),fallback:Y(()=>[Lt]),_:1}))],64))}};export{Ht as default};
