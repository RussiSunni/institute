import{_ as h,k as f,o as u,c as d,a as e,w as n,l as m,C as c,F as _,r as p,t as v,n as g,j as k}from"./main-b39c1666.js";import{u as b}from"./SkillsStore-057aa5de.js";import{u as S}from"./UsersStore-03aa775a.js";const I={setup(){const t=b(),s=S();return{skillsStore:t,usersStore:s}},data(){return{user:{},image:"",firstLevelSkillIds:[],childrenOfFirstLevelSkillsIds:[],newUserId:null,isValidated:!1,instructors:[],instructorId:null}},async created(){this.skillsStore.skillsList.length<1&&await this.skillsStore.getSkillsList();for(let t=0;t<this.skillsStore.skillsList.length;t++)this.skillsStore.skillsList[t].hierarchy_level==1&&this.firstLevelSkillIds.push(this.skillsStore.skillsList[t].id);for(let t=0;t<this.skillsStore.skillsList.length;t++)for(let s=0;s<this.firstLevelSkillIds.length;s++)this.skillsStore.skillsList[t].parent==this.firstLevelSkillIds[s]&&this.childrenOfFirstLevelSkillsIds.push(this.skillsStore.skillsList[t].id)},async mounted(){this.usersStore.users.length<1&&await this.usersStore.getUsers(),this.getInstructors()},methods:{getInstructors(){for(let t=0;t<this.usersStore.users.length;t++)this.usersStore.users[t].role=="instructor"&&this.instructors.push(this.usersStore.users[t])},ValidateForm(){this.user.first_name==""||this.user.first_name==null?alert("Please add a first name."):this.user.last_name==""||this.user.last_name==null?alert("Please add a last name."):this.user.username==""||this.user.username==null?alert("Please add a username."):this.user.email==""||this.user.email==null?alert("Please add am email address."):this.Submit()},ValidateEmail(){/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/.test(this.user.email)||alert("Please enter a valid email address")},Submit(){const t={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({firstname:this.user.first_name,lastname:this.user.last_name,username:this.user.username,email:this.user.email,avatar:this.user.avatar,password:this.user.password,role:this.user.role})};var s="/users/add";fetch(s,t).then(function(i){return i.json()}).then(i=>{i.account=="username already taken"||i.account=="email already taken"?alert(i.account):(alert("account created"),this.usersStore.getUsers(),f.push({name:"users"}),this.isValidated=!0),this.newUserId=i.id}).then(i=>{if(this.isValidated)for(let l=0;l<this.firstLevelSkillIds.length;l++){var a="/user-skills/accessible/"+this.newUserId+"/"+this.firstLevelSkillIds[l];fetch(a)}}).then(i=>{if(this.user.role=="student"){const l={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({instructor_id:this.instructorId,student_id:this.newUserId})};var a="/users/add/instructor";fetch(a,l)}})},onFileChange(t){var s=t.target.files||t.dataTransfer.files;s.length&&this.createImage(s[0])},createImage(t){new Image;var s=new FileReader,i=this;s.onload=a=>{i.image=a.target.result,this.image=a.target.result,this.user.avatar=this.image},s.readAsDataURL(t)},removeImage:function(t){this.image="",this.user.avatar=this.image}}},w={class:"container mt-3"},y=e("h1",null,"Add User",-1),L={class:"row"},U={class:"col-sm-4"},V={class:"mb-3"},x=e("label",{for:"first_name",class:"form-label"},"First Name",-1),F={class:"mb-3"},C=e("label",{for:"last_name",class:"form-label"},"Last Name",-1),O={class:"mb-3"},P=e("label",{class:"form-label"},"Username",-1),N={class:"mb-3"},T=e("label",{class:"form-label"},"Email address",-1),j={class:"mb-3 row"},A=e("label",{class:"form-label"},"Avatar",-1),B={key:0},E=e("p",{style:{"font-size":"14px"}},[e("em",null,"Maximum file size 15mb")],-1),R={key:1},D=["src"],M={class:"mb-3"},q=e("label",{class:"form-label"},"Role",-1),z=e("option",{value:"admin"},"admin",-1),J=e("option",{value:"instructor"},"instructor",-1),G=e("option",{value:"student"},"student",-1),H=[z,J,G],K={key:0,class:"mb-3"},Q=e("label",{class:"form-label"},"Instructor",-1),W=["value"],X={class:"mb-3"},Y=e("label",{class:"form-label"},"Password",-1);function Z(t,s,i,a,l,o){return u(),d("div",w,[y,e("div",L,[e("div",U,[e("div",V,[x,n(e("input",{"onUpdate:modelValue":s[0]||(s[0]=r=>l.user.first_name=r),type:"text",class:"form-control"},null,512),[[m,l.user.first_name]])]),e("div",F,[C,n(e("input",{"onUpdate:modelValue":s[1]||(s[1]=r=>l.user.last_name=r),type:"text",class:"form-control"},null,512),[[m,l.user.last_name]])]),e("div",O,[P,n(e("input",{"onUpdate:modelValue":s[2]||(s[2]=r=>l.user.username=r),type:"text",class:"form-control"},null,512),[[m,l.user.username]])]),e("div",N,[T,n(e("input",{"onUpdate:modelValue":s[3]||(s[3]=r=>l.user.email=r),type:"email",class:"form-control",onBlur:s[4]||(s[4]=(...r)=>o.ValidateEmail&&o.ValidateEmail(...r))},null,544),[[m,l.user.email]])]),e("div",j,[A,l.image?(u(),d("div",R,[e("p",null,[e("img",{src:l.image,height:"200",style:{"background-color":"lightgrey"}},null,8,D)]),e("p",null,[e("button",{class:"btn btn-warning",onClick:s[6]||(s[6]=(...r)=>o.removeImage&&o.removeImage(...r))},"Remove image")])])):(u(),d("div",B,[e("input",{class:"form-control",type:"file",accept:"image/*",onChange:s[5]||(s[5]=(...r)=>o.onFileChange&&o.onFileChange(...r))},null,32),E]))]),e("div",M,[q,n(e("select",{"onUpdate:modelValue":s[7]||(s[7]=r=>l.user.role=r),class:"form-select"},H,512),[[c,l.user.role]])]),l.user.role=="student"?(u(),d("div",K,[Q,n(e("select",{"onUpdate:modelValue":s[8]||(s[8]=r=>l.instructorId=r),class:"form-select"},[(u(!0),d(_,null,p(l.instructors,r=>(u(),d("option",{value:r.id},v(r.username),9,W))),256))],512),[[c,l.instructorId]])])):g("",!0),e("div",X,[Y,n(e("input",{"onUpdate:modelValue":s[9]||(s[9]=r=>l.user.password=r),type:"text",class:"form-control"},null,512),[[m,l.user.password]])]),e("button",{class:"btn btn-dark",onClick:s[10]||(s[10]=r=>o.ValidateForm())},"Submit")])])])}const $=h(I,[["render",Z]]),ls={__name:"AddUserView",setup(t){return(s,i)=>(u(),k($))}};export{ls as default};
