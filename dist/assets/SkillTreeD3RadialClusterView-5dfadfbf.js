import{_ as k,u as v,S as y,r as x,o as g,c as _,b as p,a as m,p as w,d as T,e as b,f as S,g as R,F as I}from"./main-5654a60e.js";import{u as M}from"./SkillTreeStore-3c743cda.js";import{u as z,S as P,h as L}from"./transform-2c764ffe.js";import{S as N}from"./fontfaceobserver.standalone-2f9819b3.js";import{c as $,l as A,z as j,s as B}from"./zoom-01382c06.js";function D(t,r){return t.parent===r.parent?1:2}function U(t){return t.reduce(O,0)/t.length}function O(t,r){return t+r.x}function F(t){return 1+t.reduce(q,0)}function q(t,r){return Math.max(t,r.y)}function E(t){for(var r;r=t.children;)t=r[0];return t}function V(t){for(var r;r=t.children;)t=r[r.length-1];return t}function X(){var t=D,r=1,n=1,u=!1;function a(i){var d,o=0;i.eachAfter(function(l){var f=l.children;f?(l.x=U(f),l.y=F(f)):(l.x=d?o+=t(l,d):0,l.y=0,d=l)});var s=E(i),h=V(i),e=s.x-t(s,h)/2,c=h.x+t(h,s)/2;return i.eachAfter(u?function(l){l.x=(l.x-i.x)*r,l.y=(i.y-l.y)*n}:function(l){l.x=(l.x-e)/(c-e)*r,l.y=(1-(i.y?l.y/i.y:1))*n})}return a.separation=function(i){return arguments.length?(t=i,a):t},a.size=function(i){return arguments.length?(u=!1,r=+i[0],n=+i[1],a):u?null:[r,n]},a.nodeSize=function(i){return arguments.length?(u=!0,r=+i[0],n=+i[1],a):u?[r,n]:null},a}const C={setup(){const t=v(),r=M(),n=z();return{userDetailsStore:t,skillTreeStore:r,skillTagsStore:n}},data(){return{stageContents:[],isSkillInfoPanelShown:!1,width:null,height:null,radiusMultiplier:1,firstLevelNodeSize:100,regularNodeSize:50,subSkillRadius:50,skill:{id:null,children:[],isMastered:null,isUnlocked:null,container:null,name:null,description:null,tagIDs:[],sprite:null},isRecentered:!1}},components:{SkillTreeFilter:P,SkillPanel:N},async mounted(){this.skillTreeStore.userSkills.length==0&&await this.skillTreeStore.getUserSkills(),this.width=2e4,this.height=2e4,this.radius=Math.min(this.width,this.height)/2;const t=y.from("center-node.png");this.skill={name:"SKILLS",sprite:t,children:this.skillTreeStore.userSkills},this.getAlgorithm()},methods:{getAlgorithm(){var t=[];t=JSON.parse(JSON.stringify(this.skill.children));function r(e){for(var c=e.length;c--;)e[c].type=="sub"&&e.splice(c,1),typeof e[c]<"u"&&e[c].children&&Array.isArray(e[c].children)&&e[c].children.length>0&&r(e[c].children)}r(t);var n={name:null,children:t};const a=X().size([2*Math.PI,this.radius*this.radiusMultiplier]).separation((e,c)=>(e.parent==c.parent,1/e.depth))(L(n)),i=this.width*.5,d=this.height*.52,o=$("svg").attr("id","radialTree").attr("width",this.width).attr("height",this.height).attr("viewBox",[-i,-d,this.width,this.height]).attr("style","width: 100%; height: auto; font: 10px sans-serif;"),s=o.append("g");s.append("g").attr("fill","none").attr("stroke","#000").attr("stroke-opacity",1).selectAll().data(a.links()).join("path").attr("d",A().angle(e=>e.x).radius(e=>e.y)).attr("stroke-width",function(e){return e.target.data.is_mastered==1?8:2}),s.append("g").selectAll().data(a.descendants()).join("circle").attr("transform",e=>`rotate(${e.x*180/Math.PI-90}) translate(${e.y},0)`).attr("fill",function(e){if(e.depth==0)return"lightgreen";if(e.data.type=="domain")return"orange";if(e.data.level=="grade_school")return"yellow";if(e.data.level=="middle_school")return"lightblue";if(e.data.level=="high_school")return"green";if(e.data.level=="college")return"red";if(e.data.level=="phd")return"purple"}).attr("r",function(e){return e.depth==0?50:e.data.type=="domain"?20:5}),s.append("g").attr("stroke-linejoin","round").attr("stroke-width",3).selectAll().data(a.descendants()).join("text").attr("transform",e=>`rotate(${e.x*180/Math.PI-90}) translate(${e.y},0) rotate(${e.x>=Math.PI?180:0})`).attr("dy","0.31em").attr("x",e=>e.x<Math.PI==!e.children?6:-6).attr("text-anchor",e=>e.x<Math.PI==!e.children?"start":"end").attr("paint-order","stroke").attr("stroke","white").attr("fill","currentColor").text(e=>e.data.skill_name),o.call(j().extent([[0,0],[this.width,this.height]]).scaleExtent([1e-4,20]).on("zoom",h));function h({transform:e}){s.attr("transform",e)}document.querySelector("#skilltree").append(o.node())},printPDF(){var t=document.getElementById("radialTree"),r=B(t),n=r.node(),u=new XMLSerializer,a=u.serializeToString(n),i={svg:a,treeType:"radial"},d=JSON.stringify(i),o=new XMLHttpRequest;o.responseType="arraybuffer",o.open("POST","/skilltree/print-pdf",!0),o.setRequestHeader("Content-type","application/json;charset=UTF-8"),o.setRequestHeader("Accept","application/json, text/plain, */*"),o.send(d),o.onload=function(){if(this.readyState==4&&this.status==200){let h=new Blob([o.response],{type:"application/pdf"});const e=window.URL.createObjectURL(h);var s=document.createElement("a");document.body.appendChild(s),s.style="display: none",s.href=e,s.download="My-Skill-Tree.pdf",s.click(),window.URL.revokeObjectURL(e)}}}}},H=t=>(w("data-v-0b3210ed"),t=t(),T(),t),J={class:"flex-container skill-tree-container"},Y={id:"wrapper"},K={id:"skilltree"},G=H(()=>p("div",{id:"sidepanel-backdrop"},null,-1));function Q(t,r,n,u,a,i){const d=x("SkillPanel");return g(),_("div",J,[p("div",Y,[p("div",K,[m(d,{skill:a.skill},null,8,["skill"])]),G])])}const W=k(C,[["render",Q],["__scopeId","data-v-0b3210ed"]]);const Z=p("div",{id:"purple-banner"},null,-1),ee=p("span",null,"Loading...",-1),ne={__name:"SkillTreeD3RadialClusterView",setup(t){return(r,n)=>(g(),_(I,null,[Z,(g(),b(R,null,{default:S(()=>[m(W)]),fallback:S(()=>[ee]),_:1}))],64))}};export{ne as default};
