import{S as y,j as B,k as R,_ as q,u as A,l as C,m as j,n as o,q as S,s as x,C as _,T as w,x as M,A as E,B as U,G as v,y as O,e as F,o as p,c as I,a as g,h as P,F as T,p as V,b as J,f as W,g as b,z as D}from"./main-42d77791.js";function N(t){return typeof t=="string"?new y([[document.querySelector(t)]],[document.documentElement]):new y([[t]],B)}function H(t){return N(R(t).call(document.documentElement))}const X={setup(){const t=A(),r=C();return{userDetailsStore:t,skillTreeStore:r}},data(){return{width:null,height:null,skill:{id:null,children:[],isMastered:null,isUnlocked:null,name:null},tree:{},root:{},isSkillInfoPanelShown:!1,dx:null,dy:null,data:{},radius:0,radiusMultiplier:256,firstLevelNodeSize:400,secondLevelNodeSize:100,regularNodeSize:50,subSkillRadius:50,sprite:{domainNode:null}}},components:{SkillPanel:j},created(){this.$pixiApp.start()},async mounted(){this.skillTreeStore.userSkillsSubSkillsSeparate.length==0&&await this.skillTreeStore.getUserSkillsSubSkillsSeparate(),this.sprite.domainNode=o.from("images/skill-tree-nodes/domain.png"),this.$radialTreeContainer.children.length==0&&(this.width=window.innerWidth,this.height=window.innerHeight,this.radius=Math.min(this.width,this.height)/2-30,this.skill={name:"SKILLS",sprite:null,children:this.skillTreeStore.userSkillsSubSkillsSeparate},this.getAlgorithm()),document.querySelector("#skilltree").appendChild(this.$pixiApp.view)},methods:{handelNodeSprite(t,r,s){t.anchor.set(.5),r.depth==1?(t.width=this.firstLevelNodeSize,t.height=this.firstLevelNodeSize):r.depth==2?(t.width=this.secondLevelNodeSize,t.height=this.secondLevelNodeSize):(t.width=this.regularNodeSize,t.height=this.regularNodeSize),s.addChild(t),t.eventMode="static",t.cursor="pointer",t.on("pointerdown",h=>{var a={id:r.data.id,isMastered:r.data.is_mastered,isUnlocked:r.data.is_accessible,name:r.data.skill_name,masteryRequirements:r.data.mastery_requirements,type:r.data.type};this.skill=a,this.isSkillInfoPanelShown||this.showInfoPanel()})},getAlgorithm(){var t=[];t=JSON.parse(JSON.stringify(this.skill.children)),this.data={skill_name:"My skills",children:t};const r=S().size([2*Math.PI,this.radius*this.radiusMultiplier]).separation((s,h)=>(s.parent==h.parent?1:2)/s.depth);this.root=r(x(this.data)),this.drawTree()},drawTree(){const t=o.from("center-node.png");t.x=this.root.x,t.y=this.root.y,t.anchor.set(.5);const r=this.root.descendants(),s=this.root.links();this.drawCircle(this.root);for(const h of s)this.drawLink(h);this.$radialTreeContainer.addChild(t);for(const h of r)this.drawNode(h)},drawNode(t){let r=new _;r.x=Math.cos(t.x)*t.y,r.y=Math.sin(t.x)*t.y,this.$radialTreeContainer.addChild(r);var s=new o;if(t.data.level=="grade_school"?t.data.is_mastered?s=o.from("images/skill-tree-nodes/grade-school-mastered.png"):t.data.is_accessible?s=o.from("images/skill-tree-nodes/grade-school-unlocked.png"):s=o.from("images/skill-tree-nodes/grade-school-locked.png"):t.data.level=="middle_school"?t.data.is_mastered?s=o.from("images/skill-tree-nodes/middle-school-mastered.png"):t.data.is_accessible?s=o.from("images/skill-tree-nodes/middle-school-unlocked.png"):s=o.from("images/skill-tree-nodes/middle-school-locked.png"):t.data.level=="high_school"?t.data.is_mastered?s=o.from("images/skill-tree-nodes/high-school-mastered.png"):t.data.is_accessible?s=o.from("images/skill-tree-nodes/middle-school-unlocked.png"):s=o.from("images/skill-tree-nodes/middle-school-locked.png"):t.data.level=="college"?t.data.is_mastered?s=o.from("images/skill-tree-nodes/college-mastered.png"):t.data.is_accessible?s=o.from("images/skill-tree-nodes/middle-school-unlocked.png"):s=o.from("images/skill-tree-nodes/middle-school-locked.png"):t.data.level=="phd"?t.data.is_mastered?s=o.from("images/skill-tree-nodes/phd-mastered.png"):t.data.is_accessible?s=o.from("images/skill-tree-nodes/middle-school-unlocked.png"):s=o.from("images/skill-tree-nodes/middle-school-locked.png"):t.data.level=="domain"&&(s=o.from("images/skill-tree-nodes/domain.png")),s.anchor.set(.5),t.depth==1?(s.width=this.firstLevelNodeSize,s.height=this.firstLevelNodeSize):t.depth==2?(s.width=this.secondLevelNodeSize,s.height=this.secondLevelNodeSize):(s.width=this.regularNodeSize,s.height=this.regularNodeSize),r.addChild(s),s.eventMode="static",s.cursor="pointer",s.on("pointerdown",e=>{var i={id:t.data.id,isMastered:t.data.is_mastered,isUnlocked:t.data.is_accessible,name:t.data.skill_name,masteryRequirements:t.data.mastery_requirements,type:t.data.type};this.skill=i,this.isSkillInfoPanelShown||this.showInfoPanel()}),t.data.subskills)for(let e=0;e<t.data.subskills.length;e++){let i=new _,c=360/t.data.subskills.length*e,f=c*Math.PI/180,m=this.subSkillRadius*Math.cos(f),z=this.subSkillRadius*Math.sin(f);i.x=m,i.y=z;var s=new o;t.data.level=="grade_school"?t.data.is_mastered?s=o.from("images/skill-tree-nodes/grade-school-small-mastered.png"):t.data.is_accessible?s=o.from("images/skill-tree-nodes/grade-school-small-unlocked.png"):s=o.from("images/skill-tree-nodes/grade-school-small-locked.png"):t.data.level=="middle_school"?t.data.is_mastered?s=o.from("images/skill-tree-nodes/middle-school-small-mastered.png"):t.data.is_accessible?s=o.from("images/skill-tree-nodes/middle-school-small-unlocked.png"):s=o.from("images/skill-tree-nodes/middle-school-small-locked.png"):t.data.level=="high_school"?t.data.is_mastered?s=o.from("images/skill-tree-nodes/high-school-small-mastered.png"):t.data.is_accessible?s=o.from("images/skill-tree-nodes/high-school-small-unlocked.png"):s=o.from("images/skill-tree-nodes/high-school-small-locked.png"):t.data.level=="college"?t.data.is_mastered?s=o.from("images/skill-tree-nodes/college-smal-mastered.png"):t.data.is_accessible?s=o.from("images/skill-tree-nodes/college-small-unlocked.png"):s=o.from("images/skill-tree-nodes/college-small-locked.png"):t.data.level=="phd"&&(t.data.is_mastered?s=o.from("images/skill-tree-nodes/phd-small-mastered.png"):t.data.is_accessible?s=o.from("images/skill-tree-nodes/phd-small-unlocked.png"):s=o.from("images/skill-tree-nodes/phd-small-locked.png")),s.width=15,s.height=15,s.anchor.set(.5),s.eventMode="static",s.cursor="pointer",s.on("pointerdown",ie=>{var $={id:t.data.subskills[e].id,isMastered:t.data.subskills[e].is_mastered,isUnlocked:t.data.subskills[e].is_accessible,name:t.data.subskills[e].skill_name,masteryRequirements:t.data.subskills[e].mastery_requirements,type:t.data.subskills[e].type};this.skill=$,this.isSkillInfoPanelShown||this.showInfoPanel()}),i.addChild(s);const L=new w({fontFamily:"Poppins900",fontSize:"10",fill:"white",align:"center",strokeThickness:2,stroke:"black"}),k=new M(t.data.subskills[e].skill_name,L);k.angle=c,i.addChild(k),r.addChild(i)}let h,a;t.depth==0?(h=200,a="#000000"):t.depth==1?(h=150,a="#ffffff"):(h=120,a="#ffffff");const n=new w({fontFamily:"Poppins900",fontSize:h,fill:a,align:"center",strokeThickness:6,stroke:"black"});if(t.depth==0){const e=new M(t.data.skill_name,n);e.anchor.set(.5,.5),e.scale.set(.5,.5),r.addChild(e);return}E.load("/font/Poppins Bold White.xml").then(()=>{const e=new U(t.data.skill_name,{fontName:"Poppins-White-Bold",fontSize:h,align:"right"});t.depth==0||t.depth==1?e.anchor.set(.5,.5):t.depth==2?(e.angle=t.x*180/Math.PI-90,r.x>0?(e.angle=e.angle+90,t.children?(e.anchor.set(1,.5),e.x=e.x-80*Math.cos(e.rotation),e.y=e.y-80*Math.sin(e.rotation),e.x=e.x-20*Math.cos(e.rotation+Math.PI/2),e.y=e.y-20*Math.sin(e.rotation+Math.PI/2)):(e.anchor.set(0,.5),e.x=e.x+80*Math.cos(e.rotation),e.y=e.y+80*Math.sin(e.rotation),e.x=e.x-20*Math.cos(e.rotation+Math.PI/2),e.y=e.y-20*Math.sin(e.rotation+Math.PI/2))):(e.anchor.set(0,.5),e.angle=e.angle-90,t.children?(e.x=e.x+80*Math.cos(e.rotation),e.y=e.y+80*Math.sin(e.rotation),e.x=e.x-20*Math.cos(e.rotation+Math.PI/2),e.y=e.y-20*Math.sin(e.rotation+Math.PI/2)):(e.anchor.set(1,.5),e.x=e.x-80*Math.cos(e.rotation),e.y=e.y-80*Math.sin(e.rotation),e.x=e.x+20*Math.cos(e.rotation+Math.PI/2),e.y=e.y+20*Math.sin(e.rotation+Math.PI/2)))):t.depth>2&&(e.angle=t.x*180/Math.PI-90,r.x>0?(e.angle=e.angle+90,t.children?(e.anchor.set(1,.5),e.x=e.x-50*Math.cos(e.rotation),e.y=e.y-50*Math.sin(e.rotation),e.x=e.x+20*Math.cos(e.rotation+Math.PI/2),e.y=e.y-20*Math.sin(e.rotation+Math.PI/2)):(e.anchor.set(0,.5),e.x=e.x+50*Math.cos(e.rotation),e.y=e.y+50*Math.sin(e.rotation),e.x=e.x-20*Math.cos(e.rotation+Math.PI/2),e.y=e.y-20*Math.sin(e.rotation+Math.PI/2))):(e.anchor.set(0,.5),e.angle=e.angle-90,t.children?(e.x=e.x+50*Math.cos(e.rotation),e.y=e.y+50*Math.sin(e.rotation),e.x=e.x-20*Math.cos(e.rotation+Math.PI/2),e.y=e.y-20*Math.sin(e.rotation+Math.PI/2)):(e.anchor.set(1,.5),e.x=e.x-50*Math.cos(e.rotation),e.y=e.y-50*Math.sin(e.rotation),e.x=e.x-20*Math.cos(e.rotation+Math.PI/2),e.y=e.y-20*Math.sin(e.rotation+Math.PI/2)))),e.scale.set(.5,.5),r.addChild(e)})},drawLink(t){const r=new v;let s=0,h=7434618;t.target.data.is_mastered=="1"?(s=23,h=16777215):s=15,r.lineStyle(s,h,.85);var a=Math.cos(t.source.x)*t.source.y,n=Math.sin(t.source.x)*t.source.y;r.moveTo(a,n);var e=Math.cos(t.target.x)*t.target.y,i=Math.sin(t.target.x)*t.target.y;let l,d,c,f;const m=Math.abs(i)/Math.sqrt(i*i+e*e)*(180/Math.PI);a===0?(l=a,d=4500,c=e-800,f=i*c/e,m>45&&m<90&&(i<0?(f=i+1500,c=f*e/i):(f=i-1500,c=f*e/i))):a>0?(l=a+1500,d=n*l/a,c=e-2e3,e<0&&(c=e+2e3),f=i*c/e,m>45&&m<90&&(i<0?(d=n-1500,l=d*a/n,f=i+2e3,i>0&&(i=i-2e3),c=f*e/i):(d=n+1500,l=d*a/n,f=i-2e3,i<0&&(i=i+2e3),c=f*e/i))):(l=a-1500,d=n*l/a,c=e+2e3,e>0&&(c=e-2e3),f=i*c/e,m>45&&m<90&&(i<0?(d=n-1500,l=d*a/n,f=i+2e3,i>0&&(i=i-2e3),c=f*e/i):(d=n+1500,l=d*a/n,f=i-2e3,i<0&&(i=i+2e3),c=f*e/i))),r.bezierCurveTo(l,d,c,f,e,i),this.$radialTreeContainer.addChild(r)},drawCircle(t){let r=t;const s=r.children.find(a=>a.children),h=Math.sqrt((s.x-t.x)*(s.x-t.x)+(s.y-t.y)*(s.y-t.y));for(let a=0;a<t.height;a++){const n=new v;n.lineStyle(30,3359061,.9),n.drawCircle(0,0,h*(a+1)),n.endFill(),r=s,this.$radialTreeContainer.addChild(n)}},showInfoPanel(){this.isSkillInfoPanelShown||(this.isSkillInfoPanelShown=!0,screen.width>800?document.getElementById("skillInfoPanel").style.width="474px":document.getElementById("skillInfoPanel").style.height="474px",this.skill.isMastered=="1"?document.getElementById("mastery-checkbox").checked=!0:document.getElementById("mastery-checkbox").checked=!1)},hideInfoPanel(){this.isSkillInfoPanelShown&&(screen.width>800?document.getElementById("skillInfoPanel").style.width="0px":document.getElementById("skillInfoPanel").style.height="0px",document.getElementById("sidepanel-backdrop").style.display="none",this.isSkillInfoPanelShown=!1)},async printPDF(){await this.getPrintAlgorithm();var t=document.getElementById("radialTree"),r=N(t),s=r.node(),h=new XMLSerializer,a=h.serializeToString(s),n={svg:a,treeType:"radial"},e=JSON.stringify(n),i=new XMLHttpRequest;i.responseType="arraybuffer",i.open("POST","/skilltree/print-pdf",!0),i.setRequestHeader("Content-type","application/json;charset=UTF-8"),i.setRequestHeader("Accept","application/json, text/plain, */*"),i.send(e),i.onload=function(){if(this.readyState==4&&this.status==200){let d=new Blob([i.response],{type:"application/pdf"});const c=window.URL.createObjectURL(d);var l=document.createElement("a");document.body.appendChild(l),l.style="display: none",l.href=c,l.download="My-Skill-Tree.pdf",l.click(),window.URL.revokeObjectURL(c)}}},async getPrintAlgorithm(){await this.skillTreeStore.getUserSkills();const t={name:"SKILLS",sprite:null,children:this.skillTreeStore.userSkills};var r=[];r=JSON.parse(JSON.stringify(t.children));function s(a){for(var n=a.length;n--;){if(a[n].type=="super"&&a[n].position!="end"){var e=[],i=[];for(let d=0;d<a[n].children.length;d++)a[n].children[d].type=="sub"?e.push(a[n].children[d]):i.push(a[n].children[d]);var l={skill_name:a[n].skill_name,type:"super",position:"end",children:e};a[n].children=[],a[n].children.push(l);for(let d=0;d<i.length;d++)a[n].children.push(i[d])}typeof a[n]<"u"&&a[n].children&&Array.isArray(a[n].children)&&a[n].children.length>0&&s(a[n].children)}}s(r);const h={skill_name:"My skills",children:r};await this.createSVGTree(h)},async createSVGTree(t){const h=13200.000000000002,a=24e3*.59,e=S().size([2*Math.PI,this.radius*50]).separation((l,d)=>(l.parent==d.parent?1:2)/l.depth)(x(t));let i=H("svg").attr("id","radialTree").attr("width",24e3).attr("height",24e3).attr("viewBox",[-h,-a,24e3,24e3]).attr("style","max-width: 100%; height: auto; font: 10px sans-serif;");i.append("g").attr("fill","none").attr("stroke-opacity",1).selectAll().data(e.links()).join("path").attr("d",O().angle(l=>l.x).radius(l=>l.y)).attr("stroke",function(l){return"#000"}).attr("stroke-width",function(l){return l.target.data.is_mastered==1?4:1.5}).style("stroke-dasharray",function(l){if(l.source.data.type=="super"&&l.target.data.position=="end"||l.target.data.type=="sub")return 5}),i.append("g").selectAll().data(e.descendants()).join("circle").attr("transform",l=>`rotate(${l.x*180/Math.PI-90}) translate(${l.y},0)`).attr("fill","#000").attr("r",2.5),i.append("g").attr("stroke-linejoin","round").attr("stroke-width",1).selectAll().data(e.descendants()).join("text").attr("transform",l=>`rotate(${l.x*180/Math.PI-90}) translate(${l.y},0) rotate(${l.x>=Math.PI?180:0})`).attr("dy","0.31em").attr("x",l=>l.x<Math.PI==!l.children?6:-6).attr("text-anchor",l=>l.x<Math.PI==!l.children?"start":"end").style("font-weight",function(l){return l.data.type=="super"?"700":"400"}).style("font-style",function(l){if(l.data.type=="sub")return"italic"}).style("paint-order",function(l){return"stroke"}).clone(!0).lower().style("stroke-width",function(l){return"1px"}).text(function(l){return l.data.position=="end"?"":l.data.skill_name}),document.querySelector("#SVGskilltree").append(i.node())}}},u=t=>(V("data-v-4d26bfb8"),t=t(),J(),t),K={id:"wrapper"},Y=u(()=>g("div",{id:"skilltree"},null,-1)),Q=u(()=>g("div",{id:"SVGskilltree"},null,-1)),Z=u(()=>g("div",{id:"sidepanel-backdrop"},null,-1));function G(t,r,s,h,a,n){const e=F("SkillPanel");return p(),I(T,null,[g("button",{id:"print-btn",class:"btn btn-info",onClick:r[0]||(r[0]=i=>n.printPDF())}," Print "),g("div",K,[P(e,{skill:a.skill},null,8,["skill"]),Y,Q,Z])],64)}const ee=q(X,[["render",G],["__scopeId","data-v-4d26bfb8"]]);const te=g("div",{id:"purple-banner"},null,-1),se=g("span",null,"Loading...",-1),ae={__name:"RadialTreeView",setup(t){return(r,s)=>(p(),I(T,null,[te,(p(),W(D,null,{default:b(()=>[P(ee)]),fallback:b(()=>[se]),_:1}))],64))}};export{ae as default};
