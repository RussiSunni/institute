import{_ as L,u as z,a as R,A as m,l as o,C as g,B as _,T as A,m as j,G as M,r as C,o as y,c as b,b as x,d as P,F as T,p as q,g as U,f as E,w as v,S as O}from"./main-c6e8335a.js";import{S as G}from"./SkillPanel-3b34cd17.js";import"./transform-058a03dc.js";import{t as S,h as I,s as V,c as F,a as W}from"./link-1958226b.js";const J={setup(){const t=z(),i=R();return{userDetailsStore:t,skillTreeStore:i}},data(){return{width:null,height:null,skill:{id:null,children:[],isMastered:null,isUnlocked:null,name:null},tree:{},root:{},isSkillInfoPanelShown:!1,dx:null,dy:null,data:{},radius:0,radiusMultiplier:256,firstLevelNodeSize:400,secondLevelNodeSize:100,regularNodeSize:50,subSkillRadius:50,sprite:{domainNode:null},nodes:null}},components:{SkillPanel:G},created(){this.$pixiApp.start()},async mounted(){this.skillTreeStore.userSkillsSubSkillsSeparate.length==0&&await this.skillTreeStore.getUserSkillsSubSkillsSeparate();const t=await m.load("/images/skill-tree-nodes/sprite-sheet/spritesheet.json");await m.load("/font/Poppins Bold White.xml"),this.$radialTreeContainer.children.length==0&&(this.width=window.innerWidth,this.height=window.innerHeight,this.radius=Math.min(this.width,this.height)/2-30,this.skill={name:"SKILLS",sprite:null,children:this.skillTreeStore.userSkillsSubSkillsSeparate},this.getAlgorithm(t)),document.querySelector("#skilltree").appendChild(this.$pixiApp.view)},methods:{getAlgorithm(t){var i=[];i=JSON.parse(JSON.stringify(this.skill.children)),this.data={skill_name:"My skills",children:i};const h=S().size([2*Math.PI,this.radius*this.radiusMultiplier]).separation((a,l)=>(a.parent==l.parent?1:2)/a.depth);this.root=h(I(this.data)),this.drawTree(t)},drawTree(t){const i=new o(t.textures[0]);console.log(t),i.x=this.root.x,i.y=this.root.y,i.anchor.set(.5);const h=this.root.descendants(),a=this.root.links();this.drawCircle(this.root);for(const l of a)this.drawLink(l);this.$radialTreeContainer.addChild(i);for(const l of h)this.drawNode(l,t)},drawNode(t,i){let h=new g;h.x=Math.cos(t.x)*t.y,h.y=Math.sin(t.x)*t.y,this.$radialTreeContainer.addChild(h);var a=new o;if(t.data.level=="grade_school"?t.data.is_mastered?a=new o(i.textures[9]):t.data.is_accessible?a=new o(i.textures[13]):a=new o(i.textures[8]):t.data.level=="middle_school"?t.data.is_mastered?a=new o(i.textures[21]):t.data.is_accessible?a=new o(i.textures[25]):a=new o(i.textures[20]):t.data.level=="high_school"?t.data.is_mastered?a=new o(i.textures[15]):t.data.is_accessible?a=new o(i.textures[25]):a=new o(i.textures[20]):t.data.level=="college"?t.data.is_mastered?a=new o(i.textures[2]):t.data.is_accessible?a=new o(i.textures[25]):a=new o(i.textures[20]):t.data.level=="phd"?t.data.is_mastered?a=new o(i.textures[27]):t.data.is_accessible?a=new o(i.textures[25]):a=new o(i.textures[20]):t.data.level=="domain"&&(a=new o(i.textures[7])),a.anchor.set(.5),t.depth==1?(a.width=this.firstLevelNodeSize,a.height=this.firstLevelNodeSize):t.depth==2?(a.width=this.secondLevelNodeSize,a.height=this.secondLevelNodeSize):(a.width=this.regularNodeSize,a.height=this.regularNodeSize),h.addChild(a),a.eventMode="static",a.cursor="pointer",a.on("pointerdown",s=>{var r={id:t.data.id,isMastered:t.data.is_mastered,isUnlocked:t.data.is_accessible,name:t.data.skill_name,masteryRequirements:t.data.mastery_requirements,type:t.data.type};this.skill=r,this.isSkillInfoPanelShown||this.showInfoPanel()}),t.data.subskills)for(let s=0;s<t.data.subskills.length;s++){let r=new g,f=360/t.data.subskills.length*s,w=f*Math.PI/180,N=this.subSkillRadius*Math.cos(w),$=this.subSkillRadius*Math.sin(w);r.x=N,r.y=$;var a=new o;t.data.level=="grade_school"?t.data.is_mastered?a=new o(i.textures[11]):t.data.is_accessible?a=new o(i.textures[12]):a=new o(i.textures[10]):t.data.level=="middle_school"?t.data.is_mastered?a=new o(i.textures[23]):t.data.is_accessible?a=new o(i.textures[24]):a=new o(i.textures[22]):t.data.level=="high_school"?t.data.is_mastered?a=new o(i.textures[17]):t.data.is_accessible?a=new o(i.textures[18]):a=new o(i.textures[16]):t.data.level=="college"?t.data.is_mastered?a=new o(i.textures[4]):t.data.is_accessible?a=new o(i.textures[5]):a=new o(i.textures[3]):t.data.level=="phd"&&(t.data.is_mastered?a=new o(i.textures[29]):t.data.is_accessible?a=new o(i.textures[30]):a=new o(i.textures[28])),a.width=15,a.height=15,a.anchor.set(.5),a.eventMode="static",a.cursor="pointer",a.on("pointerdown",te=>{var B={id:t.data.subskills[s].id,isMastered:t.data.subskills[s].is_mastered,isUnlocked:t.data.subskills[s].is_accessible,name:t.data.subskills[s].skill_name,masteryRequirements:t.data.subskills[s].mastery_requirements,type:t.data.subskills[s].type};this.skill=B,this.isSkillInfoPanelShown||this.showInfoPanel()}),r.addChild(a);const k=new _(t.data.skill_name,{fontName:"Poppins-White-Bold",fontSize:10,align:"right"});k.angle=f,r.addChild(k),h.addChild(r)}let l,n;t.depth==0?(l=200,n="#000000"):t.depth==1?(l=150,n="#ffffff"):(l=120,n="#ffffff");const d=new A({fontFamily:"Poppins900",fontSize:l,fill:n,align:"center",strokeThickness:6,stroke:"black"});if(t.depth==0){const s=new j(t.data.skill_name,d);s.anchor.set(.5,.5),s.scale.set(.5,.5),h.addChild(s);return}const e=new _(t.data.skill_name,{fontName:"Poppins-White-Bold",fontSize:l,align:"right"});t.depth==0||t.depth==1?e.anchor.set(.5,.5):t.depth==2?(e.angle=t.x*180/Math.PI-90,h.x>0?(e.angle=e.angle+90,t.children?(e.anchor.set(1,.5),e.x=e.x-80*Math.cos(e.rotation),e.y=e.y-80*Math.sin(e.rotation),e.x=e.x-20*Math.cos(e.rotation+Math.PI/2),e.y=e.y-20*Math.sin(e.rotation+Math.PI/2)):(e.anchor.set(0,.5),e.x=e.x+80*Math.cos(e.rotation),e.y=e.y+80*Math.sin(e.rotation),e.x=e.x-20*Math.cos(e.rotation+Math.PI/2),e.y=e.y-20*Math.sin(e.rotation+Math.PI/2))):(e.anchor.set(0,.5),e.angle=e.angle-90,t.children?(e.x=e.x+80*Math.cos(e.rotation),e.y=e.y+80*Math.sin(e.rotation),e.x=e.x-20*Math.cos(e.rotation+Math.PI/2),e.y=e.y-20*Math.sin(e.rotation+Math.PI/2)):(e.anchor.set(1,.5),e.x=e.x-80*Math.cos(e.rotation),e.y=e.y-80*Math.sin(e.rotation),e.x=e.x+20*Math.cos(e.rotation+Math.PI/2),e.y=e.y+20*Math.sin(e.rotation+Math.PI/2)))):t.depth>2&&(e.angle=t.x*180/Math.PI-90,h.x>0?(e.angle=e.angle+90,t.children?(e.anchor.set(1,.5),e.x=e.x-50*Math.cos(e.rotation),e.y=e.y-50*Math.sin(e.rotation),e.x=e.x+20*Math.cos(e.rotation+Math.PI/2),e.y=e.y-20*Math.sin(e.rotation+Math.PI/2)):(e.anchor.set(0,.5),e.x=e.x+50*Math.cos(e.rotation),e.y=e.y+50*Math.sin(e.rotation),e.x=e.x-20*Math.cos(e.rotation+Math.PI/2),e.y=e.y-20*Math.sin(e.rotation+Math.PI/2))):(e.anchor.set(0,.5),e.angle=e.angle-90,t.children?(e.x=e.x+50*Math.cos(e.rotation),e.y=e.y+50*Math.sin(e.rotation),e.x=e.x-20*Math.cos(e.rotation+Math.PI/2),e.y=e.y-20*Math.sin(e.rotation+Math.PI/2)):(e.anchor.set(1,.5),e.x=e.x-50*Math.cos(e.rotation),e.y=e.y-50*Math.sin(e.rotation),e.x=e.x-20*Math.cos(e.rotation+Math.PI/2),e.y=e.y-20*Math.sin(e.rotation+Math.PI/2)))),e.scale.set(.5,.5),h.addChild(e)},drawLink(t){const i=new M;let h=0,a=7434618;t.target.data.is_mastered=="1"?(h=23,a=16777215):h=15,i.lineStyle(h,a,.85);var l=Math.cos(t.source.x)*t.source.y,n=Math.sin(t.source.x)*t.source.y;i.moveTo(l,n);var d=Math.cos(t.target.x)*t.target.y,e=Math.sin(t.target.x)*t.target.y;let s,r,c,u;const f=Math.abs(e)/Math.sqrt(e*e+d*d)*(180/Math.PI);l===0?(s=l,r=4500,c=d-800,u=e*c/d,f>45&&f<90&&(e<0?(u=e+1500,c=u*d/e):(u=e-1500,c=u*d/e))):l>0?(s=l+1500,r=n*s/l,c=d-2e3,d<0&&(c=d+2e3),u=e*c/d,f>45&&f<90&&(e<0?(r=n-1500,s=r*l/n,u=e+2e3,e>0&&(e=e-2e3),c=u*d/e):(r=n+1500,s=r*l/n,u=e-2e3,e<0&&(e=e+2e3),c=u*d/e))):(s=l-1500,r=n*s/l,c=d+2e3,d>0&&(c=d-2e3),u=e*c/d,f>45&&f<90&&(e<0?(r=n-1500,s=r*l/n,u=e+2e3,e>0&&(e=e-2e3),c=u*d/e):(r=n+1500,s=r*l/n,u=e-2e3,e<0&&(e=e+2e3),c=u*d/e))),i.bezierCurveTo(s,r,c,u,d,e),this.$radialTreeContainer.addChild(i)},drawCircle(t){let i=t;const h=i.children.find(l=>l.children),a=Math.sqrt((h.x-t.x)*(h.x-t.x)+(h.y-t.y)*(h.y-t.y));for(let l=0;l<t.height;l++){const n=new M;n.lineStyle(30,3359061,.9),n.drawCircle(0,0,a*(l+1)),n.endFill(),i=h,this.$radialTreeContainer.addChild(n)}},showInfoPanel(){this.isSkillInfoPanelShown||(this.isSkillInfoPanelShown=!0,screen.width>800?document.getElementById("skillInfoPanel").style.width="474px":document.getElementById("skillInfoPanel").style.height="474px",this.skill.isMastered=="1"?document.getElementById("mastery-checkbox").checked=!0:document.getElementById("mastery-checkbox").checked=!1)},hideInfoPanel(){this.isSkillInfoPanelShown&&(screen.width>800?document.getElementById("skillInfoPanel").style.width="0px":document.getElementById("skillInfoPanel").style.height="0px",document.getElementById("sidepanel-backdrop").style.display="none",this.isSkillInfoPanelShown=!1)},async printPDF(){await this.getPrintAlgorithm();var t=document.getElementById("radialTree"),i=V(t),h=i.node(),a=new XMLSerializer,l=a.serializeToString(h),n={svg:l,treeType:"radial"},d=JSON.stringify(n),e=new XMLHttpRequest;e.responseType="arraybuffer",e.open("POST","/skilltree/print-pdf",!0),e.setRequestHeader("Content-type","application/json;charset=UTF-8"),e.setRequestHeader("Accept","application/json, text/plain, */*"),e.send(d),e.onload=function(){if(this.readyState==4&&this.status==200){let r=new Blob([e.response],{type:"application/pdf"});const c=window.URL.createObjectURL(r);var s=document.createElement("a");document.body.appendChild(s),s.style="display: none",s.href=c,s.download="My-Skill-Tree.pdf",s.click(),window.URL.revokeObjectURL(c)}}},async getPrintAlgorithm(){await this.skillTreeStore.getUserSkills();const t={name:"SKILLS",sprite:null,children:this.skillTreeStore.userSkills};var i=[];i=JSON.parse(JSON.stringify(t.children));function h(l){for(var n=l.length;n--;){if(l[n].type=="super"&&l[n].position!="end"){var d=[],e=[];for(let r=0;r<l[n].children.length;r++)l[n].children[r].type=="sub"?d.push(l[n].children[r]):e.push(l[n].children[r]);var s={skill_name:l[n].skill_name,type:"super",position:"end",children:d};l[n].children=[],l[n].children.push(s);for(let r=0;r<e.length;r++)l[n].children.push(e[r])}typeof l[n]<"u"&&l[n].children&&Array.isArray(l[n].children)&&l[n].children.length>0&&h(l[n].children)}}h(i);const a={skill_name:"My skills",children:i};await this.createSVGTree(a)},async createSVGTree(t){const a=13200.000000000002,l=24e3*.59,d=S().size([2*Math.PI,this.radius*50]).separation((s,r)=>(s.parent==r.parent?1:2)/s.depth)(I(t));let e=F("svg").attr("id","radialTree").attr("width",24e3).attr("height",24e3).attr("viewBox",[-a,-l,24e3,24e3]).attr("style","max-width: 100%; height: auto; font: 10px sans-serif;");e.append("g").attr("fill","none").attr("stroke-opacity",1).selectAll().data(d.links()).join("path").attr("d",W().angle(s=>s.x).radius(s=>s.y)).attr("stroke",function(s){return"#000"}).attr("stroke-width",function(s){return s.target.data.is_mastered==1?4:1.5}).style("stroke-dasharray",function(s){if(s.source.data.type=="super"&&s.target.data.position=="end"||s.target.data.type=="sub")return 5}),e.append("g").selectAll().data(d.descendants()).join("circle").attr("transform",s=>`rotate(${s.x*180/Math.PI-90}) translate(${s.y},0)`).attr("fill","#000").attr("r",2.5),e.append("g").attr("stroke-linejoin","round").attr("stroke-width",1).selectAll().data(d.descendants()).join("text").attr("transform",s=>`rotate(${s.x*180/Math.PI-90}) translate(${s.y},0) rotate(${s.x>=Math.PI?180:0})`).attr("dy","0.31em").attr("x",s=>s.x<Math.PI==!s.children?6:-6).attr("text-anchor",s=>s.x<Math.PI==!s.children?"start":"end").style("font-weight",function(s){return s.data.type=="super"?"700":"400"}).style("font-style",function(s){if(s.data.type=="sub")return"italic"}).style("paint-order",function(s){return"stroke"}).clone(!0).lower().style("stroke-width",function(s){return"1px"}).text(function(s){return s.data.position=="end"?"":s.data.skill_name}),document.querySelector("#SVGskilltree").append(e.node())}}},p=t=>(q("data-v-36efc57d"),t=t(),U(),t),D={id:"wrapper"},H=p(()=>x("div",{id:"skilltree"},null,-1)),X=p(()=>x("div",{id:"SVGskilltree"},null,-1)),K=p(()=>x("div",{id:"sidepanel-backdrop"},null,-1));function Y(t,i,h,a,l,n){const d=C("SkillPanel");return y(),b(T,null,[x("button",{id:"print-btn",class:"btn btn-info",onClick:i[0]||(i[0]=e=>n.printPDF())}," Print "),x("div",D,[P(d,{skill:l.skill},null,8,["skill"]),H,X,K])],64)}const Q=L(J,[["render",Y],["__scopeId","data-v-36efc57d"]]);const Z=x("div",{id:"purple-banner"},null,-1),ee=x("span",null,"Loading...",-1),ne={__name:"RadialTreeView",setup(t){return(i,h)=>(y(),b(T,null,[Z,(y(),E(O,null,{default:v(()=>[P(Q)]),fallback:v(()=>[ee]),_:1}))],64))}};export{ne as default};
