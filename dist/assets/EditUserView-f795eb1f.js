import{_ as v}from"./edit-mastery-skill-banner-9e7c0291.js";import{u as b}from"./UsersStore-0d6835e0.js";import{u as S}from"./InstructorStudentsStore-2a35ae1f.js";import{_ as w,f as I,o as a,c as u,a as e,t as h,w as l,s as c,J as _,F as f,r as y,b as U,g as p,j as V,l as x,p as k,e as C}from"./main-615ae9b9.js";import{_ as E}from"./recurso-69-12793b41.js";const F={setup(){const t=b(),s=S();return{usersStore:t,instructorStudentsStore:s}},data(){return{userId:this.$route.params.id,user:{},image:"",instructors:[],instructorId:null}},async mounted(){this.usersStore.users.length<1&&await this.usersStore.getUsers(),this.instructorStudentsStore.instructorStudentsList.length==0&&await this.instructorStudentsStore.getInstructorStudentsList(),this.getInstructors()},methods:{getUser(){fetch("/users/show/"+this.userId).then(function(t){return t.json()}).then(t=>this.user=t).then(()=>{this.image=this.user.avatar})},getInstructors(){for(let t=0;t<this.usersStore.users.length;t++)this.usersStore.users[t].role=="instructor"&&this.instructors.push(this.usersStore.users[t]);for(let t=0;t<this.instructorStudentsStore.instructorStudentsList.length;t++)this.instructorStudentsStore.instructorStudentsList[t].student_id==this.userId&&(this.instructorId=this.instructorStudentsStore.instructorStudentsList[t].instructor_id);this.getUser()},ValidateForm(){this.user.first_name==""||this.user.first_name==null?alert("Please add a first name."):this.user.last_name==""||this.user.last_name==null?alert("Please add a last name."):this.user.username==""||this.user.username==null?alert("Please add a username."):this.user.email==""||this.user.email==null?alert("Please add an email address."):this.Submit()},ValidateEmail(){/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/.test(this.user.email)||alert("Please enter a valid email address")},Submit(){const t={method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({firstname:this.user.first_name,lastname:this.user.last_name,username:this.user.username,email:this.user.email,avatar:this.user.avatar,role:this.user.role,password:this.user.password})};var s="/users/"+this.userId+"/edit";fetch(s,t).then(()=>{if(this.user.role=="student"){const m={method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({instructor_id:this.instructorId})};var d="/users/"+this.userId+"/edit/instructor";fetch(d,m)}}).then(()=>{this.$router.push("/users")})},onFileChange(t){var s=t.target.files||t.dataTransfer.files;s.length&&this.createImage(s[0])},createImage(t){new Image;var s=new FileReader,d=this;s.onload=m=>{d.image=m.target.result,this.image=m.target.result,this.user.avatar=this.image},s.readAsDataURL(t)},removeImage:function(t){this.image="",this.user.avatar=this.image}}},o=t=>(k("data-v-3be1cde4"),t=t(),C(),t),L={class:"container mt-3 pb-5"},P=o(()=>e("div",{class:"row"},[e("div",{class:"col-10 d-flex align-items-end"},[e("h2",{id:"header-tile"},"Edit User"),e("img",{src:E,id:"header-icon"})])],-1)),N={class:"container-fluid main-content-container p-4 mt-5"},T={class:"row"},j={class:"col-lg-4 mt-3"},B={class:"mb-3 row"},O={key:0},R=o(()=>e("p",{style:{"font-size":"14px"}},[e("em",null,"Maximum file size 15mb")],-1)),D={key:1},J=["src"],M={class:"col-lg-4"},q={class:"mb-3"},z={for:"firstname",class:"form-label"},A={class:"mb-3"},G=o(()=>e("label",{for:"lastname",class:"form-label"},"Last name",-1)),H={class:"mb-3"},K=o(()=>e("label",{class:"form-label"},"Username",-1)),Q={class:"mb-3"},W=o(()=>e("label",{class:"form-label"},"Email address",-1)),X={class:"mb-3"},Y=o(()=>e("label",{class:"form-label"},"Role",-1)),Z=o(()=>e("option",{value:"admin"},"admin",-1)),$=o(()=>e("option",{value:"instructor"},"instructor",-1)),ee=o(()=>e("option",{value:"student"},"student",-1)),se=[Z,$,ee],te={key:0,class:"mb-3"},re=o(()=>e("label",{class:"form-label"},"Instructor",-1)),ie=["value"],oe={class:"mb-3"},ne=o(()=>e("label",{class:"form-label"},"Password",-1)),le={class:"d-flex justify-content-between"};function ae(t,s,d,m,i,n){const g=I("router-link");return a(),u("div",L,[P,e("div",N,[e("div",T,[e("div",j,[e("div",B,[i.image?(a(),u("div",D,[e("p",null,[e("img",{src:i.image,height:"300",style:{"background-color":"lightgrey"}},null,8,J)]),e("p",null,[e("button",{class:"btn btn-warning",onClick:s[1]||(s[1]=(...r)=>n.removeImage&&n.removeImage(...r))}," Remove image ")])])):(a(),u("div",O,[e("input",{class:"form-control",type:"file",accept:"image/*",onChange:s[0]||(s[0]=(...r)=>n.onFileChange&&n.onFileChange(...r))},null,32),R]))])]),e("div",M,[e("div",q,[e("label",z,"First name "+h(t.firstName),1),l(e("input",{"onUpdate:modelValue":s[2]||(s[2]=r=>i.user.first_name=r),type:"text",class:"form-control"},null,512),[[c,i.user.first_name]])]),e("div",A,[G,l(e("input",{"onUpdate:modelValue":s[3]||(s[3]=r=>i.user.last_name=r),type:"text",class:"form-control"},null,512),[[c,i.user.last_name]])]),e("div",H,[K,l(e("input",{"onUpdate:modelValue":s[4]||(s[4]=r=>i.user.username=r),type:"text",class:"form-control"},null,512),[[c,i.user.username]])]),e("div",Q,[W,l(e("input",{"onUpdate:modelValue":s[5]||(s[5]=r=>i.user.email=r),type:"email",class:"form-control",onBlur:s[6]||(s[6]=(...r)=>n.ValidateEmail&&n.ValidateEmail(...r))},null,544),[[c,i.user.email]])]),e("div",X,[Y,l(e("select",{"onUpdate:modelValue":s[7]||(s[7]=r=>i.user.role=r),class:"form-select"},se,512),[[_,i.user.role]])]),i.user.role=="student"?(a(),u("div",te,[re,l(e("select",{"onUpdate:modelValue":s[8]||(s[8]=r=>i.instructorId=r),class:"form-select"},[(a(!0),u(f,null,y(i.instructors,r=>(a(),u("option",{value:r.id},h(r.username),9,ie))),256))],512),[[_,i.instructorId]])])):U("",!0),e("div",oe,[ne,l(e("input",{"onUpdate:modelValue":s[9]||(s[9]=r=>i.user.password=r),type:"text",class:"form-control"},null,512),[[c,i.user.password]])]),e("div",le,[p(g,{class:"btn btn-dark",to:"/users"},{default:V(()=>[x(" Cancel ")]),_:1}),e("button",{class:"btn btn-dark",onClick:s[10]||(s[10]=r=>n.ValidateForm())},"Submit")])])])])])}const ue=w(F,[["render",ae],["__scopeId","data-v-3be1cde4"]]),de=e("div",{id:"banner"},[e("img",{src:v,class:"image-fluid"})],-1),pe={__name:"EditUserView",setup(t){return(s,d)=>(a(),u(f,null,[de,p(ue)],64))}};export{pe as default};
