import{_,u as v,P as T,G as f,l as P,T as b,r as I,o as p,c as g,b as h,a as x,F as S,p as A,d as $,e as B,f as y,g as L}from"./main-86ae2cd1.js";import{u as j}from"./SkillTreeStore-67b9074f.js";import{S as E}from"./SkillPanel-630dacf4.js";import"./transform-9f729428.js";import{h as M}from"./pixi_viewport-83542366.js";import{h as k}from"./index-0536990b.js";import{t as m}from"./tree-6e85cfa8.js";import{a as w,s as G}from"./link-6c63e533.js";import{c as O}from"./create-85d24f71.js";const U={setup(){const e=v(),r=j();return{userDetailsStore:e,skillTreeStore:r}},data(){return{width:800,height:600,skill:{id:null,children:[],isMastered:null,isUnlocked:null,name:null},tree:{},root:{},isSkillInfoPanelShown:!1,dx:null,dy:null,data:{}}},components:{SkillPanel:E},async mounted(){this.skillTreeStore.userSkills.length==0&&await this.skillTreeStore.getUserSkills(),this.skill={name:"SKILLS",sprite:null,children:this.skillTreeStore.userSkills};const e=new M({screenWidth:this.width,screenHeight:this.height,worldWidth:this.width,worldHeight:this.height,events:this.$pixiApp.renderer.events});this.$pixiApp.stage.addChild(e),e.center=new T(100,0),e.setZoom(.1),e.drag({wheelScroll:2,factor:2}).pinch({percent:2,factor:2}).wheel().decelerate().clampZoom({minScale:.001,maxScale:10}),document.querySelector("#skilltree").appendChild(this.$pixiApp.view),this.getAlgorithm()},methods:{getAlgorithm(){var e=[];e=JSON.parse(JSON.stringify(this.skill.children));function r(i){for(var s=i.length;s--;){if(i[s].type=="super"&&i[s].position!="end"){var l=[],a=[];for(let n=0;n<i[s].children.length;n++)i[s].children[n].type=="sub"?l.push(i[s].children[n]):a.push(i[s].children[n]);var o={skill_name:i[s].skill_name,type:"super",position:"end",children:l};i[s].children=[],i[s].children.push(o);for(let n=0;n<a.length;n++)i[s].children.push(a[n])}typeof i[s]<"u"&&i[s].children&&Array.isArray(i[s].children)&&i[s].children.length>0&&r(i[s].children)}}r(e),this.data={skill_name:"My skills",children:e},this.width=8e3,this.root=k(this.data),this.dx=35,this.dy=this.width/(this.root.height+1),this.tree=m().nodeSize([this.dx,this.dy]),this.tree(this.root),this.drawTree()},drawTree(){var e=this.root.descendants();const r=this.root.links();for(const i of r)this.drawLink(i);for(const i of e)this.drawNode(i)},drawNode(e){const r=new f;r.lineStyle(0),r.beginFill(0,1),r.drawCircle(e.y,e.x,15),r.endFill(),this.$pixiApp.stage.children[0].addChild(r),r.eventMode="static",r.cursor="pointer",r.on("pointerdown",l=>{var a={id:e.data.id,isMastered:e.data.is_mastered,isUnlocked:e.data.is_accessible,name:e.data.skill_name};this.skill=a,this.isSkillInfoPanelShown||this.showInfoPanel()});const i=new P({fontFamily:"Arial",fontSize:12,fill:"#000",stroke:"#fff",strokeThickness:3}),s=new b(e.data.skill_name,i);s.anchor.set(0,.5),s.x=e.y+15,s.y=e.x,this.$pixiApp.stage.children[0].addChild(s)},drawLink(e){var i=w().x(c=>c.y).y(c=>c.x)(e),s=i.substring(i.indexOf("M")+1,i.lastIndexOf("C"));const l=s.split(",");var a=i.split("C")[1],o=a.split(",");const n=new f;var d;e.target.data.is_mastered==1?d=4:d=2,(e.source.data.type=="super"&&e.target.data.position=="end"||e.target.data.type=="sub")&&(d=1),n.lineStyle(d,0,1),n.position.x=l[0],n.position.y=l[1],n.bezierCurveTo(o[0]-l[0],o[1]-l[1],o[2]-l[0],o[3]-l[1],o[4]-l[0],o[5]-l[1]),this.$pixiApp.stage.children[0].addChild(n)},showInfoPanel(){this.isSkillInfoPanelShown||(this.isSkillInfoPanelShown=!0,screen.width>800?document.getElementById("skillInfoPanel").style.width="474px":document.getElementById("skillInfoPanel").style.height="474px",this.skill.isMastered=="1"?document.getElementById("mastery-checkbox").checked=!0:document.getElementById("mastery-checkbox").checked=!1)},hideInfoPanel(){this.isSkillInfoPanelShown&&(screen.width>800?document.getElementById("skillInfoPanel").style.width="0px":document.getElementById("skillInfoPanel").style.height="0px",document.getElementById("sidepanel-backdrop").style.display="none",this.isSkillInfoPanelShown=!1)},async printPDF(){await this.createSVGTree();var e=document.getElementById("linearTree"),r=G(e),i=r.node(),s=new XMLSerializer,l=s.serializeToString(i),a={svg:l,treeType:"linear"},o=JSON.stringify(a),n=new XMLHttpRequest;n.responseType="arraybuffer",n.open("POST","/skilltree/print-pdf",!0),n.setRequestHeader("Content-type","application/json;charset=UTF-8"),n.setRequestHeader("Accept","application/json, text/plain, */*"),n.send(o),n.onload=function(){if(this.readyState==4&&this.status==200){let c=new Blob([n.response],{type:"application/pdf"});const t=window.URL.createObjectURL(c);var d=document.createElement("a");document.body.appendChild(d),d.style="display: none",d.href=t,d.download="My-Skill-Tree.pdf",d.click(),window.URL.revokeObjectURL(t)}}},createSVGTree(){const e=k(this.data),r=15,i=this.width/(e.height+1);m().nodeSize([r,i])(e);let l=1/0,a=-l;e.each(t=>{t.x>a&&(a=t.x),t.x<l&&(l=t.x)});const o=a-l+this.dx*2;let n=O("svg").attr("id","linearTree").attr("width",this.width).attr("height",o).attr("viewBox",[-i/3,l-r,this.width,o]).attr("style","max-width: 100%; height: auto; font: 10px sans-serif;");const d=n.append("g");d.append("g").attr("fill","none").attr("stroke-opacity",1).selectAll().data(e.links()).join("path").attr("d",w().x(t=>t.y).y(t=>t.x)).attr("stroke",function(t){return"#000"}).attr("stroke-width",function(t){return t.target.data.is_mastered==1?8:1.5}).style("stroke-dasharray",function(t){if(t.source.data.type=="super"&&t.target.data.position=="end"||t.target.data.type=="sub")return 5});const c=d.append("g").attr("stroke-linejoin","round").attr("stroke-width",3).selectAll().data(e.descendants()).join("g").attr("transform",t=>`translate(${t.y},${t.x})`);c.append("circle").attr("fill",t=>t.children?"#555":"#000").attr("r",2.5),c.append("text").style("font-weight",function(t){return t.data.type=="super"?"700":"400"}).style("font-style",function(t){if(t.data.type=="sub")return"italic"}).attr("dy","0.31em").attr("x",t=>t.children?-6:6).attr("text-anchor",t=>t.children?"end":"start").text(function(t){return t.data.position=="end"?"":t.data.skill_name}).clone(!0).lower().attr("stroke",function(t){return"white"}),document.querySelector("#SVGskilltree").append(n.node())}}},u=e=>(A("data-v-9323e067"),e=e(),$(),e),F={id:"wrapper"},N=u(()=>h("div",{id:"skilltree"},null,-1)),V=u(()=>h("div",{id:"SVGskilltree"},null,-1)),z=u(()=>h("div",{id:"sidepanel-backdrop"},null,-1));function R(e,r,i,s,l,a){const o=I("SkillPanel");return p(),g(S,null,[h("button",{id:"print-btn",class:"btn btn-info",onClick:r[0]||(r[0]=n=>a.printPDF())}," Print "),h("div",F,[x(o,{skill:l.skill},null,8,["skill"]),N,V,z])],64)}const H=_(U,[["render",R],["__scopeId","data-v-9323e067"]]);const q=h("div",{id:"purple-banner"},null,-1),D=h("span",null,"Loading...",-1),te={__name:"PixiTidyTreeView",setup(e){return(r,i)=>(p(),g(S,null,[q,(p(),B(L,null,{default:y(()=>[x(H)]),fallback:y(()=>[D]),_:1}))],64))}};export{te as default};
