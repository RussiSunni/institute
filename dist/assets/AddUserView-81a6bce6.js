import{_ as f,j as _,e as p,o as u,c as d,a as e,w as n,k as m,B as c,F as v,r as g,t as k,n as b,f as S,h as w,i as y,g as I}from"./main-7fa0580e.js";import{u as V}from"./SkillsStore-ef044ebd.js";import{u as L}from"./UsersStore-4edccbef.js";const U={setup(){const t=V(),s=L();return{skillsStore:t,usersStore:s}},data(){return{user:{},image:"",firstLevelSkillIds:[],childrenOfFirstLevelSkillsIds:[],newUserId:null,isValidated:!1,instructors:[],instructorId:null}},async created(){this.skillsStore.skillsList.length<1&&await this.skillsStore.getSkillsList();for(let t=0;t<this.skillsStore.skillsList.length;t++)this.skillsStore.skillsList[t].hierarchy_level==1&&this.firstLevelSkillIds.push(this.skillsStore.skillsList[t].id);for(let t=0;t<this.skillsStore.skillsList.length;t++)for(let s=0;s<this.firstLevelSkillIds.length;s++)this.skillsStore.skillsList[t].parent==this.firstLevelSkillIds[s]&&this.childrenOfFirstLevelSkillsIds.push(this.skillsStore.skillsList[t].id)},async mounted(){this.usersStore.users.length<1&&await this.usersStore.getUsers(),this.getInstructors()},methods:{getInstructors(){for(let t=0;t<this.usersStore.users.length;t++)this.usersStore.users[t].role=="instructor"&&this.instructors.push(this.usersStore.users[t])},ValidateForm(){this.user.first_name==""||this.user.first_name==null?alert("Please add a first name."):this.user.last_name==""||this.user.last_name==null?alert("Please add a last name."):this.user.username==""||this.user.username==null?alert("Please add a username."):this.user.email==""||this.user.email==null?alert("Please add am email address."):this.Submit()},ValidateEmail(){/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/.test(this.user.email)||alert("Please enter a valid email address")},Submit(){const t={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({firstname:this.user.first_name,lastname:this.user.last_name,username:this.user.username,email:this.user.email,avatar:this.user.avatar,password:this.user.password,role:this.user.role})};var s="/users/add";fetch(s,t).then(function(i){return i.json()}).then(i=>{i.account=="username already taken"||i.account=="email already taken"?alert(i.account):(alert("account created"),this.usersStore.getUsers(),_.push({name:"users"}),this.isValidated=!0),this.newUserId=i.id}).then(i=>{if(this.isValidated)for(let l=0;l<this.firstLevelSkillIds.length;l++){var a="/user-skills/accessible/"+this.newUserId+"/"+this.firstLevelSkillIds[l];fetch(a)}}).then(i=>{if(this.user.role=="student"){const l={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({instructor_id:this.instructorId,student_id:this.newUserId})};var a="/users/add/instructor";fetch(a,l)}})},onFileChange(t){var s=t.target.files||t.dataTransfer.files;s.length&&this.createImage(s[0])},createImage(t){new Image;var s=new FileReader,i=this;s.onload=a=>{i.image=a.target.result,this.image=a.target.result,this.user.avatar=this.image},s.readAsDataURL(t)},removeImage:function(t){this.image="",this.user.avatar=this.image}}},x={class:"container mt-3"},C=e("h1",null,"Add User",-1),F={class:"row"},N={class:"col-sm-4"},O={class:"mb-3"},P=e("label",{for:"first_name",class:"form-label"},"First Name",-1),T={class:"mb-3"},j=e("label",{for:"last_name",class:"form-label"},"Last Name",-1),B={class:"mb-3"},A=e("label",{class:"form-label"},"Username",-1),E={class:"mb-3"},R=e("label",{class:"form-label"},"Email address",-1),D={class:"mb-3 row"},M=e("label",{class:"form-label"},"Avatar",-1),q={key:0},z=e("p",{style:{"font-size":"14px"}},[e("em",null,"Maximum file size 15mb")],-1),J={key:1},G=["src"],H={class:"mb-3"},K=e("label",{class:"form-label"},"Role",-1),Q=e("option",{value:"admin"},"admin",-1),W=e("option",{value:"instructor"},"instructor",-1),X=e("option",{value:"student"},"student",-1),Y=[Q,W,X],Z={key:0,class:"mb-3"},$=e("label",{class:"form-label"},"Instructor",-1),ss=["value"],es={class:"mb-3"},ts=e("label",{class:"form-label"},"Password",-1),ls={class:"d-flex justify-content-between"};function rs(t,s,i,a,l,o){const h=p("router-link");return u(),d("div",x,[C,e("div",F,[e("div",N,[e("div",O,[P,n(e("input",{"onUpdate:modelValue":s[0]||(s[0]=r=>l.user.first_name=r),type:"text",class:"form-control"},null,512),[[m,l.user.first_name]])]),e("div",T,[j,n(e("input",{"onUpdate:modelValue":s[1]||(s[1]=r=>l.user.last_name=r),type:"text",class:"form-control"},null,512),[[m,l.user.last_name]])]),e("div",B,[A,n(e("input",{"onUpdate:modelValue":s[2]||(s[2]=r=>l.user.username=r),type:"text",class:"form-control"},null,512),[[m,l.user.username]])]),e("div",E,[R,n(e("input",{"onUpdate:modelValue":s[3]||(s[3]=r=>l.user.email=r),type:"email",class:"form-control",onBlur:s[4]||(s[4]=(...r)=>o.ValidateEmail&&o.ValidateEmail(...r))},null,544),[[m,l.user.email]])]),e("div",D,[M,l.image?(u(),d("div",J,[e("p",null,[e("img",{src:l.image,height:"200",style:{"background-color":"lightgrey"}},null,8,G)]),e("p",null,[e("button",{class:"btn btn-warning",onClick:s[6]||(s[6]=(...r)=>o.removeImage&&o.removeImage(...r))},"Remove image")])])):(u(),d("div",q,[e("input",{class:"form-control",type:"file",accept:"image/*",onChange:s[5]||(s[5]=(...r)=>o.onFileChange&&o.onFileChange(...r))},null,32),z]))]),e("div",H,[K,n(e("select",{"onUpdate:modelValue":s[7]||(s[7]=r=>l.user.role=r),class:"form-select"},Y,512),[[c,l.user.role]])]),l.user.role=="student"?(u(),d("div",Z,[$,n(e("select",{"onUpdate:modelValue":s[8]||(s[8]=r=>l.instructorId=r),class:"form-select"},[(u(!0),d(v,null,g(l.instructors,r=>(u(),d("option",{value:r.id},k(r.username),9,ss))),256))],512),[[c,l.instructorId]])])):b("",!0),e("div",es,[ts,n(e("input",{"onUpdate:modelValue":s[9]||(s[9]=r=>l.user.password=r),type:"text",class:"form-control"},null,512),[[m,l.user.password]])]),e("div",ls,[S(h,{class:"btn btn-dark",to:"/users"},{default:w(()=>[y(" Cancel ")]),_:1}),e("button",{class:"btn btn-dark",onClick:s[10]||(s[10]=r=>o.ValidateForm())},"Submit")])])])])}const is=f(U,[["render",rs]]),us={__name:"AddUserView",setup(t){return(s,i)=>(u(),I(is))}};export{us as default};
