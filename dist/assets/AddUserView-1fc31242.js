import{_ as f,q as _,f as p,o as u,c as d,a as s,w as n,s as m,J as c,F as v,r as g,t as b,b as k,g as S,j as w,l as I,i as y}from"./main-7c6147bf.js";import{u as V}from"./SkillsStore-7dc944a9.js";import{u as U}from"./UsersStore-16a32838.js";const L={setup(){const t=V(),e=U();return{skillsStore:t,usersStore:e}},data(){return{user:{},image:"",firstLevelSkillIds:[],childrenOfFirstLevelSkillsIds:[],newUserId:null,isValidated:!1,instructors:[],instructorId:null}},async created(){this.skillsStore.nestedSkillsList.length<1&&await this.skillsStore.getNestedSkillsList();for(let t=0;t<this.skillsStore.nestedSkillsList.length;t++)this.firstLevelSkillIds.push(this.skillsStore.nestedSkillsList[t].id);for(let t=0;t<this.skillsStore.skillsList.length;t++)for(let e=0;e<this.firstLevelSkillIds.length;e++)this.skillsStore.skillsList[t].parent==this.firstLevelSkillIds[e]&&this.childrenOfFirstLevelSkillsIds.push(this.skillsStore.skillsList[t].id)},async mounted(){this.usersStore.users.length<1&&await this.usersStore.getUsers(),this.getInstructors()},methods:{getInstructors(){for(let t=0;t<this.usersStore.users.length;t++)this.usersStore.users[t].role=="instructor"&&this.instructors.push(this.usersStore.users[t])},ValidateForm(){this.user.first_name==""||this.user.first_name==null?alert("Please add a first name."):this.user.last_name==""||this.user.last_name==null?alert("Please add a last name."):this.user.username==""||this.user.username==null?alert("Please add a username."):this.user.email==""||this.user.email==null?alert("Please add am email address."):this.Submit()},ValidateEmail(){/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/.test(this.user.email)||alert("Please enter a valid email address")},Submit(){const t={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({firstname:this.user.first_name,lastname:this.user.last_name,username:this.user.username,email:this.user.email,avatar:this.user.avatar,password:this.user.password,role:this.user.role})};var e="/users/add";fetch(e,t).then(function(i){return i.json()}).then(i=>{i.account=="username already taken"||i.account=="email already taken"?alert(i.account):(alert("account created"),this.usersStore.getUsers(),_.push({name:"users"}),this.isValidated=!0),this.newUserId=i.id}).then(i=>{if(this.isValidated)for(let l=0;l<this.firstLevelSkillIds.length;l++){var a="/user-skills/accessible/"+this.newUserId+"/"+this.firstLevelSkillIds[l];fetch(a)}}).then(i=>{if(this.user.role=="student"){const l={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({instructor_id:this.instructorId,student_id:this.newUserId})};var a="/users/add/instructor";fetch(a,l)}})},onFileChange(t){var e=t.target.files||t.dataTransfer.files;e.length&&this.createImage(e[0])},createImage(t){new Image;var e=new FileReader,i=this;e.onload=a=>{i.image=a.target.result,this.image=a.target.result,this.user.avatar=this.image},e.readAsDataURL(t)},removeImage:function(t){this.image="",this.user.avatar=this.image}}},x={class:"container mt-3"},C=s("h1",null,"Add User",-1),F={class:"row"},N={class:"col-sm-4"},O={class:"mb-3"},P=s("label",{for:"first_name",class:"form-label"},"First Name",-1),T={class:"mb-3"},j=s("label",{for:"last_name",class:"form-label"},"Last Name",-1),A={class:"mb-3"},B=s("label",{class:"form-label"},"Username",-1),E={class:"mb-3"},R=s("label",{class:"form-label"},"Email address",-1),q={class:"mb-3 row"},D=s("label",{class:"form-label"},"Avatar",-1),J={key:0},M=s("p",{style:{"font-size":"14px"}},[s("em",null,"Maximum file size 15mb")],-1),z={key:1},G=["src"],H={class:"mb-3"},K=s("label",{class:"form-label"},"Role",-1),Q=s("option",{value:"admin"},"admin",-1),W=s("option",{value:"instructor"},"instructor",-1),X=s("option",{value:"student"},"student",-1),Y=[Q,W,X],Z={key:0,class:"mb-3"},$=s("label",{class:"form-label"},"Instructor",-1),ee=["value"],se={class:"mb-3"},te=s("label",{class:"form-label"},"Password",-1),le={class:"d-flex justify-content-between"};function re(t,e,i,a,l,o){const h=p("router-link");return u(),d("div",x,[C,s("div",F,[s("div",N,[s("div",O,[P,n(s("input",{"onUpdate:modelValue":e[0]||(e[0]=r=>l.user.first_name=r),type:"text",class:"form-control"},null,512),[[m,l.user.first_name]])]),s("div",T,[j,n(s("input",{"onUpdate:modelValue":e[1]||(e[1]=r=>l.user.last_name=r),type:"text",class:"form-control"},null,512),[[m,l.user.last_name]])]),s("div",A,[B,n(s("input",{"onUpdate:modelValue":e[2]||(e[2]=r=>l.user.username=r),type:"text",class:"form-control"},null,512),[[m,l.user.username]])]),s("div",E,[R,n(s("input",{"onUpdate:modelValue":e[3]||(e[3]=r=>l.user.email=r),type:"email",class:"form-control",onBlur:e[4]||(e[4]=(...r)=>o.ValidateEmail&&o.ValidateEmail(...r))},null,544),[[m,l.user.email]])]),s("div",q,[D,l.image?(u(),d("div",z,[s("p",null,[s("img",{src:l.image,height:"200",style:{"background-color":"lightgrey"}},null,8,G)]),s("p",null,[s("button",{class:"btn btn-warning",onClick:e[6]||(e[6]=(...r)=>o.removeImage&&o.removeImage(...r))},"Remove image")])])):(u(),d("div",J,[s("input",{class:"form-control",type:"file",accept:"image/*",onChange:e[5]||(e[5]=(...r)=>o.onFileChange&&o.onFileChange(...r))},null,32),M]))]),s("div",H,[K,n(s("select",{"onUpdate:modelValue":e[7]||(e[7]=r=>l.user.role=r),class:"form-select"},Y,512),[[c,l.user.role]])]),l.user.role=="student"?(u(),d("div",Z,[$,n(s("select",{"onUpdate:modelValue":e[8]||(e[8]=r=>l.instructorId=r),class:"form-select"},[(u(!0),d(v,null,g(l.instructors,r=>(u(),d("option",{value:r.id},b(r.username),9,ee))),256))],512),[[c,l.instructorId]])])):k("",!0),s("div",se,[te,n(s("input",{"onUpdate:modelValue":e[9]||(e[9]=r=>l.user.password=r),type:"text",class:"form-control"},null,512),[[m,l.user.password]])]),s("div",le,[S(h,{class:"btn btn-dark",to:"/users"},{default:w(()=>[I(" Cancel ")]),_:1}),s("button",{class:"btn btn-dark",onClick:e[10]||(e[10]=r=>o.ValidateForm())},"Submit")])])])])}const ie=f(L,[["render",re]]),ue={__name:"AddUserView",setup(t){return(e,i)=>(u(),y(ie))}};export{ue as default};
