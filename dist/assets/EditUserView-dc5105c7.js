import{_ as v}from"./edit-mastery-skill-banner-9e7c0291.js";import{u as b}from"./UsersStore-30b01434.js";import{u as S}from"./InstructorStudentsStore-077639d2.js";import{_ as w,f as I,o as a,c as u,a as s,t as h,w as l,s as c,J as _,F as f,r as y,b as U,g as p,j as V,l as x,p as k,e as C}from"./main-9e0353b4.js";import{_ as E}from"./recurso-69-12793b41.js";const F={setup(){const t=b(),e=S();return{usersStore:t,instructorStudentsStore:e}},data(){return{userId:this.$route.params.id,user:{},image:"",instructors:[],instructorId:null}},async mounted(){this.usersStore.users.length<1&&await this.usersStore.getUsers(),this.instructorStudentsStore.instructorStudentsList.length==0&&await this.instructorStudentsStore.getInstructorStudentsList(),this.getInstructors()},methods:{getUser(){fetch("/users/show/"+this.userId).then(function(t){return t.json()}).then(t=>this.user=t).then(()=>{this.image=this.user.avatar})},getInstructors(){for(let t=0;t<this.usersStore.users.length;t++)this.usersStore.users[t].role=="instructor"&&this.instructors.push(this.usersStore.users[t]);for(let t=0;t<this.instructorStudentsStore.instructorStudentsList.length;t++)this.instructorStudentsStore.instructorStudentsList[t].student_id==this.userId&&(this.instructorId=this.instructorStudentsStore.instructorStudentsList[t].instructor_id);this.getUser()},ValidateForm(){this.user.first_name==""||this.user.first_name==null?alert("Please add a first name."):this.user.last_name==""||this.user.last_name==null?alert("Please add a last name."):this.user.username==""||this.user.username==null?alert("Please add a username."):this.user.email==""||this.user.email==null?alert("Please add an email address."):this.Submit()},ValidateEmail(){/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/.test(this.user.email)||alert("Please enter a valid email address")},Submit(){const t={method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({firstname:this.user.first_name,lastname:this.user.last_name,username:this.user.username,email:this.user.email,avatar:this.user.avatar,role:this.user.role,password:this.user.password})};var e="/users/"+this.userId+"/edit";fetch(e,t).then(()=>{if(this.user.role=="student"){const m={method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({instructor_id:this.instructorId})};var d="/users/"+this.userId+"/edit/instructor";fetch(d,m)}}).then(()=>{this.$router.push("/users")})},onFileChange(t){var e=t.target.files||t.dataTransfer.files;e.length&&this.createImage(e[0])},createImage(t){new Image;var e=new FileReader,d=this;e.onload=m=>{d.image=m.target.result,this.image=m.target.result,this.user.avatar=this.image},e.readAsDataURL(t)},removeImage:function(t){this.image="",this.user.avatar=this.image}}},o=t=>(k("data-v-8e3c75bf"),t=t(),C(),t),L={class:"container mt-3 pb-5"},P=o(()=>s("div",{class:"row"},[s("div",{class:"col-10 d-flex align-items-end"},[s("h2",{id:"header-tile"},"Edit User"),s("img",{src:E,id:"header-icon"})])],-1)),N={class:"container-fluid main-content-container p-4 mt-5"},T={class:"row"},j={class:"col-lg-4 mt-3"},B={class:"mb-3 row"},O={key:0},R=o(()=>s("p",{style:{"font-size":"14px"}},[s("em",null,"Maximum file size 15mb")],-1)),D={key:1},J=["src"],M={class:"col-lg-4"},q={class:"mb-3"},z={for:"firstname",class:"form-label"},A={class:"mb-3"},G=o(()=>s("label",{for:"lastname",class:"form-label"},"Last name",-1)),H={class:"mb-3"},K=o(()=>s("label",{class:"form-label"},"Username",-1)),Q={class:"mb-3"},W=o(()=>s("label",{class:"form-label"},"Email address",-1)),X={class:"mb-3"},Y=o(()=>s("label",{class:"form-label"},"Role",-1)),Z=o(()=>s("option",{value:"admin"},"admin",-1)),$=o(()=>s("option",{value:"instructor"},"instructor",-1)),ss=o(()=>s("option",{value:"student"},"student",-1)),es=[Z,$,ss],ts={key:0,class:"mb-3"},rs=o(()=>s("label",{class:"form-label"},"Instructor",-1)),is=["value"],os={class:"mb-3"},ns=o(()=>s("label",{class:"form-label"},"Password",-1)),ls={class:"d-flex justify-content-between"};function as(t,e,d,m,i,n){const g=I("router-link");return a(),u("div",L,[P,s("div",N,[s("div",T,[s("div",j,[s("div",B,[i.image?(a(),u("div",D,[s("p",null,[s("img",{src:i.image,height:"300",style:{"background-color":"lightgrey"}},null,8,J)]),s("p",null,[s("button",{class:"btn btn-warning",onClick:e[1]||(e[1]=(...r)=>n.removeImage&&n.removeImage(...r))}," Remove image ")])])):(a(),u("div",O,[s("input",{class:"form-control",type:"file",accept:"image/*",onChange:e[0]||(e[0]=(...r)=>n.onFileChange&&n.onFileChange(...r))},null,32),R]))])]),s("div",M,[s("div",q,[s("label",z,"First name "+h(t.firstName),1),l(s("input",{"onUpdate:modelValue":e[2]||(e[2]=r=>i.user.first_name=r),type:"text",class:"form-control"},null,512),[[c,i.user.first_name]])]),s("div",A,[G,l(s("input",{"onUpdate:modelValue":e[3]||(e[3]=r=>i.user.last_name=r),type:"text",class:"form-control"},null,512),[[c,i.user.last_name]])]),s("div",H,[K,l(s("input",{"onUpdate:modelValue":e[4]||(e[4]=r=>i.user.username=r),type:"text",class:"form-control"},null,512),[[c,i.user.username]])]),s("div",Q,[W,l(s("input",{"onUpdate:modelValue":e[5]||(e[5]=r=>i.user.email=r),type:"email",class:"form-control",onBlur:e[6]||(e[6]=(...r)=>n.ValidateEmail&&n.ValidateEmail(...r))},null,544),[[c,i.user.email]])]),s("div",X,[Y,l(s("select",{"onUpdate:modelValue":e[7]||(e[7]=r=>i.user.role=r),class:"form-select"},es,512),[[_,i.user.role]])]),i.user.role=="student"?(a(),u("div",ts,[rs,l(s("select",{"onUpdate:modelValue":e[8]||(e[8]=r=>i.instructorId=r),class:"form-select"},[(a(!0),u(f,null,y(i.instructors,r=>(a(),u("option",{value:r.id},h(r.username),9,is))),256))],512),[[_,i.instructorId]])])):U("",!0),s("div",os,[ns,l(s("input",{"onUpdate:modelValue":e[9]||(e[9]=r=>i.user.password=r),type:"text",class:"form-control"},null,512),[[c,i.user.password]])]),s("div",ls,[p(g,{class:"btn btn-dark",to:"/users"},{default:V(()=>[x(" Cancel ")]),_:1}),s("button",{class:"btn btn-dark",onClick:e[10]||(e[10]=r=>n.ValidateForm())},"Submit")])])])])])}const us=w(F,[["render",as],["__scopeId","data-v-8e3c75bf"]]),ds=s("div",{id:"banner"},[s("img",{src:v,class:"image-fluid"})],-1),ps={__name:"EditUserView",setup(t){return(e,d)=>(a(),u(f,null,[ds,p(us)],64))}};export{ps as default};
