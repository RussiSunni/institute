import{_ as L,o as $,c as P,p as K,a as j,b as y,w as st,v as ot,u as rt,d as at,r as Y,e as S,F as Q,f as lt,g as R,S as dt}from"./main-bc26cb8e.js";import{S as ct,z as ht,s as k,i as z,h as H,t as J,a as pt,l as U,c as ft}from"./zoom-eee0c804.js";const T=(t,e)=>{const i=e.x-t.x,s=e.y-t.y;return Math.sqrt(i*i+s*s)},ut=(t,e)=>{const i=e.x-t.x,s=e.y-t.y;return vt(Math.atan2(s,i))},yt=(t,e,i)=>{const s={x:0,y:0};return i=N(i),s.x=t.x-e*Math.cos(i),s.y=t.y-e*Math.sin(i),s},N=t=>t*(Math.PI/180),vt=t=>t*(180/Math.PI),mt=t=>isNaN(t.buttons)?t.pressure!==0:t.buttons!==0,X=new Map,Z=t=>{X.has(t)&&clearTimeout(X.get(t)),X.set(t,setTimeout(t,100))},O=(t,e,i)=>{const s=e.split(/[ ,]+/g);let n;for(let o=0;o<s.length;o+=1)n=s[o],t.addEventListener?t.addEventListener(n,i,!1):t.attachEvent&&t.attachEvent(n,i)},V=(t,e,i)=>{const s=e.split(/[ ,]+/g);let n;for(let o=0;o<s.length;o+=1)n=s[o],t.removeEventListener?t.removeEventListener(n,i):t.detachEvent&&t.detachEvent(n,i)},tt=t=>(t.preventDefault(),t.type.match(/^touch/)?t.changedTouches:t),W=()=>{const t=window.pageXOffset!==void 0?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,e=window.pageYOffset!==void 0?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop;return{x:t,y:e}},G=(t,e)=>{e.top||e.right||e.bottom||e.left?(t.style.top=e.top,t.style.right=e.right,t.style.bottom=e.bottom,t.style.left=e.left):(t.style.left=e.x+"px",t.style.top=e.y+"px")},A=(t,e,i)=>{const s=et(t);for(let n in s)if(s.hasOwnProperty(n))if(typeof e=="string")s[n]=e+" "+i;else{let o="";for(let c=0,a=e.length;c<a;c+=1)o+=e[c]+" "+i+", ";s[n]=o.slice(0,-2)}return s},gt=(t,e)=>{const i=et(t);for(let s in i)i.hasOwnProperty(s)&&(i[s]=e);return i},et=t=>{const e={};return e[t]="",["webkit","Moz","o"].forEach(function(s){e[s+t.charAt(0).toUpperCase()+t.slice(1)]=""}),e},M=(t,e)=>{for(let i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);return t},xt=(t,e)=>{const i={};for(let s in t)t.hasOwnProperty(s)&&e.hasOwnProperty(s)?i[s]=e[s]:t.hasOwnProperty(s)&&(i[s]=t[s]);return i},F=(t,e)=>{if(t.length)for(let i=0,s=t.length;i<s;i+=1)e(t[i]);else e(t)},_t=(t,e,i)=>({x:Math.min(Math.max(t.x,e.x-i),e.x+i),y:Math.min(Math.max(t.y,e.y-i),e.y+i)});var kt="ontouchstart"in window,wt=!!window.PointerEvent,$t=!!window.MSPointerEvent,w={touch:{start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},mouse:{start:"mousedown",move:"mousemove",end:"mouseup"},pointer:{start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"},MSPointer:{start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}},g,b={};wt?g=w.pointer:$t?g=w.MSPointer:kt?(g=w.touch,b=w.mouse):g=w.mouse;function v(){}v.prototype.on=function(t,e){var i=this,s=t.split(/[ ,]+/g),n;i._handlers_=i._handlers_||{};for(var o=0;o<s.length;o+=1)n=s[o],i._handlers_[n]=i._handlers_[n]||[],i._handlers_[n].push(e);return i};v.prototype.off=function(t,e){var i=this;return i._handlers_=i._handlers_||{},t===void 0?i._handlers_={}:e===void 0?i._handlers_[t]=null:i._handlers_[t]&&i._handlers_[t].indexOf(e)>=0&&i._handlers_[t].splice(i._handlers_[t].indexOf(e),1),i};v.prototype.trigger=function(t,e){var i=this,s=t.split(/[ ,]+/g),n;i._handlers_=i._handlers_||{};for(var o=0;o<s.length;o+=1)n=s[o],i._handlers_[n]&&i._handlers_[n].length&&i._handlers_[n].forEach(function(c){c.call(i,{type:n,target:i},e)})};v.prototype.config=function(t){var e=this;e.options=e.defaults||{},t&&(e.options=xt(e.options,t))};v.prototype.bindEvt=function(t,e){var i=this;return i._domHandlers_=i._domHandlers_||{},i._domHandlers_[e]=function(){typeof i["on"+e]=="function"?i["on"+e].apply(i,arguments):console.warn('[WARNING] : Missing "on'+e+'" handler.')},O(t,g[e],i._domHandlers_[e]),b[e]&&O(t,b[e],i._domHandlers_[e]),i};v.prototype.unbindEvt=function(t,e){var i=this;return i._domHandlers_=i._domHandlers_||{},V(t,g[e],i._domHandlers_[e]),b[e]&&V(t,b[e],i._domHandlers_[e]),delete i._domHandlers_[e],this};function p(t,e){return this.identifier=e.identifier,this.position=e.position,this.frontPosition=e.frontPosition,this.collection=t,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(e),this.options.mode==="dynamic"&&(this.options.restOpacity=0),this.id=p.id,p.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}p.prototype=new v;p.constructor=p;p.id=0;p.prototype.buildEl=function(t){return this.ui={},this.options.dataOnly?this:(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front),this)};p.prototype.stylize=function(){if(this.options.dataOnly)return this;var t=this.options.fadeTime+"ms",e=gt("borderRadius","50%"),i=A("transition","opacity",t),s={};return s.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},s.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},s.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},M(s.el,i),this.options.shape==="circle"&&M(s.back,e),M(s.front,e),this.applyStyles(s),this};p.prototype.applyStyles=function(t){for(var e in this.ui)if(this.ui.hasOwnProperty(e))for(var i in t[e])this.ui[e].style[i]=t[e][i];return this};p.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)?this:(this.options.zone.appendChild(this.ui.el),this)};p.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)?this:(this.options.zone.removeChild(this.ui.el),this)};p.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()};p.prototype.show=function(t){var e=this;return e.options.dataOnly||(clearTimeout(e.removeTimeout),clearTimeout(e.showTimeout),clearTimeout(e.restTimeout),e.addToDom(),e.restCallback(),setTimeout(function(){e.ui.el.style.opacity=1},0),e.showTimeout=setTimeout(function(){e.trigger("shown",e.instance),typeof t=="function"&&t.call(this)},e.options.fadeTime)),e};p.prototype.hide=function(t){var e=this;if(e.options.dataOnly)return e;if(e.ui.el.style.opacity=e.options.restOpacity,clearTimeout(e.removeTimeout),clearTimeout(e.showTimeout),clearTimeout(e.restTimeout),e.removeTimeout=setTimeout(function(){var i=e.options.mode==="dynamic"?"none":"block";e.ui.el.style.display=i,typeof t=="function"&&t.call(e),e.trigger("hidden",e.instance)},e.options.fadeTime),e.options.restJoystick){const i=e.options.restJoystick,s={};s.x=i===!0||i.x!==!1?0:e.instance.frontPosition.x,s.y=i===!0||i.y!==!1?0:e.instance.frontPosition.y,e.setPosition(t,s)}return e};p.prototype.setPosition=function(t,e){var i=this;i.frontPosition={x:e.x,y:e.y};var s=i.options.fadeTime+"ms",n={};n.front=A("transition",["transform"],s);var o={front:{}};o.front={transform:"translate("+i.frontPosition.x+"px,"+i.frontPosition.y+"px)"},i.applyStyles(n),i.applyStyles(o),i.restTimeout=setTimeout(function(){typeof t=="function"&&t.call(i),i.restCallback()},i.options.fadeTime)};p.prototype.restCallback=function(){var t=this,e={};e.front=A("transition","none",""),t.applyStyles(e),t.trigger("rested",t.instance)};p.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}};p.prototype.computeDirection=function(t){var e=t.angle.radian,i=Math.PI/4,s=Math.PI/2,n,o,c;if(e>i&&e<i*3&&!t.lockX?n="up":e>-i&&e<=i&&!t.lockY?n="left":e>-i*3&&e<=-i&&!t.lockX?n="down":t.lockY||(n="right"),t.lockY||(e>-s&&e<s?o="left":o="right"),t.lockX||(e>0?c="up":c="down"),t.force>this.options.threshold){var a={},r;for(r in this.direction)this.direction.hasOwnProperty(r)&&(a[r]=this.direction[r]);var l={};this.direction={x:o,y:c,angle:n},t.direction=this.direction;for(r in a)a[r]===this.direction[r]&&(l[r]=!0);if(l.x&&l.y&&l.angle)return t;(!l.x||!l.y)&&this.trigger("plain",t),l.x||this.trigger("plain:"+o,t),l.y||this.trigger("plain:"+c,t),l.angle||this.trigger("dir dir:"+n,t)}else this.resetDirection();return t};function h(t,e){var i=this;i.nipples=[],i.idles=[],i.actives=[],i.ids=[],i.pressureIntervals={},i.manager=t,i.id=h.id,h.id+=1,i.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},i.config(e),(i.options.mode==="static"||i.options.mode==="semi")&&(i.options.multitouch=!1),i.options.multitouch||(i.options.maxNumberOfNipples=1);const s=getComputedStyle(i.options.zone.parentElement);return s&&s.display==="flex"&&(i.parentIsFlex=!0),i.updateBox(),i.prepareNipples(),i.bindings(),i.begin(),i.nipples}h.prototype=new v;h.constructor=h;h.id=0;h.prototype.prepareNipples=function(){var t=this,e=t.nipples;e.on=t.on.bind(t),e.off=t.off.bind(t),e.options=t.options,e.destroy=t.destroy.bind(t),e.ids=t.ids,e.id=t.id,e.processOnMove=t.processOnMove.bind(t),e.processOnEnd=t.processOnEnd.bind(t),e.get=function(i){if(i===void 0)return e[0];for(var s=0,n=e.length;s<n;s+=1)if(e[s].identifier===i)return e[s];return!1}};h.prototype.bindings=function(){var t=this;t.bindEvt(t.options.zone,"start"),t.options.zone.style.touchAction="none",t.options.zone.style.msTouchAction="none"};h.prototype.begin=function(){var t=this,e=t.options;if(e.mode==="static"){var i=t.createNipple(e.position,t.manager.getIdentifier());i.add(),t.idles.push(i)}};h.prototype.createNipple=function(t,e){var i=this,s=i.manager.scroll,n={},o=i.options,c={x:i.parentIsFlex?s.x:s.x+i.box.left,y:i.parentIsFlex?s.y:s.y+i.box.top};if(t.x&&t.y)n={x:t.x-c.x,y:t.y-c.y};else if(t.top||t.right||t.bottom||t.left){var a=document.createElement("DIV");a.style.display="hidden",a.style.top=t.top,a.style.right=t.right,a.style.bottom=t.bottom,a.style.left=t.left,a.style.position="absolute",o.zone.appendChild(a);var r=a.getBoundingClientRect();o.zone.removeChild(a),n=t,t={x:r.left+s.x,y:r.top+s.y}}var l=new p(i,{color:o.color,size:o.size,threshold:o.threshold,fadeTime:o.fadeTime,dataOnly:o.dataOnly,restJoystick:o.restJoystick,restOpacity:o.restOpacity,mode:o.mode,identifier:e,position:t,zone:o.zone,frontPosition:{x:0,y:0},shape:o.shape});return o.dataOnly||(G(l.ui.el,n),G(l.ui.front,l.frontPosition)),i.nipples.push(l),i.trigger("added "+l.identifier+":added",l),i.manager.trigger("added "+l.identifier+":added",l),i.bindNipple(l),l};h.prototype.updateBox=function(){var t=this;t.box=t.options.zone.getBoundingClientRect()};h.prototype.bindNipple=function(t){var e=this,i,s=function(n,o){i=n.type+" "+o.id+":"+n.type,e.trigger(i,o)};t.on("destroyed",e.onDestroyed.bind(e)),t.on("shown hidden rested dir plain",s),t.on("dir:up dir:right dir:down dir:left",s),t.on("plain:up plain:right plain:down plain:left",s)};h.prototype.pressureFn=function(t,e,i){var s=this,n=0;clearInterval(s.pressureIntervals[i]),s.pressureIntervals[i]=setInterval(function(){var o=t.force||t.pressure||t.webkitForce||0;o!==n&&(e.trigger("pressure",o),s.trigger("pressure "+e.identifier+":pressure",o),n=o)}.bind(s),100)};h.prototype.onstart=function(t){var e=this,i=e.options,s=t;t=tt(t),e.updateBox();var n=function(o){e.actives.length<i.maxNumberOfNipples?e.processOnStart(o):s.type.match(/^touch/)&&(Object.keys(e.manager.ids).forEach(function(c){if(Object.values(s.touches).findIndex(function(r){return r.identifier===c})<0){var a=[t[0]];a.identifier=c,e.processOnEnd(a)}}),e.actives.length<i.maxNumberOfNipples&&e.processOnStart(o))};return F(t,n),e.manager.bindDocument(),!1};h.prototype.processOnStart=function(t){var e=this,i=e.options,s,n=e.manager.getIdentifier(t),o=t.force||t.pressure||t.webkitForce||0,c={x:t.pageX,y:t.pageY},a=e.getOrCreate(n,c);a.identifier!==n&&e.manager.removeIdentifier(a.identifier),a.identifier=n;var r=function(d){d.trigger("start",d),e.trigger("start "+d.id+":start",d),d.show(),o>0&&e.pressureFn(t,d,d.identifier),e.processOnMove(t)};if((s=e.idles.indexOf(a))>=0&&e.idles.splice(s,1),e.actives.push(a),e.ids.push(a.identifier),i.mode!=="semi")r(a);else{var l=T(c,a.position);if(l<=i.catchDistance)r(a);else{a.destroy(),e.processOnStart(t);return}}return a};h.prototype.getOrCreate=function(t,e){var i=this,s=i.options,n;return/(semi|static)/.test(s.mode)?(n=i.idles[0],n?(i.idles.splice(0,1),n):s.mode==="semi"?i.createNipple(e,t):(console.warn("Coudln't find the needed nipple."),!1)):(n=i.createNipple(e,t),n)};h.prototype.processOnMove=function(t){var e=this,i=e.options,s=e.manager.getIdentifier(t),n=e.nipples.get(s),o=e.manager.scroll;if(!mt(t)){this.processOnEnd(t);return}if(!n){console.error("Found zombie joystick with ID "+s),e.manager.removeIdentifier(s);return}if(i.dynamicPage){var c=n.el.getBoundingClientRect();n.position={x:o.x+c.left,y:o.y+c.top}}n.identifier=s;var a=n.options.size/2,r={x:t.pageX,y:t.pageY};i.lockX&&(r.y=n.position.y),i.lockY&&(r.x=n.position.x);var l=T(r,n.position),d=ut(r,n.position),x=N(d),C=l/a,u={distance:l,position:r},I,m;if(n.options.shape==="circle"?(I=Math.min(l,a),m=yt(n.position,I,d)):(m=_t(r,n.position,a),I=T(m,n.position)),i.follow){if(l>a){let it=r.x-m.x,nt=r.y-m.y;n.position.x+=it,n.position.y+=nt,n.el.style.top=n.position.y-(e.box.top+o.y)+"px",n.el.style.left=n.position.x-(e.box.left+o.x)+"px",l=T(r,n.position)}}else r=m,l=I;var E=r.x-n.position.x,D=r.y-n.position.y;n.frontPosition={x:E,y:D},i.dataOnly||(n.ui.front.style.transform="translate("+E+"px,"+D+"px)");var _={identifier:n.identifier,position:r,force:C,pressure:t.force||t.pressure||t.webkitForce||0,distance:l,angle:{radian:x,degree:d},vector:{x:E/a,y:-D/a},raw:u,instance:n,lockX:i.lockX,lockY:i.lockY};_=n.computeDirection(_),_.angle={radian:N(180-d),degree:180-d},n.trigger("move",_),e.trigger("move "+n.id+":move",_)};h.prototype.processOnEnd=function(t){var e=this,i=e.options,s=e.manager.getIdentifier(t),n=e.nipples.get(s),o=e.manager.removeIdentifier(n.identifier);n&&(i.dataOnly||n.hide(function(){i.mode==="dynamic"&&(n.trigger("removed",n),e.trigger("removed "+n.id+":removed",n),e.manager.trigger("removed "+n.id+":removed",n),n.destroy())}),clearInterval(e.pressureIntervals[n.identifier]),n.resetDirection(),n.trigger("end",n),e.trigger("end "+n.id+":end",n),e.ids.indexOf(n.identifier)>=0&&e.ids.splice(e.ids.indexOf(n.identifier),1),e.actives.indexOf(n)>=0&&e.actives.splice(e.actives.indexOf(n),1),/(semi|static)/.test(i.mode)?e.idles.push(n):e.nipples.indexOf(n)>=0&&e.nipples.splice(e.nipples.indexOf(n),1),e.manager.unbindDocument(),/(semi|static)/.test(i.mode)&&(e.manager.ids[o.id]=o.identifier))};h.prototype.onDestroyed=function(t,e){var i=this;i.nipples.indexOf(e)>=0&&i.nipples.splice(i.nipples.indexOf(e),1),i.actives.indexOf(e)>=0&&i.actives.splice(i.actives.indexOf(e),1),i.idles.indexOf(e)>=0&&i.idles.splice(i.idles.indexOf(e),1),i.ids.indexOf(e.identifier)>=0&&i.ids.splice(i.ids.indexOf(e.identifier),1),i.manager.removeIdentifier(e.identifier),i.manager.unbindDocument()};h.prototype.destroy=function(){var t=this;t.unbindEvt(t.options.zone,"start"),t.nipples.forEach(function(i){i.destroy()});for(var e in t.pressureIntervals)t.pressureIntervals.hasOwnProperty(e)&&clearInterval(t.pressureIntervals[e]);t.trigger("destroyed",t.nipples),t.manager.unbindDocument(),t.off()};function f(t){var e=this;e.ids={},e.index=0,e.collections=[],e.scroll=W(),e.config(t),e.prepareCollections();var i=function(){var n;e.collections.forEach(function(o){o.forEach(function(c){n=c.el.getBoundingClientRect(),c.position={x:e.scroll.x+n.left,y:e.scroll.y+n.top}})})};O(window,"resize",function(){Z(i)});var s=function(){e.scroll=W()};return O(window,"scroll",function(){Z(s)}),e.collections}f.prototype=new v;f.constructor=f;f.prototype.prepareCollections=function(){var t=this;t.collections.create=t.create.bind(t),t.collections.on=t.on.bind(t),t.collections.off=t.off.bind(t),t.collections.destroy=t.destroy.bind(t),t.collections.get=function(e){var i;return t.collections.every(function(s){return i=s.get(e),!i}),i}};f.prototype.create=function(t){return this.createCollection(t)};f.prototype.createCollection=function(t){var e=this,i=new h(e,t);return e.bindCollection(i),e.collections.push(i),i};f.prototype.bindCollection=function(t){var e=this,i,s=function(n,o){i=n.type+" "+o.id+":"+n.type,e.trigger(i,o)};t.on("destroyed",e.onDestroyed.bind(e)),t.on("shown hidden rested dir plain",s),t.on("dir:up dir:right dir:down dir:left",s),t.on("plain:up plain:right plain:down plain:left",s)};f.prototype.bindDocument=function(){var t=this;t.binded||(t.bindEvt(document,"move").bindEvt(document,"end"),t.binded=!0)};f.prototype.unbindDocument=function(t){var e=this;(!Object.keys(e.ids).length||t===!0)&&(e.unbindEvt(document,"move").unbindEvt(document,"end"),e.binded=!1)};f.prototype.getIdentifier=function(t){var e;return t?(e=t.identifier===void 0?t.pointerId:t.identifier,e===void 0&&(e=this.latest||0)):e=this.index,this.ids[e]===void 0&&(this.ids[e]=this.index,this.index+=1),this.latest=e,this.ids[e]};f.prototype.removeIdentifier=function(t){var e={};for(var i in this.ids)if(this.ids[i]===t){e.id=i,e.identifier=this.ids[i],delete this.ids[i];break}return e};f.prototype.onmove=function(t){var e=this;return e.onAny("move",t),!1};f.prototype.onend=function(t){var e=this;return e.onAny("end",t),!1};f.prototype.oncancel=function(t){var e=this;return e.onAny("end",t),!1};f.prototype.onAny=function(t,e){var i=this,s,n="processOn"+t.charAt(0).toUpperCase()+t.slice(1);e=tt(e);var o=function(a,r,l){l.ids.indexOf(r)>=0&&(l[n](a),a._found_=!0)},c=function(a){s=i.getIdentifier(a),F(i.collections,o.bind(null,a,s)),a._found_||i.removeIdentifier(s)};return F(e,c),!1};f.prototype.destroy=function(){var t=this;t.unbindDocument(!0),t.ids={},t.index=0,t.collections.forEach(function(e){e.destroy()}),t.off()};f.prototype.onDestroyed=function(t,e){var i=this;if(i.collections.indexOf(e)<0)return!1;i.collections.splice(i.collections.indexOf(e),1)};const q=new f,bt={create:function(t){return q.create(t)},factory:q};const It={setup(){},data(){return{holdTime:0,interval:null,fps:10,holdTimeInterval:null,fnZoomKey:!1,lefClick:!1,oldMY:0,oldScale:0}},computed:{},async mounted(){this.oldScale=this.$parent.scale;var t=bt.create({zone:document.getElementById("panJoystick"),mode:"static",position:{left:"25%",top:"25%"},color:"blue"});const e=Math.floor(1e3/this.fps)+1;t.on("dir:up plain:up dir:left plain:left dir:down plain:down dir:right plain:right",(i,s)=>{clearInterval(this.interval),this.interval=null,this.holdTime=0;const n=this.$parent.scale>=1?this.$parent.scale*10:20/this.$parent.scale,o=this.$parent.scale>1?this.$parent.scale*15:20/this.$parent.scale;if(this.interval==null)switch(s.direction.angle){case"right":this.interval=setInterval(()=>{this.$parent.panX=this.$parent.panX-20-(this.holdTime*o+n),this.$parent.panInD3(this.$parent.panX,this.$parent.panY)},e);break;case"left":this.interval=setInterval(()=>{this.$parent.panX=this.$parent.panX+20+(this.holdTime*o+n),this.$parent.panInD3(this.$parent.panX,this.$parent.panY)},e);break;case"up":this.interval=setInterval(()=>{this.$parent.panY=this.$parent.panY+20+(this.holdTime*o+n),this.$parent.panInD3(this.$parent.panX,this.$parent.panY)},e);break;case"down":this.interval=setInterval(()=>{this.$parent.panY=this.$parent.panY-20-(this.holdTime*o+n),this.$parent.panInD3(this.$parent.panX,this.$parent.panY)},e);break}}).on("end",(i,s)=>{clearInterval(this.interval)}),t.on("start",(i,s)=>{this.holdTimeInterval=setInterval(()=>{this.holdTime+=1},300)}).on("end",(i,s)=>{clearInterval(this.holdTimeInterval),this.holdTime=0,this.interval=null}),this.$parent.$refs.canvas.addEventListener("keydown",i=>{if(this.interval==null){this.holdTimeInterval=setInterval(()=>{this.holdTime+=1},300);const s=this.$parent.scale>=1?this.$parent.scale/10:50/this.$parent.scale,n=this.$parent.scale>1?this.$parent.scale*15:10/this.$parent.scale;switch(i.code){case"ArrowRight":this.interval=setInterval(()=>{this.$parent.panX=this.$parent.panX-20-(this.holdTime*n+s),this.$parent.panInD3(this.$parent.panX,this.$parent.panY)},e);break;case"ArrowLeft":this.interval=setInterval(()=>{this.$parent.panX=this.$parent.panX+20+(this.holdTime*n+s),this.$parent.panInD3(this.$parent.panX,this.$parent.panY)},e);break;case"ArrowUp":this.interval=setInterval(()=>{this.$parent.panY=this.$parent.panY+20+(this.holdTime*n+s),this.$parent.panInD3(this.$parent.panX,this.$parent.panY)},e);break;case"ArrowDown":this.interval=setInterval(()=>{this.$parent.panY=this.$parent.panY-20-(this.holdTime*n+s),this.$parent.panInD3(this.$parent.panX,this.$parent.panY)},e);break;case"PageUp":this.interval=setInterval(()=>{this.$parent.scale=this.$parent.scale+.03,this.$parent.zoomInD3(this.$parent.scale)},50);break;case"PageDown":this.interval=setInterval(()=>{this.$parent.scale=this.$parent.scale-.03,this.$parent.zoomInD3(this.$parent.scale)},50);break}}(i.code.includes("Shift")||i.code.includes("Control"))&&(this.fnZoomKey=!0,i.preventDefault()),i.code.includes("Arrow")&&i.preventDefault()},!1),this.$parent.$refs.canvas.addEventListener("keyup",i=>{clearInterval(this.interval),clearInterval(this.holdTimeInterval),this.interval=null,this.holdTime=0,(i.code.includes("Shift")||i.code.includes("Control"))&&(this.fnZoomKey=!1)},!1),this.$parent.$refs.canvas.addEventListener("mousemove",i=>{if(this.fnZoomKey)if(i.pageY<this.oldMY){this.$parent.scale+=.005;const s=this.oldScale/this.$parent.scale;let n=this.$parent.scale>=1?this.$parent.panX:this.$parent.panX*this.$parent.scale,o=this.$parent.scale>=1?this.$parent.panY:this.$parent.panY*this.$parent.scale;n=n*s,o=o*s,this.oldScale=this.$parent.scale,this.$parent.zoomInD3(this.$parent.scale,n,o)}else{this.$parent.scale-=.005;const s=this.oldScale/this.$parent.scale;let n=this.$parent.scale>=1?this.$parent.panX:this.$parent.panX*this.$parent.scale,o=this.$parent.scale>=1?this.$parent.panY:this.$parent.panY*this.$parent.scale;n=n*s,o=o*s,this.oldScale=this.$parent.scale,this.$parent.zoomInD3(this.$parent.scale,n,o)}this.oldMY=i.pageY})},watch:{},methods:{}},St=t=>(K("data-v-2162595e"),t=t(),j(),t),Tt={id:"controlsWrapper"},Ot=St(()=>y("div",{id:"panJoystick"},null,-1)),Pt=[Ot];function Ct(t,e,i,s,n,o){return $(),P("div",Tt,Pt)}const Et=L(It,[["render",Ct],["__scopeId","data-v-2162595e"]]);const Dt={setup(){},data(){return{oldScale:0}},computed:{},async mounted(){let t=document.getElementById("zoomRange");t.step="0.1",this.oldScale=this.$parent.scale,t.addEventListener("mouseup",()=>{const e=this.oldScale/this.$parent.scale;let i=t.value>=1?this.$parent.panX:this.$parent.panX*t.value,s=t.value>=1?this.$parent.panY:this.$parent.panY*t.value;i=i*e,s=s*e,this.$parent.scale=t.value,this.oldScale=t.value,this.$parent.zoomInD3(t.value,i,s)}),t.addEventListener("touchend",()=>{const e=t.value/this.$parent.scale;let i=t.value>=1?this.$parent.panX:this.$parent.panX*t.value,s=t.value>=1?this.$parent.panY:this.$parent.panY*t.value;i=i*e,s=s*e,this.$parent.scale=t.value,this.$parent.zoomInD3(t.value,i,s)})},methods:{}},Yt={id:"sliderWrapper"},zt={class:"slideContainer"};function Xt(t,e,i,s,n,o){return $(),P("div",Yt,[y("div",zt,[st(y("input",{type:"range",min:"0.05",max:"2","onUpdate:modelValue":e[0]||(e[0]=c=>this.$parent.scale=c),class:"verticalSlider",id:"zoomRange",step:"0.01"},null,512),[[ot,this.$parent.scale]])])])}const Mt=L(Dt,[["render",Xt],["__scopeId","data-v-9e81b16c"]]);const Nt={setup(){const t=rt(),e=at();return{userDetailsStore:t,skillTreeStore:e}},data(){return{width:6e3,height:null,skill:{id:null,children:[],isMastered:null,isUnlocked:null,container:null,name:null,description:null,tagIDs:[],sprite:null,type:null},tree:{},root:{},context:{},hiddenCanvasContext:{},scaleMultiplier:.8,startDragOffset:{x:0,y:0},mouseDown:!1,r:1.5,nodes:[],nextCol:1,colToNode:{},isSkillInfoPanelShown:!1,scale:.3,panX:0,panY:0,hiddenCanvasInitiated:!1,data:{},d3Zoom:null}},components:{SkillPanel:ct,JoystickControl:Et,SliderControl:Mt},async mounted(){this.skillTreeStore.userSkills.length==0&&await this.skillTreeStore.getUserSkills(),this.height=window.innerHeight,this.skill={name:"SKILLS",sprite:null,children:this.skillTreeStore.userSkills},this.getAlgorithm();let t=document.getElementById("hidden-canvas");this.hiddenCanvasContext=t.getContext("2d"),t.style.display="none",canvas.addEventListener("click",e=>{this.nodes;var i=e.layerX,s=e.layerY,n=this.hiddenCanvasContext,o=n.getImageData(i,s,1,1).data,c="rgb("+o[0]+","+o[1]+","+o[2]+")",a=this.colToNode[c];a&&(a.renderCol=a.__pickColor,this.skill.name=a.data.skill_name,this.skill.id=a.data.id,this.skill.type=a.data.type,this.showInfoPanel())}),this.d3Zoom=ht().scaleExtent([.05,5]).on("zoom",({transform:e})=>{this.handleMouseZoom(e)}),k(this.context.canvas).call(this.d3Zoom),k(this.context.canvas).call(this.d3Zoom.transform,z.scale(this.scale))},methods:{getAlgorithm(){var t=[];t=JSON.parse(JSON.stringify(this.skill.children));function e(r){for(var l=r.length;l--;){if(r[l].type=="super"&&r[l].position!="end"){var d=[],x=[];for(let u=0;u<r[l].children.length;u++)r[l].children[u].type=="sub"?d.push(r[l].children[u]):x.push(r[l].children[u]);var C={skill_name:r[l].skill_name,type:"super",position:"end",children:d};r[l].children=[],r[l].children.push(C);for(let u=0;u<x.length;u++)r[l].children.push(x[u])}typeof r[l]<"u"&&r[l].children&&Array.isArray(r[l].children)&&r[l].children.length>0&&e(r[l].children)}}e(t),this.data={skill_name:"My skills",children:t},this.root=H(this.data);const i=24,s=this.width/(this.root.height+1);this.tree=J().nodeSize([i,s]),this.root.sort((r,l)=>pt(r.data.name,l.data.name)),this.tree(this.root);let n=1/0,o=-n;this.root.each(r=>{r.x>o&&(o=r.x),r.x<n&&(n=r.x)});var c=document.getElementById("canvas");c.width=this.width,c.height=this.height,this.context=c.getContext("2d");let a=document.getElementById("hidden-canvas");this.hiddenCanvasContext=a.getContext("2d"),this.drawTree()},drawTree(){this.nodes=this.root.descendants(),this.context.save(),this.hiddenCanvasContext.save(),this.context.clearRect(0,0,this.context.canvas.width,this.context.canvas.height),this.hiddenCanvasContext.clearRect(0,0,this.hiddenCanvasContext.canvas.width,this.hiddenCanvasContext.canvas.height),this.context.scale(this.scale,this.scale),this.hiddenCanvasContext.scale(this.scale,this.scale),this.context.translate(this.panX,this.panY),this.hiddenCanvasContext.translate(this.panX,this.panY);const t=this.root.links();this.context.beginPath();for(const e of t)this.drawLink(e);this.context.beginPath();for(const e of this.nodes)e.renderCol?this.context.fillStyle=e.renderCol:this.context.fillStyle="RGBA(105, 105, 105, 0.8)",e.__pickColor===void 0&&(e.__pickColor=this.genColor(),this.colToNode[e.__pickColor]=e),this.hiddenCanvasContext.fillStyle=e.__pickColor,this.drawNode(e);this.hiddenCanvasContext.restore(),this.context.restore()},drawNode(t){let e=this.context,i=this.hiddenCanvasContext;t.data.type!="domain"?(e.beginPath(),e.arc(t.y,t.x,10,0,2*Math.PI),t.data.is_mastered==1?(e.fillStyle="#000",e.fill()):(e.lineWidth=2,e.fillStyle="#FFF",e.fill(),e.strokeStyle="#000",e.stroke())):(e.beginPath(),e.moveTo(t.y,t.x-10),e.lineTo(t.y-20/2,t.x-10+20/2),e.lineTo(t.y,t.x-10+20),e.lineTo(t.y+20/2,t.x-10+20/2),e.closePath(),t.data.is_mastered==1?(e.fillStyle="#000",e.fill()):t.data.is_accessible==1?(e.lineWidth=2,e.fillStyle="#D3D3D3",e.fill(),e.strokeStyle="#000",e.stroke()):(e.lineWidth=2,e.fillStyle="#FFF",e.fill(),e.strokeStyle="#000",e.stroke())),this.scale>.6&&(e.beginPath(),e.strokeStyle="#FFF",e.lineWidth=4,e.strokeText(t.data.skill_name,t.y+10,t.x+2),e.fillStyle="#000",e.fillText(t.data.skill_name,t.y+10,t.x+2)),t.data.type!="domain"?(i.beginPath(),i.moveTo(t.y,t.x),i.arc(t.y,t.x,10,0,2*Math.PI),i.fill()):(i.beginPath(),i.moveTo(t.y,t.x-10),i.lineTo(t.y-20/2,t.x-10+20/2),i.lineTo(t.y,t.x-10+20),i.lineTo(t.y+20/2,t.x-10+20/2),i.closePath(),i.lineWidth=2,i.fill(),i.stroke())},drawLink(t){const e=U().x(i=>i.y).y(i=>i.x).context(this.context);t.target.data.is_mastered==1?this.context.lineWidth=4:this.context.lineWidth=1,t.source.data.type=="super"&&t.target.data.position=="end"||t.target.data.type=="sub"?this.context.setLineDash([5,3]):this.context.setLineDash([]),this.context.beginPath(),e(t),this.context.strokeStyle="#000",this.context.stroke()},genColor(){var t=[];this.nextCol<16777215&&(t.push(this.nextCol&255),t.push((this.nextCol&65280)>>8),t.push((this.nextCol&16711680)>>16),this.nextCol+=100);var e="rgb("+t.join(",")+")";return e},showInfoPanel(){this.isSkillInfoPanelShown||(this.isSkillInfoPanelShown=!0,screen.width>800?document.getElementById("skillInfoPanel").style.width="474px":document.getElementById("skillInfoPanel").style.height="474px")},hideInfoPanel(){this.isSkillInfoPanelShown&&(screen.width>800?document.getElementById("skillInfoPanel").style.width="0px":document.getElementById("skillInfoPanel").style.height="0px",document.getElementById("sidepanel-backdrop").style.display="none",this.isSkillInfoPanelShown=!1)},async printPDF(){await this.createSVGTree();var t=document.getElementById("linearTree"),e=k(t),i=e.node(),s=new XMLSerializer,n=s.serializeToString(i),o={svg:n,treeType:"linear"},c=JSON.stringify(o),a=new XMLHttpRequest;a.responseType="arraybuffer",a.open("POST","/skilltree/print-pdf",!0),a.setRequestHeader("Content-type","application/json;charset=UTF-8"),a.setRequestHeader("Accept","application/json, text/plain, */*"),a.send(c),a.onload=function(){if(this.readyState==4&&this.status==200){let l=new Blob([a.response],{type:"application/pdf"});const d=window.URL.createObjectURL(l);var r=document.createElement("a");document.body.appendChild(r),r.style="display: none",r.href=d,r.download="My-Skill-Tree.pdf",r.click(),window.URL.revokeObjectURL(d)}}},createSVGTree(){const t=H(this.data),e=15,i=this.width/(t.height+1);J().nodeSize([e,i])(t);let n=1/0,o=-n;t.each(d=>{d.x>o&&(o=d.x),d.x<n&&(n=d.x)});const c=o-n+e*2;let a=ft("svg").attr("id","linearTree").attr("width",this.width).attr("height",c).attr("viewBox",[-i/3,n-e,this.width,c]).attr("style","max-width: 100%; height: auto; font: 10px sans-serif;");const r=a.append("g");r.append("g").attr("fill","none").attr("stroke-opacity",1).selectAll().data(t.links()).join("path").attr("d",U().x(d=>d.y).y(d=>d.x)).attr("stroke",function(d){return"#000"}).attr("stroke-width",function(d){return d.target.data.is_mastered==1?8:1.5}).style("stroke-dasharray",function(d){if(d.source.data.type=="super"&&d.target.data.position=="end"||d.target.data.type=="sub")return 5});const l=r.append("g").attr("stroke-linejoin","round").attr("stroke-width",3).selectAll().data(t.descendants()).join("g").attr("transform",d=>`translate(${d.y},${d.x})`);l.append("circle").attr("fill",d=>d.children?"#555":"#000").attr("r",2.5),l.append("text").style("font-weight",function(d){return d.data.type=="super"?"700":"400"}).style("font-style",function(d){if(d.data.type=="sub")return"italic"}).attr("dy","0.31em").attr("x",d=>d.children?-6:6).attr("text-anchor",d=>d.children?"end":"start").text(function(d){return d.data.position=="end"?"":d.data.skill_name}).clone(!0).lower().attr("stroke",function(d){return"white"}),document.querySelector("#SVGskilltree").append(a.node())},handleMouseZoom(t){this.panX=this.scale>=1?t.x:t.x/this.scale,this.panY=this.scale>=1?t.y:t.y/this.scale,this.scale=t.k,this.drawTree()},zoomInD3(t,e,i){k(this.context.canvas).call(this.d3Zoom.transform,z.translate(e,i).scale(t))},panInD3(t,e){const i=this.scale>=1?t:t*this.scale,s=this.scale>=1?e:e*this.scale;k(this.context.canvas).call(this.d3Zoom.transform,z.translate(i,s).scale(this.scale))}}},B=t=>(K("data-v-7e83ce87"),t=t(),j(),t),Ft={id:"wrapper"},Lt={id:"canvas",width:"1500",height:"1500",ref:"canvas",tabindex:"1"},At=B(()=>y("canvas",{id:"hidden-canvas",width:"1500",height:"1500"},null,-1)),Bt=B(()=>y("div",{id:"SVGskilltree"},null,-1)),Rt=B(()=>y("div",{id:"sidepanel-backdrop"},null,-1));function Ht(t,e,i,s,n,o){const c=Y("SkillPanel"),a=Y("JoystickControl"),r=Y("SliderControl");return $(),P(Q,null,[y("button",{id:"print-btn",class:"btn btn-info",onClick:e[0]||(e[0]=l=>o.printPDF())}," Print "),y("div",Ft,[S(c,{skill:n.skill},null,8,["skill"]),y("canvas",Lt,null,512),At,Bt,S(a),S(r),Rt])],64)}const Jt=L(Nt,[["render",Ht],["__scopeId","data-v-7e83ce87"]]);const Ut=y("div",{id:"thin-purple-banner"},null,-1),Zt=y("span",null,"Loading...",-1),Gt={__name:"TidyTreeView",setup(t){return(e,i)=>($(),P(Q,null,[Ut,($(),lt(dt,null,{default:R(()=>[S(Jt)]),fallback:R(()=>[Zt]),_:1}))],64))}};export{Gt as default};
