import{_ as $,u as L,j as z,S as B,k,l as y,m as n,C as S,T as _,n as x,A as R,B as A,G as j,s as q,q as U,x as E,e as C,o as m,c as v,a as f,h as b,F as M,p as O,b as G,f as V,g as w,y as F}from"./main-3f0d3c81.js";const J={setup(){const t=L(),o=z();return{userDetailsStore:t,skillTreeStore:o}},data(){return{width:null,height:null,skill:{id:null,children:[],isMastered:null,isUnlocked:null,name:null},tree:{},root:{},isSkillInfoPanelShown:!1,dx:null,dy:null,data:{},radius:0,radiusMultiplier:256,firstLevelNodeSize:400,secondLevelNodeSize:100,regularNodeSize:50,subSkillRadius:50}},components:{SkillPanel:B},created(){this.$pixiApp.start(),this.$radialTreeContainer.visible=!0,this.$tidyTreeContainer.visible=!1,this.$pixiApp.renderer.background.color=1442350},async mounted(){this.skillTreeStore.userSkillsSubSkillsSeparate.length==0&&await this.skillTreeStore.getUserSkillsSubSkillsSeparate(),this.$radialTreeContainer.children.length==0&&(this.width=window.innerWidth,this.height=window.innerHeight,this.radius=Math.min(this.width,this.height)/2-30,this.skill={name:"SKILLS",sprite:null,children:this.skillTreeStore.userSkillsSubSkillsSeparate},this.getAlgorithm()),document.querySelector("#skilltree").appendChild(this.$pixiApp.view)},methods:{getAlgorithm(){var t=[];t=JSON.parse(JSON.stringify(this.skill.children)),this.data={skill_name:"My skills",children:t};const o=k().size([2*Math.PI,this.radius*this.radiusMultiplier]).separation((s,c)=>(s.parent==c.parent?1:2)/s.depth);this.root=o(y(this.data)),this.drawTree()},drawTree(){const t=n.from("center-node.png");t.x=this.root.x,t.y=this.root.y,t.anchor.set(.5),this.$radialTreeContainer.addChild(t);const o=this.root.descendants(),s=this.root.links();for(const c of s)this.drawLink(c);for(const c of o)this.drawNode(c)},drawNode(t){let o=new S;o.x=Math.cos(t.x)*t.y,o.y=Math.sin(t.x)*t.y,this.$radialTreeContainer.addChild(o);var s=new n;if(t.data.level=="grade_school"?t.data.is_mastered?s=n.from("images/skill-tree-nodes/grade-school-mastered.png"):t.data.is_accessible?s=n.from("images/skill-tree-nodes/grade-school-unlocked.png"):s=n.from("images/skill-tree-nodes/grade-school-locked.png"):t.data.level=="middle_school"?t.data.is_mastered?s=n.from("images/skill-tree-nodes/middle-school-mastered.png"):t.data.is_accessible?s=n.from("images/skill-tree-nodes/middle-school-unlocked.png"):s=n.from("images/skill-tree-nodes/middle-school-locked.png"):t.data.level=="high_school"?t.data.is_mastered?s=n.from("images/skill-tree-nodes/high-school-mastered.png"):t.data.is_accessible?s=n.from("images/skill-tree-nodes/middle-school-unlocked.png"):s=n.from("images/skill-tree-nodes/middle-school-locked.png"):t.data.level=="college"?t.data.is_mastered?s=n.from("images/skill-tree-nodes/college-mastered.png"):t.data.is_accessible?s=n.from("images/skill-tree-nodes/middle-school-unlocked.png"):s=n.from("images/skill-tree-nodes/middle-school-locked.png"):t.data.level=="phd"?t.data.is_mastered?s=n.from("images/skill-tree-nodes/phd-mastered.png"):t.data.is_accessible?s=n.from("images/skill-tree-nodes/middle-school-unlocked.png"):s=n.from("images/skill-tree-nodes/middle-school-locked.png"):t.data.level=="domain"&&(s=n.from("images/skill-tree-nodes/domain.png")),s.anchor.set(.5),t.depth==1?(s.width=this.firstLevelNodeSize,s.height=this.firstLevelNodeSize):t.depth==2?(s.width=this.secondLevelNodeSize,s.height=this.secondLevelNodeSize):(s.width=this.regularNodeSize,s.height=this.regularNodeSize),o.addChild(s),s.eventMode="static",s.cursor="pointer",s.on("pointerdown",e=>{var r={id:t.data.id,isMastered:t.data.is_mastered,isUnlocked:t.data.is_accessible,name:t.data.skill_name,masteryRequirements:t.data.mastery_requirements,type:t.data.type};this.skill=r,this.isSkillInfoPanelShown||this.showInfoPanel()}),t.data.subskills)for(let e=0;e<t.data.subskills.length;e++){let r=new S,h=360/t.data.subskills.length*e,g=h*Math.PI/180,I=this.subSkillRadius*Math.cos(g),T=this.subSkillRadius*Math.sin(g);r.x=I,r.y=T;var s=new n;t.data.level=="grade_school"?t.data.is_mastered?s=n.from("images/skill-tree-nodes/grade-school-small-mastered.png"):t.data.is_accessible?s=n.from("images/skill-tree-nodes/grade-school-small-unlocked.png"):s=n.from("images/skill-tree-nodes/grade-school-small-locked.png"):t.data.level=="middle_school"?t.data.is_mastered?s=n.from("images/skill-tree-nodes/middle-school-small-mastered.png"):t.data.is_accessible?s=n.from("images/skill-tree-nodes/middle-school-small-unlocked.png"):s=n.from("images/skill-tree-nodes/middle-school-small-locked.png"):t.data.level=="high_school"?t.data.is_mastered?s=n.from("images/skill-tree-nodes/high-school-small-mastered.png"):t.data.is_accessible?s=n.from("images/skill-tree-nodes/high-school-small-unlocked.png"):s=n.from("images/skill-tree-nodes/high-school-small-locked.png"):t.data.level=="college"?t.data.is_mastered?s=n.from("images/skill-tree-nodes/college-smal-mastered.png"):t.data.is_accessible?s=n.from("images/skill-tree-nodes/college-small-unlocked.png"):s=n.from("images/skill-tree-nodes/college-small-locked.png"):t.data.level=="phd"&&(t.data.is_mastered?s=n.from("images/skill-tree-nodes/phd-small-mastered.png"):t.data.is_accessible?s=n.from("images/skill-tree-nodes/phd-small-unlocked.png"):s=n.from("images/skill-tree-nodes/phd-small-locked.png")),s.width=15,s.height=15,s.anchor.set(.5),s.eventMode="static",s.cursor="pointer",s.on("pointerdown",ee=>{var N={id:t.data.subskills[e].id,isMastered:t.data.subskills[e].is_mastered,isUnlocked:t.data.subskills[e].is_accessible,name:t.data.subskills[e].skill_name,masteryRequirements:t.data.subskills[e].mastery_requirements,type:t.data.subskills[e].type};this.skill=N,this.isSkillInfoPanelShown||this.showInfoPanel()}),r.addChild(s);const P=new _({fontFamily:"Poppins900",fontSize:"10",fill:"white",align:"center",strokeThickness:2,stroke:"black"}),u=new x(t.data.subskills[e].skill_name,P);u.angle=h,r.addChild(u),o.addChild(r)}let c,a;t.depth==0?(c=200,a="#000000"):t.depth==1?(c=100,a="#ffffff"):(c=90,a="#ffffff");const l=new _({fontFamily:"Poppins900",fontSize:c,fill:a,align:"center",strokeThickness:6,stroke:"black"});if(t.depth==0){const e=new x(t.data.skill_name,l);e.anchor.set(.5,.5),e.scale.set(.5,.5),o.addChild(e);return}R.load("/font/popins.xml").then(()=>{const e=new A(t.data.skill_name,{fontName:"Poppins-Black",fontSize:90,align:"right"});t.depth==0||t.depth==1?e.anchor.set(.5,.5):t.depth==2?(e.angle=t.x*180/Math.PI-90,o.x>0?(e.angle=e.angle+90,t.children?(e.anchor.set(1,.5),e.x=e.x-80*Math.cos(e.rotation),e.y=e.y-80*Math.sin(e.rotation)):(e.anchor.set(0,.5),e.x=e.x+80*Math.cos(e.rotation),e.y=e.y+80*Math.sin(e.rotation))):(e.anchor.set(0,.5),e.angle=e.angle-90,t.children?(e.x=e.x+80*Math.cos(e.rotation),e.y=e.y+80*Math.sin(e.rotation)):(e.anchor.set(1,.5),e.x=e.x-80*Math.cos(e.rotation),e.y=e.y-80*Math.sin(e.rotation)))):t.depth>2&&(e.angle=t.x*180/Math.PI-90,o.x>0?(e.angle=e.angle+90,t.children?(e.anchor.set(1,.5),e.x=e.x-50*Math.cos(e.rotation),e.y=e.y-50*Math.sin(e.rotation)):(e.anchor.set(0,.5),e.x=e.x+50*Math.cos(e.rotation),e.y=e.y+50*Math.sin(e.rotation))):(e.anchor.set(0,.5),e.angle=e.angle-90,t.children?(e.x=e.x+50*Math.cos(e.rotation),e.y=e.y+50*Math.sin(e.rotation)):(e.anchor.set(1,.5),e.x=e.x-50*Math.cos(e.rotation),e.y=e.y-50*Math.sin(e.rotation)))),e.scale.set(.5,.5),o.addChild(e)})},drawLink(t){const o=new j;t.target.data.is_mastered=="1"?o.lineStyle(16,11251635,1):o.lineStyle(8,11251635,1);var s=Math.cos(t.source.x)*t.source.y,c=Math.sin(t.source.x)*t.source.y;o.moveTo(s,c);var a=Math.cos(t.target.x)*t.target.y,l=Math.sin(t.target.x)*t.target.y;let e,r,i,d;const h=Math.abs(l)/Math.sqrt(l*l+a*a)*(180/Math.PI);s===0?(e=s,r=3e3,i=a-800,d=l*i/a,h>45&&h<90&&(l<0?(d=l+1500,i=d*a/l):(d=l-1500,i=d*a/l))):s>0?(e=s+1500,r=c*e/s,i=a-2e3,a<0&&(i=a+2e3),d=l*i/a,h>45&&h<90&&(l<0?(r=c-1500,e=r*s/c,d=l+2e3,l>0&&(l=l-2e3),i=d*a/l):(r=c+1500,e=r*s/c,d=l-2e3,l<0&&(l=l+2e3),i=d*a/l))):(e=s-1500,r=c*e/s,i=a+2e3,a>0&&(i=a-2e3),d=l*i/a,h>45&&h<90&&(l<0?(r=c-1500,e=r*s/c,d=l+2e3,l>0&&(l=l-2e3),i=d*a/l):(r=c+1500,e=r*s/c,d=l-2e3,l<0&&(l=l+2e3),i=d*a/l))),o.bezierCurveTo(e,r,i,d,a,l),this.$radialTreeContainer.addChild(o)},showInfoPanel(){this.isSkillInfoPanelShown||(this.isSkillInfoPanelShown=!0,screen.width>800?document.getElementById("skillInfoPanel").style.width="474px":document.getElementById("skillInfoPanel").style.height="474px",this.skill.isMastered=="1"?document.getElementById("mastery-checkbox").checked=!0:document.getElementById("mastery-checkbox").checked=!1)},hideInfoPanel(){this.isSkillInfoPanelShown&&(screen.width>800?document.getElementById("skillInfoPanel").style.width="0px":document.getElementById("skillInfoPanel").style.height="0px",document.getElementById("sidepanel-backdrop").style.display="none",this.isSkillInfoPanelShown=!1)},async printPDF(){await this.getPrintAlgorithm();var t=document.getElementById("radialTree"),o=q(t),s=o.node(),c=new XMLSerializer,a=c.serializeToString(s),l={svg:a,treeType:"radial"},e=JSON.stringify(l),r=new XMLHttpRequest;r.responseType="arraybuffer",r.open("POST","/skilltree/print-pdf",!0),r.setRequestHeader("Content-type","application/json;charset=UTF-8"),r.setRequestHeader("Accept","application/json, text/plain, */*"),r.send(e),r.onload=function(){if(this.readyState==4&&this.status==200){let d=new Blob([r.response],{type:"application/pdf"});const h=window.URL.createObjectURL(d);var i=document.createElement("a");document.body.appendChild(i),i.style="display: none",i.href=h,i.download="My-Skill-Tree.pdf",i.click(),window.URL.revokeObjectURL(h)}}},async getPrintAlgorithm(){await this.skillTreeStore.getUserSkills();const t={name:"SKILLS",sprite:null,children:this.skillTreeStore.userSkills};var o=[];o=JSON.parse(JSON.stringify(t.children));function s(a){for(var l=a.length;l--;){if(a[l].type=="super"&&a[l].position!="end"){var e=[],r=[];for(let d=0;d<a[l].children.length;d++)a[l].children[d].type=="sub"?e.push(a[l].children[d]):r.push(a[l].children[d]);var i={skill_name:a[l].skill_name,type:"super",position:"end",children:e};a[l].children=[],a[l].children.push(i);for(let d=0;d<r.length;d++)a[l].children.push(r[d])}typeof a[l]<"u"&&a[l].children&&Array.isArray(a[l].children)&&a[l].children.length>0&&s(a[l].children)}}s(o);const c={skill_name:"My skills",children:o};await this.createSVGTree(c)},async createSVGTree(t){const c=13200.000000000002,a=24e3*.59,e=k().size([2*Math.PI,this.radius*50]).separation((i,d)=>(i.parent==d.parent?1:2)/i.depth)(y(t));let r=U("svg").attr("id","radialTree").attr("width",24e3).attr("height",24e3).attr("viewBox",[-c,-a,24e3,24e3]).attr("style","max-width: 100%; height: auto; font: 10px sans-serif;");r.append("g").attr("fill","none").attr("stroke-opacity",1).selectAll().data(e.links()).join("path").attr("d",E().angle(i=>i.x).radius(i=>i.y)).attr("stroke",function(i){return"#000"}).attr("stroke-width",function(i){return i.target.data.is_mastered==1?4:1.5}).style("stroke-dasharray",function(i){if(i.source.data.type=="super"&&i.target.data.position=="end"||i.target.data.type=="sub")return 5}),r.append("g").selectAll().data(e.descendants()).join("circle").attr("transform",i=>`rotate(${i.x*180/Math.PI-90}) translate(${i.y},0)`).attr("fill","#000").attr("r",2.5),r.append("g").attr("stroke-linejoin","round").attr("stroke-width",1).selectAll().data(e.descendants()).join("text").attr("transform",i=>`rotate(${i.x*180/Math.PI-90}) translate(${i.y},0) rotate(${i.x>=Math.PI?180:0})`).attr("dy","0.31em").attr("x",i=>i.x<Math.PI==!i.children?6:-6).attr("text-anchor",i=>i.x<Math.PI==!i.children?"start":"end").style("font-weight",function(i){return i.data.type=="super"?"700":"400"}).style("font-style",function(i){if(i.data.type=="sub")return"italic"}).style("paint-order",function(i){return"stroke"}).clone(!0).lower().style("stroke-width",function(i){return"1px"}).text(function(i){return i.data.position=="end"?"":i.data.skill_name}),document.querySelector("#SVGskilltree").append(r.node())}}},p=t=>(O("data-v-e6e501f2"),t=t(),G(),t),D={id:"wrapper"},H=p(()=>f("div",{id:"skilltree"},null,-1)),X=p(()=>f("div",{id:"SVGskilltree"},null,-1)),K=p(()=>f("div",{id:"sidepanel-backdrop"},null,-1));function W(t,o,s,c,a,l){const e=C("SkillPanel");return m(),v(M,null,[f("button",{id:"print-btn",class:"btn btn-info",onClick:o[0]||(o[0]=r=>l.printPDF())}," Print "),f("div",D,[b(e,{skill:a.skill},null,8,["skill"]),H,X,K])],64)}const Y=$(J,[["render",W],["__scopeId","data-v-e6e501f2"]]);const Q=f("div",{id:"purple-banner"},null,-1),Z=f("span",null,"Loading...",-1),se={__name:"RadialTreeView",setup(t){return(o,s)=>(m(),v(M,null,[Q,(m(),V(F,null,{default:w(()=>[b(Y)]),fallback:w(()=>[Z]),_:1}))],64))}};export{se as default};
