import{H as S,_ as g,l as p,i as v,I as b,o as a,c as o,d as n,m as _,t as u,e as w,b as h,a as y,w as A,F as M,p as N,f as q}from"./main-db0cf75b.js";import{u as f}from"./AssessmentsStore-88ed8ab4.js";import{u as x}from"./UsersStore-ceb71e47.js";import{u as I}from"./UserSkillsStore-5da02fe8.js";import{_ as U}from"./general-banner-1c13aca4.js";const C=S("unmarkedAnswers",{state:()=>({unmarkedAnswers:[]}),actions:{async getUnmarkedAnswers(){const s=await(await fetch("/unmarked-answers/list")).json(),m=await(await fetch("/questions/essay/list")).json();for(let r=0;r<s.length;r++)for(let i=0;i<m.length;i++)s[r].question_id==m[i].id&&(s[r].question=m[i].question);const l=await(await fetch("/assessments/list")).json();for(let r=0;r<s.length;r++)for(let i=0;i<l.length;i++)s[r].assessment_id==l[i].id&&(s[r].studentId=l[i].student_id,s[r].skillId=l[i].skill_id);return this.unmarkedAnswers=s,this.$state},async deleteUnmarkedAnswer(e){const s=await fetch("/unmarked-answers/"+e.id,{method:"DELETE"});await(await fetch("/unmarked-answers/list/"+e.assessment_id)).json()==0&&f().deleteAssessment(e.assessment_id),s.error&&console.log(s.error),this.getUnmarkedAnswers()}}});const j={setup(){const e=C(),s=f(),t=x(),m=p(),d=I();return{unmarkedAnswersStore:e,usersStore:t,skillsStore:m,assessmentsStore:s,userSkillsStore:d}},data(){return{assessmentId:this.$route.params.id,questionNumber:0,answers:[],assessment:{},skill:{},studentName:"",skillName:"",showModal:!1,modalMessage:"",isFailed:!1}},async created(){this.unmarkedAnswersStore.unmarkedAnswers.length==0&&await this.unmarkedAnswersStore.getUnmarkedAnswers(),this.assessmentsStore.assessments.length==0&&await this.assessmentsStore.getAssessments();for(let e=0;e<this.unmarkedAnswersStore.unmarkedAnswers.length;e++)this.unmarkedAnswersStore.unmarkedAnswers[e].assessment_id==this.assessmentId&&this.answers.push(this.unmarkedAnswersStore.unmarkedAnswers[e]);for(let e=0;e<this.assessmentsStore.assessments.length;e++)this.assessmentsStore.assessments[e].id==this.assessmentId&&(this.assessment=this.assessmentsStore.assessments[e]);this.usersStore.users.length==0&&await this.usersStore.getUsers();for(let e=0;e<this.answers.length;e++)for(let s=0;s<this.usersStore.users.length;s++)this.answers[e].studentId==this.usersStore.users[s].id&&(this.answers[e].studentUsername=this.usersStore.users[s].username,this.studentName=this.usersStore.users[s].username);this.skillsStore.skillsList.length==0&&await this.skillsStore.getSkillsList();for(let e=0;e<this.answers.length;e++)for(let s=0;s<this.skillsStore.skillsList.length;s++)this.answers[e].skillId==this.skillsStore.skillsList[s].id&&(this.answers[e].skillName=this.skillsStore.skillsList[s].name,this.skill=this.skillsStore.skillsList[s],this.skillName=this.skillsStore.skillsList[s].name)},computed:{},methods:{Next(){this.questionNumber++},Previous(){this.questionNumber--},async MarkCorrect(e){var s="/assessments/"+e.assessment_id+"/increase-grade";await fetch(s,{method:"PUT",headers:{"Content-Type":"content/type"},body:{}}),await this.assessmentsStore.getAssessments();for(let t=0;t<this.assessmentsStore.assessments.length;t++)this.assessmentsStore.assessments[t].id==e.assessment_id&&(this.assessment=this.assessmentsStore.assessments[t],this.assessmentsStore.assessments[t].num_unmarked_questions_remaining==0&&(this.assessmentsStore.assessments[t].current_score/this.assessmentsStore.assessments[t].total_score*100>=90?(this.MakeMastered(this.assessmentsStore.assessments[t].student_id,this.skill),this.modalMessage="Student passed",this.showModal=!0,this.isFailed=!1):(this.modalMessage="Student failed",this.showModal=!0,this.isFailed=!0)));this.unmarkedAnswersStore.deleteUnmarkedAnswer(e),this.answers.splice(this.questionNumber,1)},async MarkIncorrect(e){var s="/assessments/"+e.assessment_id+"/decrease-grade";fetch(s,{method:"PUT",headers:{"Content-Type":"content/type"},body:{}}),await this.assessmentsStore.getAssessments();for(let t=0;t<this.assessmentsStore.assessments.length;t++)this.assessmentsStore.assessments[t].id==e.assessment_id&&this.assessmentsStore.assessments[t].num_unmarked_questions_remaining==0&&this.assessmentsStore.assessments[t].current_score/this.assessmentsStore.assessments[t].total_score*100<90&&(this.modalMessage="Student failed",this.isFailed=!0,this.showModal=!0);this.unmarkedAnswersStore.deleteUnmarkedAnswer(e),this.answers.splice(this.questionNumber,1)},async MakeMastered(e,s){await this.userSkillsStore.MakeMastered(e,s)}}},k=e=>(N("data-v-9a5d9089"),e=e(),q(),e),L=k(()=>n("div",{id:"banner"},[n("img",{src:U,class:"img-fluid"})],-1)),T={class:"container mt-3 pb-4"},F=k(()=>n("div",{id:"page-tile"},"Unmarked Essay Questions",-1)),V={id:"assessment-info"},E={id:"date"},P={key:0},D={id:"question-bg"},H={class:"d-flex w-100 flex-row justify-content-end"},B={title:"The student needs to get at least 90% to pass",id:"score-text",class:"me-2"},O={title:"current score",id:"current-score"},$={title:"total score",id:"total-score"},K={id:"question",class:"mb-3"},Q=["innerHTML"],z={key:1,class:"d-flex flex-column"},G=k(()=>n("p",null,"No unmarked questions currently",-1)),J={key:0},R={key:1},W={key:2,class:"d-flex mt-3 mb-2"},X={class:"d-flex w-100 justify-content-lg-center gap-2"},Y={key:0,class:"d-flex justify-content-end"},Z={key:0},ss={id:"myModal",class:"modal"},es={class:"modal-content"},ts={class:"modal-message"},ns={style:{display:"flex",gap:"10px"}};function is(e,s,t,m,d,l){const r=v("router-link"),i=b("b-tooltip");return a(),o(M,null,[L,n("div",T,[F,n("div",V,[_(u(this.studentName)+" : "+u(this.skillName)+" ",1),n("span",E,u(this.assessment.date),1)]),this.answers.length>0?(a(),o("div",P,[n("div",D,[n("div",H,[w((a(),o("span",B,[_(" score: ")])),[[i,void 0,void 0,{hover:!0}]]),w((a(),o("span",O,[_(u(this.assessment.current_score)+" / ",1)])),[[i,void 0,void 0,{hover:!0}]]),n("span",$,u(this.assessment.total_score),1)]),n("div",K,u(this.answers[this.questionNumber].question),1),n("div",{id:"answer",class:"mb-3",innerHTML:this.answers[this.questionNumber].answer},null,8,Q)])])):(a(),o("div",z,[G,d.isFailed?(a(),o("p",J,"Student has failed")):(a(),o("p",R,"Student has passed and mastered this skill"))])),this.answers.length>0?(a(),o("div",W,[n("div",X,[n("button",{onClick:s[0]||(s[0]=c=>l.MarkCorrect(this.answers[this.questionNumber])),class:"btn green-btn"}," Mark Correct "),n("button",{onClick:s[1]||(s[1]=c=>l.MarkIncorrect(this.answers[this.questionNumber])),class:"btn red-btn"}," Mark Incorrect ")]),this.answers.length>0?(a(),o("div",Y,[this.questionNumber>0?(a(),o("button",{key:0,onClick:s[2]||(s[2]=c=>l.Previous()),class:"btn green-btn me-2"}," Previous ")):h("",!0),this.questionNumber!=this.answers.length-1?(a(),o("button",{key:1,onClick:s[3]||(s[3]=c=>l.Next()),class:"btn green-btn"}," Next ")):h("",!0)])):h("",!0)])):h("",!0)]),d.showModal?(a(),o("div",Z,[n("div",ss,[n("div",es,[n("p",ts,u(d.modalMessage),1),n("div",ns,[y(r,{class:"btn green-btn",to:"/"},{default:A(()=>[_("To Hub")]),_:1}),n("button",{class:"btn purple-btn",onClick:s[4]||(s[4]=c=>d.showModal=!1)}," OK ")])])])])):h("",!0)],64)}const ms=g(j,[["render",is],["__scopeId","data-v-9a5d9089"]]);export{ms as default};
