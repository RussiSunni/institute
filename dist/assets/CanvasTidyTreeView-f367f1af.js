import{_ as y,u as g,r as S,o as x,c as v,a as m,p as w,d as C,b as c,e as I,f as p,g as T,F as P}from"./main-f8eb89f2.js";import{u as b}from"./SkillTreeStore-b0a33108.js";import{S as B}from"./SkillPanel-84c7a25e.js";import"./transform-9f729428.js";import{s as E,z as N}from"./zoom-a02f6448.js";import{h as D}from"./index-0536990b.js";import{a as L}from"./ascending-3ff63084.js";import{t as z}from"./tree-6e85cfa8.js";import{a as $}from"./link-afe1ff0a.js";const A={setup(){const e=g(),t=b();return{userDetailsStore:e,skillTreeStore:t}},data(){return{width:6e3,height:null,skill:{id:null,children:[],isMastered:null,isUnlocked:null,container:null,name:null,description:null,tagIDs:[],sprite:null},tree:{},root:{},context:{},hiddenCanvasContext:{},panX:5,panY:0,scale:.5,translatePos:{x:50,y:50},scaleMultiplier:.8,startDragOffset:{x:0,y:0},mouseDown:!1,r:1.5,nodes:[],nextCol:1,colToNode:{},isSkillInfoPanelShown:!1,firstRender:!0}},components:{SkillPanel:B},async mounted(){this.skillTreeStore.userSkills.length==0&&await this.skillTreeStore.getUserSkills(),this.height=window.innerHeight;let e=document.getElementById("canvas");this.context=e.getContext("2d"),this.skill={name:"SKILLS",sprite:null,children:this.skillTreeStore.userSkills},this.getAlgorithm(),E(this.context.canvas).call(N().scaleExtent([.2,8]).on("zoom",({transform:s})=>this.zoomed(s)));let t=document.getElementById("hidden-canvas");this.hiddenCanvasContext=t.getContext("2d"),t.style.display="none",e.addEventListener("click",s=>{this.drawTree(!0),this.nodes;var d=s.layerX,h=s.layerY,a=this.hiddenCanvasContext,l=a.getImageData(d,h,1,1).data,r="rgb("+l[0]+","+l[1]+","+l[2]+")",i=this.colToNode[r];i&&(i.renderCol=i.__pickColor,this.skill.name=i.data.skill_name,this.showInfoPanel())})},methods:{getAlgorithm(){var e=[];e=JSON.parse(JSON.stringify(this.skill.children));function t(i){for(var n=i.length;n--;){if(i[n].type=="super"&&i[n].position!="end"){var _=[],f=[];for(let o=0;o<i[n].children.length;o++)i[n].children[o].type=="sub"?_.push(i[n].children[o]):f.push(i[n].children[o]);var k={skill_name:i[n].skill_name,type:"super",position:"end",children:_};i[n].children=[],i[n].children.push(k);for(let o=0;o<f.length;o++)i[n].children.push(f[o])}typeof i[n]<"u"&&i[n].children&&Array.isArray(i[n].children)&&i[n].children.length>0&&t(i[n].children)}}t(e);var s={skill_name:"My skills",children:e};this.root=D(s);const d=24,h=this.width/(this.root.height+1);this.tree=z().nodeSize([d,h]),this.root.sort((i,n)=>L(i.data.name,n.data.name)),this.tree(this.root);let a=1/0,l=-a;this.root.each(i=>{i.x>l&&(l=i.x),i.x<a&&(a=i.x)});var r=document.getElementById("canvas");r.width=this.width,r.height=this.height,this.context=r.getContext("2d"),this.drawTree(!1)},drawTree(e){if(this.nodes=this.root.descendants(),!e){const t=this.root.links();this.context.beginPath();for(const s of t)this.drawLink(s)}this.context.beginPath();for(const t of this.nodes)t.renderCol?this.context.fillStyle=t.renderCol:this.context.fillStyle="RGBA(105, 105, 105, 0.8)",e&&(t.__pickColor===void 0&&(t.__pickColor=this.genColor(),this.colToNode[t.__pickColor]=t),this.hiddenCanvasContext.fillStyle=t.__pickColor),this.drawNode(e,t)},drawNode(e,t){let s;e?s=this.hiddenCanvasContext:s=this.context,s.beginPath(),s.moveTo(t.y,t.x),s.arc(t.y,t.x,10,0,2*Math.PI),e||(s.fillStyle="#000"),s.fill(),s.beginPath(),s.strokeStyle="#FFF",s.lineWidth=4,s.strokeText(t.data.skill_name,t.y+10,t.x+2),s.fillStyle="#000",s.fillText(t.data.skill_name,t.y+10,t.x+2)},drawLink(e){const t=$().x(s=>s.y).y(s=>s.x).context(this.context);e.target.data.is_mastered==1?this.context.lineWidth=4:this.context.lineWidth=1,e.source.data.type=="super"&&e.target.data.position=="end"||e.target.data.type=="sub"?this.context.setLineDash([5,3]):this.context.setLineDash([]),this.context.beginPath(),t(e),this.context.strokeStyle="#000",this.context.stroke()},genColor(){var e=[];this.nextCol<16777215&&(e.push(this.nextCol&255),e.push((this.nextCol&65280)>>8),e.push((this.nextCol&16711680)>>16),this.nextCol+=100);var t="rgb("+e.join(",")+")";return t},showInfoPanel(){this.isSkillInfoPanelShown||(this.isSkillInfoPanelShown=!0,screen.width>800?document.getElementById("skillInfoPanel").style.width="474px":document.getElementById("skillInfoPanel").style.height="474px")},hideInfoPanel(){this.isSkillInfoPanelShown&&(screen.width>800?document.getElementById("skillInfoPanel").style.width="0px":document.getElementById("skillInfoPanel").style.height="0px",document.getElementById("sidepanel-backdrop").style.display="none",this.isSkillInfoPanelShown=!1)},zoomed(e){this.context.save(),this.context.clearRect(0,0,this.context.canvas.width,this.context.canvas.height),this.context.translate(e.x,e.y),this.context.scale(e.k,e.k),this.drawTree(!1),this.context.fill(),this.context.restore(),this.hiddenCanvasContext.save(),this.hiddenCanvasContext.clearRect(0,0,this.hiddenCanvasContext.canvas.width,this.hiddenCanvasContext.canvas.height),this.hiddenCanvasContext.translate(e.x,e.y),this.hiddenCanvasContext.scale(e.k,e.k),this.drawTree(!0),this.hiddenCanvasContext.fill(),this.hiddenCanvasContext.restore()}}},u=e=>(w("data-v-f47ef516"),e=e(),C(),e),F={id:"wrapper"},M=u(()=>c("canvas",{id:"canvas",width:"1500",height:"1500"},null,-1)),R=u(()=>c("canvas",{id:"hidden-canvas",width:"1500",height:"1500"},null,-1)),V=u(()=>c("div",{id:"sidepanel-backdrop"},null,-1));function W(e,t,s,d,h,a){const l=S("SkillPanel");return x(),v("div",F,[m(l,{skill:h.skill},null,8,["skill"]),M,R,V])}const j=y(A,[["render",W],["__scopeId","data-v-f47ef516"]]);const O=c("div",{id:"purple-banner"},null,-1),U=c("span",null,"Loading...",-1),ee={__name:"CanvasTidyTreeView",setup(e){return(t,s)=>(x(),v(P,null,[O,(x(),I(T,null,{default:p(()=>[m(j)]),fallback:p(()=>[U]),_:1}))],64))}};export{ee as default};
