import{S as k,j as R,k as A,_ as j,u as q,l as C,m as E,A as g,n as _,q as M,s as o,C as v,B as S,T as U,x as O,G as I,y as G,e as V,o as y,c as P,a as x,h as T,F as N,p as F,b as W,f as J,g as b,z as D}from"./main-9fcd655c.js";function $(t){return typeof t=="string"?new k([[document.querySelector(t)]],[document.documentElement]):new k([[t]],R)}function H(t){return $(A(t).call(document.documentElement))}const X={setup(){const t=q(),i=C();return{userDetailsStore:t,skillTreeStore:i}},data(){return{width:null,height:null,skill:{id:null,children:[],isMastered:null,isUnlocked:null,name:null},tree:{},root:{},isSkillInfoPanelShown:!1,dx:null,dy:null,data:{},radius:0,radiusMultiplier:256,firstLevelNodeSize:400,secondLevelNodeSize:100,regularNodeSize:50,subSkillRadius:50,sprite:{domainNode:null},nodes:null}},components:{SkillPanel:E},created(){this.$pixiApp.start()},async mounted(){this.skillTreeStore.userSkillsSubSkillsSeparate.length==0&&await this.skillTreeStore.getUserSkillsSubSkillsSeparate();const t=await g.load("/images/skill-tree-nodes/sprite-sheet/spritesheet.json");await g.load("/font/Poppins Bold White.xml"),this.$radialTreeContainer.children.length==0&&(this.width=window.innerWidth,this.height=window.innerHeight,this.radius=Math.min(this.width,this.height)/2-30,this.skill={name:"SKILLS",sprite:null,children:this.skillTreeStore.userSkillsSubSkillsSeparate},this.getAlgorithm(t)),document.querySelector("#skilltree").appendChild(this.$pixiApp.view)},methods:{getAlgorithm(t){var i=[];i=JSON.parse(JSON.stringify(this.skill.children)),this.data={skill_name:"My skills",children:i};const c=_().size([2*Math.PI,this.radius*this.radiusMultiplier]).separation((a,l)=>(a.parent==l.parent?1:2)/a.depth);this.root=c(M(this.data)),this.drawTree(t)},drawTree(t){const i=new o(t.textures[0]);console.log(t),i.x=this.root.x,i.y=this.root.y,i.anchor.set(.5);const c=this.root.descendants(),a=this.root.links();this.drawCircle(this.root);for(const l of a)this.drawLink(l);this.$radialTreeContainer.addChild(i);for(const l of c)this.drawNode(l,t)},drawNode(t,i){let c=new v;c.x=Math.cos(t.x)*t.y,c.y=Math.sin(t.x)*t.y,this.$radialTreeContainer.addChild(c);var a=new o;if(t.data.level=="grade_school"?t.data.is_mastered?a=new o(i.textures[9]):t.data.is_accessible?a=new o(i.textures[13]):a=new o(i.textures[8]):t.data.level=="middle_school"?t.data.is_mastered?a=new o(i.textures[21]):t.data.is_accessible?a=new o(i.textures[25]):a=new o(i.textures[20]):t.data.level=="high_school"?t.data.is_mastered?a=new o(i.textures[15]):t.data.is_accessible?a=new o(i.textures[25]):a=new o(i.textures[20]):t.data.level=="college"?t.data.is_mastered?a=new o(i.textures[2]):t.data.is_accessible?a=new o(i.textures[25]):a=new o(i.textures[20]):t.data.level=="phd"?t.data.is_mastered?a=new o(i.textures[27]):t.data.is_accessible?a=new o(i.textures[25]):a=new o(i.textures[20]):t.data.level=="domain"&&(a=new o(i.textures[7])),a.anchor.set(.5),t.depth==1?(a.width=this.firstLevelNodeSize,a.height=this.firstLevelNodeSize):t.depth==2?(a.width=this.secondLevelNodeSize,a.height=this.secondLevelNodeSize):(a.width=this.regularNodeSize,a.height=this.regularNodeSize),c.addChild(a),a.eventMode="static",a.cursor="pointer",a.on("pointerdown",s=>{var r={id:t.data.id,isMastered:t.data.is_mastered,isUnlocked:t.data.is_accessible,name:t.data.skill_name,masteryRequirements:t.data.mastery_requirements,type:t.data.type};this.skill=r,this.isSkillInfoPanelShown||this.showInfoPanel()}),t.data.subskills)for(let s=0;s<t.data.subskills.length;s++){let r=new v,f=360/t.data.subskills.length*s,w=f*Math.PI/180,B=this.subSkillRadius*Math.cos(w),L=this.subSkillRadius*Math.sin(w);r.x=B,r.y=L;var a=new o;t.data.level=="grade_school"?t.data.is_mastered?a=new o(i.textures[11]):t.data.is_accessible?a=new o(i.textures[12]):a=new o(i.textures[10]):t.data.level=="middle_school"?t.data.is_mastered?a=new o(i.textures[23]):t.data.is_accessible?a=new o(i.textures[24]):a=new o(i.textures[22]):t.data.level=="high_school"?t.data.is_mastered?a=new o(i.textures[17]):t.data.is_accessible?a=new o(i.textures[18]):a=new o(i.textures[16]):t.data.level=="college"?t.data.is_mastered?a=new o(i.textures[4]):t.data.is_accessible?a=new o(i.textures[5]):a=new o(i.textures[3]):t.data.level=="phd"&&(t.data.is_mastered?a=new o(i.textures[29]):t.data.is_accessible?a=new o(i.textures[30]):a=new o(i.textures[28])),a.width=15,a.height=15,a.anchor.set(.5),a.eventMode="static",a.cursor="pointer",a.on("pointerdown",ie=>{var z={id:t.data.subskills[s].id,isMastered:t.data.subskills[s].is_mastered,isUnlocked:t.data.subskills[s].is_accessible,name:t.data.subskills[s].skill_name,masteryRequirements:t.data.subskills[s].mastery_requirements,type:t.data.subskills[s].type};this.skill=z,this.isSkillInfoPanelShown||this.showInfoPanel()}),r.addChild(a);const m=new S(t.data.skill_name,{fontName:"Poppins-White-Bold",fontSize:10,align:"right"});m.angle=f,r.addChild(m),c.addChild(r)}let l,n;t.depth==0?(l=200,n="#000000"):t.depth==1?(l=150,n="#ffffff"):(l=120,n="#ffffff");const d=new U({fontFamily:"Poppins900",fontSize:l,fill:n,align:"center",strokeThickness:6,stroke:"black"});if(t.depth==0){const s=new O(t.data.skill_name,d);s.anchor.set(.5,.5),s.scale.set(.5,.5),c.addChild(s);return}const e=new S(t.data.skill_name,{fontName:"Poppins-White-Bold",fontSize:l,align:"right"});t.depth==0||t.depth==1?e.anchor.set(.5,.5):t.depth==2?(e.angle=t.x*180/Math.PI-90,c.x>0?(e.angle=e.angle+90,t.children?(e.anchor.set(1,.5),e.x=e.x-80*Math.cos(e.rotation),e.y=e.y-80*Math.sin(e.rotation),e.x=e.x-20*Math.cos(e.rotation+Math.PI/2),e.y=e.y-20*Math.sin(e.rotation+Math.PI/2)):(e.anchor.set(0,.5),e.x=e.x+80*Math.cos(e.rotation),e.y=e.y+80*Math.sin(e.rotation),e.x=e.x-20*Math.cos(e.rotation+Math.PI/2),e.y=e.y-20*Math.sin(e.rotation+Math.PI/2))):(e.anchor.set(0,.5),e.angle=e.angle-90,t.children?(e.x=e.x+80*Math.cos(e.rotation),e.y=e.y+80*Math.sin(e.rotation),e.x=e.x-20*Math.cos(e.rotation+Math.PI/2),e.y=e.y-20*Math.sin(e.rotation+Math.PI/2)):(e.anchor.set(1,.5),e.x=e.x-80*Math.cos(e.rotation),e.y=e.y-80*Math.sin(e.rotation),e.x=e.x+20*Math.cos(e.rotation+Math.PI/2),e.y=e.y+20*Math.sin(e.rotation+Math.PI/2)))):t.depth>2&&(e.angle=t.x*180/Math.PI-90,c.x>0?(e.angle=e.angle+90,t.children?(e.anchor.set(1,.5),e.x=e.x-50*Math.cos(e.rotation),e.y=e.y-50*Math.sin(e.rotation),e.x=e.x+20*Math.cos(e.rotation+Math.PI/2),e.y=e.y-20*Math.sin(e.rotation+Math.PI/2)):(e.anchor.set(0,.5),e.x=e.x+50*Math.cos(e.rotation),e.y=e.y+50*Math.sin(e.rotation),e.x=e.x-20*Math.cos(e.rotation+Math.PI/2),e.y=e.y-20*Math.sin(e.rotation+Math.PI/2))):(e.anchor.set(0,.5),e.angle=e.angle-90,t.children?(e.x=e.x+50*Math.cos(e.rotation),e.y=e.y+50*Math.sin(e.rotation),e.x=e.x-20*Math.cos(e.rotation+Math.PI/2),e.y=e.y-20*Math.sin(e.rotation+Math.PI/2)):(e.anchor.set(1,.5),e.x=e.x-50*Math.cos(e.rotation),e.y=e.y-50*Math.sin(e.rotation),e.x=e.x-20*Math.cos(e.rotation+Math.PI/2),e.y=e.y-20*Math.sin(e.rotation+Math.PI/2)))),e.scale.set(.5,.5),c.addChild(e)},drawLink(t){const i=new I;let c=0,a=7434618;t.target.data.is_mastered=="1"?(c=23,a=16777215):c=15,i.lineStyle(c,a,.85);var l=Math.cos(t.source.x)*t.source.y,n=Math.sin(t.source.x)*t.source.y;i.moveTo(l,n);var d=Math.cos(t.target.x)*t.target.y,e=Math.sin(t.target.x)*t.target.y;let s,r,h,u;const f=Math.abs(e)/Math.sqrt(e*e+d*d)*(180/Math.PI);l===0?(s=l,r=4500,h=d-800,u=e*h/d,f>45&&f<90&&(e<0?(u=e+1500,h=u*d/e):(u=e-1500,h=u*d/e))):l>0?(s=l+1500,r=n*s/l,h=d-2e3,d<0&&(h=d+2e3),u=e*h/d,f>45&&f<90&&(e<0?(r=n-1500,s=r*l/n,u=e+2e3,e>0&&(e=e-2e3),h=u*d/e):(r=n+1500,s=r*l/n,u=e-2e3,e<0&&(e=e+2e3),h=u*d/e))):(s=l-1500,r=n*s/l,h=d+2e3,d>0&&(h=d-2e3),u=e*h/d,f>45&&f<90&&(e<0?(r=n-1500,s=r*l/n,u=e+2e3,e>0&&(e=e-2e3),h=u*d/e):(r=n+1500,s=r*l/n,u=e-2e3,e<0&&(e=e+2e3),h=u*d/e))),i.bezierCurveTo(s,r,h,u,d,e),this.$radialTreeContainer.addChild(i)},drawCircle(t){let i=t;const c=i.children.find(l=>l.children),a=Math.sqrt((c.x-t.x)*(c.x-t.x)+(c.y-t.y)*(c.y-t.y));for(let l=0;l<t.height;l++){const n=new I;n.lineStyle(30,3359061,.9),n.drawCircle(0,0,a*(l+1)),n.endFill(),i=c,this.$radialTreeContainer.addChild(n)}},showInfoPanel(){this.isSkillInfoPanelShown||(this.isSkillInfoPanelShown=!0,screen.width>800?document.getElementById("skillInfoPanel").style.width="474px":document.getElementById("skillInfoPanel").style.height="474px",this.skill.isMastered=="1"?document.getElementById("mastery-checkbox").checked=!0:document.getElementById("mastery-checkbox").checked=!1)},hideInfoPanel(){this.isSkillInfoPanelShown&&(screen.width>800?document.getElementById("skillInfoPanel").style.width="0px":document.getElementById("skillInfoPanel").style.height="0px",document.getElementById("sidepanel-backdrop").style.display="none",this.isSkillInfoPanelShown=!1)},async printPDF(){await this.getPrintAlgorithm();var t=document.getElementById("radialTree"),i=$(t),c=i.node(),a=new XMLSerializer,l=a.serializeToString(c),n={svg:l,treeType:"radial"},d=JSON.stringify(n),e=new XMLHttpRequest;e.responseType="arraybuffer",e.open("POST","/skilltree/print-pdf",!0),e.setRequestHeader("Content-type","application/json;charset=UTF-8"),e.setRequestHeader("Accept","application/json, text/plain, */*"),e.send(d),e.onload=function(){if(this.readyState==4&&this.status==200){let r=new Blob([e.response],{type:"application/pdf"});const h=window.URL.createObjectURL(r);var s=document.createElement("a");document.body.appendChild(s),s.style="display: none",s.href=h,s.download="My-Skill-Tree.pdf",s.click(),window.URL.revokeObjectURL(h)}}},async getPrintAlgorithm(){await this.skillTreeStore.getUserSkills();const t={name:"SKILLS",sprite:null,children:this.skillTreeStore.userSkills};var i=[];i=JSON.parse(JSON.stringify(t.children));function c(l){for(var n=l.length;n--;){if(l[n].type=="super"&&l[n].position!="end"){var d=[],e=[];for(let r=0;r<l[n].children.length;r++)l[n].children[r].type=="sub"?d.push(l[n].children[r]):e.push(l[n].children[r]);var s={skill_name:l[n].skill_name,type:"super",position:"end",children:d};l[n].children=[],l[n].children.push(s);for(let r=0;r<e.length;r++)l[n].children.push(e[r])}typeof l[n]<"u"&&l[n].children&&Array.isArray(l[n].children)&&l[n].children.length>0&&c(l[n].children)}}c(i);const a={skill_name:"My skills",children:i};await this.createSVGTree(a)},async createSVGTree(t){const a=13200.000000000002,l=24e3*.59,d=_().size([2*Math.PI,this.radius*50]).separation((s,r)=>(s.parent==r.parent?1:2)/s.depth)(M(t));let e=H("svg").attr("id","radialTree").attr("width",24e3).attr("height",24e3).attr("viewBox",[-a,-l,24e3,24e3]).attr("style","max-width: 100%; height: auto; font: 10px sans-serif;");e.append("g").attr("fill","none").attr("stroke-opacity",1).selectAll().data(d.links()).join("path").attr("d",G().angle(s=>s.x).radius(s=>s.y)).attr("stroke",function(s){return"#000"}).attr("stroke-width",function(s){return s.target.data.is_mastered==1?4:1.5}).style("stroke-dasharray",function(s){if(s.source.data.type=="super"&&s.target.data.position=="end"||s.target.data.type=="sub")return 5}),e.append("g").selectAll().data(d.descendants()).join("circle").attr("transform",s=>`rotate(${s.x*180/Math.PI-90}) translate(${s.y},0)`).attr("fill","#000").attr("r",2.5),e.append("g").attr("stroke-linejoin","round").attr("stroke-width",1).selectAll().data(d.descendants()).join("text").attr("transform",s=>`rotate(${s.x*180/Math.PI-90}) translate(${s.y},0) rotate(${s.x>=Math.PI?180:0})`).attr("dy","0.31em").attr("x",s=>s.x<Math.PI==!s.children?6:-6).attr("text-anchor",s=>s.x<Math.PI==!s.children?"start":"end").style("font-weight",function(s){return s.data.type=="super"?"700":"400"}).style("font-style",function(s){if(s.data.type=="sub")return"italic"}).style("paint-order",function(s){return"stroke"}).clone(!0).lower().style("stroke-width",function(s){return"1px"}).text(function(s){return s.data.position=="end"?"":s.data.skill_name}),document.querySelector("#SVGskilltree").append(e.node())}}},p=t=>(F("data-v-36efc57d"),t=t(),W(),t),K={id:"wrapper"},Y=p(()=>x("div",{id:"skilltree"},null,-1)),Q=p(()=>x("div",{id:"SVGskilltree"},null,-1)),Z=p(()=>x("div",{id:"sidepanel-backdrop"},null,-1));function ee(t,i,c,a,l,n){const d=V("SkillPanel");return y(),P(N,null,[x("button",{id:"print-btn",class:"btn btn-info",onClick:i[0]||(i[0]=e=>n.printPDF())}," Print "),x("div",K,[T(d,{skill:l.skill},null,8,["skill"]),Y,Q,Z])],64)}const te=j(X,[["render",ee],["__scopeId","data-v-36efc57d"]]);const se=x("div",{id:"purple-banner"},null,-1),ae=x("span",null,"Loading...",-1),ne={__name:"RadialTreeView",setup(t){return(i,c)=>(y(),P(N,null,[se,(y(),J(D,null,{default:b(()=>[T(te)]),fallback:b(()=>[ae]),_:1}))],64))}};export{ne as default};
