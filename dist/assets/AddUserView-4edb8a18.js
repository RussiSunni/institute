import{_ as h,k as c,o as u,c as d,a as s,w as o,l as m,C as f,j as _}from"./main-a5fbf41d.js";import{u as p}from"./SkillsStore-3c0d2c18.js";import{u as v}from"./UsersStore-6bf10bae.js";const k={setup(){const t=p(),e=v();return{skillsStore:t,usersStore:e}},data(){return{user:{},image:"",firstLevelSkillIds:[],childrenOfFirstLevelSkillsIds:[],newUserId:null,isValidated:!1}},async created(){this.skillsStore.skillsList.length<1&&await this.skillsStore.getSkillsList();for(let t=0;t<this.skillsStore.skillsList.length;t++)this.skillsStore.skillsList[t].hierarchy_level==1&&this.firstLevelSkillIds.push(this.skillsStore.skillsList[t].id);for(let t=0;t<this.skillsStore.skillsList.length;t++)for(let e=0;e<this.firstLevelSkillIds.length;e++)this.skillsStore.skillsList[t].parent==this.firstLevelSkillIds[e]&&this.childrenOfFirstLevelSkillsIds.push(this.skillsStore.skillsList[t].id)},methods:{ValidateForm(){this.user.first_name==""||this.user.first_name==null?alert("Please add a first name."):this.user.last_name==""||this.user.last_name==null?alert("Please add a last name."):this.user.username==""||this.user.username==null?alert("Please add a username."):this.user.email==""||this.user.email==null?alert("Please add am email address."):this.Submit()},ValidateEmail(){/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/.test(this.user.email)||alert("Please enter a valid email address")},Submit(){const t={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({firstname:this.user.first_name,lastname:this.user.last_name,username:this.user.username,email:this.user.email,avatar:this.user.avatar,password:this.user.password,role:this.user.role})};var e="/users/add";fetch(e,t).then(function(r){return r.json()}).then(r=>{r.account=="username already taken"||r.account=="email already taken"?alert(r.account):(alert("account created"),this.usersStore.getUsers(),c.push({name:"users"}),this.isValidated=!0),this.newUserId=r.id}).then(r=>{if(this.isValidated)for(let l=0;l<this.firstLevelSkillIds.length;l++){var n="/user-skills/accessible/"+this.newUserId+"/"+this.firstLevelSkillIds[l];fetch(n)}})},onFileChange(t){var e=t.target.files||t.dataTransfer.files;e.length&&this.createImage(e[0])},createImage(t){new Image;var e=new FileReader,r=this;e.onload=n=>{r.image=n.target.result,this.image=n.target.result,this.user.avatar=this.image},e.readAsDataURL(t)},removeImage:function(t){this.image="",this.user.avatar=this.image}}},g={class:"container mt-3"},b=s("h1",null,"Add User",-1),S={class:"row"},w={class:"col-sm-4"},y={class:"mb-3"},L=s("label",{for:"first_name",class:"form-label"},"First Name",-1),I={class:"mb-3"},U=s("label",{for:"last_name",class:"form-label"},"Last Name",-1),V={class:"mb-3"},x=s("label",{class:"form-label"},"Username",-1),F={class:"mb-3"},C=s("label",{class:"form-label"},"Email address",-1),P={class:"mb-3 row"},A=s("label",{class:"form-label"},"Avatar",-1),B={key:0},E=s("p",{style:{"font-size":"14px"}},[s("em",null,"Maximum file size 15mb")],-1),O={key:1},j=["src"],N={class:"mb-3"},R=s("label",{class:"form-label"},"Role",-1),T=s("option",{value:"admin"},"admin",-1),M=s("option",{value:"parent"},"parent",-1),z=s("option",{value:"student"},"student",-1),D=[T,M,z],q={class:"mb-3"},J=s("label",{class:"form-label"},"Password",-1);function G(t,e,r,n,l,a){return u(),d("div",g,[b,s("div",S,[s("div",w,[s("div",y,[L,o(s("input",{"onUpdate:modelValue":e[0]||(e[0]=i=>l.user.first_name=i),type:"text",class:"form-control"},null,512),[[m,l.user.first_name]])]),s("div",I,[U,o(s("input",{"onUpdate:modelValue":e[1]||(e[1]=i=>l.user.last_name=i),type:"text",class:"form-control"},null,512),[[m,l.user.last_name]])]),s("div",V,[x,o(s("input",{"onUpdate:modelValue":e[2]||(e[2]=i=>l.user.username=i),type:"text",class:"form-control"},null,512),[[m,l.user.username]])]),s("div",F,[C,o(s("input",{"onUpdate:modelValue":e[3]||(e[3]=i=>l.user.email=i),type:"email",class:"form-control",onBlur:e[4]||(e[4]=(...i)=>a.ValidateEmail&&a.ValidateEmail(...i))},null,544),[[m,l.user.email]])]),s("div",P,[A,l.image?(u(),d("div",O,[s("p",null,[s("img",{src:l.image,height:"200",style:{"background-color":"lightgrey"}},null,8,j)]),s("p",null,[s("button",{class:"btn btn-warning",onClick:e[6]||(e[6]=(...i)=>a.removeImage&&a.removeImage(...i))},"Remove image")])])):(u(),d("div",B,[s("input",{class:"form-control",type:"file",accept:"image/*",onChange:e[5]||(e[5]=(...i)=>a.onFileChange&&a.onFileChange(...i))},null,32),E]))]),s("div",N,[R,o(s("select",{"onUpdate:modelValue":e[7]||(e[7]=i=>l.user.role=i),class:"form-select"},D,512),[[f,l.user.role]])]),s("div",q,[J,o(s("input",{"onUpdate:modelValue":e[8]||(e[8]=i=>l.user.password=i),type:"text",class:"form-control"},null,512),[[m,l.user.password]])]),s("button",{class:"btn btn-dark",onClick:e[9]||(e[9]=i=>a.ValidateForm())},"Submit")])])])}const H=h(k,[["render",G]]),X={__name:"AddUserView",setup(t){return(e,r)=>(u(),_(H))}};export{X as default};
