import{u as _}from"./UsersStore-43d9a394.js";import{u as p}from"./InstructorStudentsStore-01374655.js";import{_ as g,e as b,o as l,c as a,a as e,t as c,w as n,k as m,B as h,F as v,r as S,n as w,f as y,h as I,i as U,g as V}from"./main-762f2a6e.js";const k={setup(){const t=_(),s=p();return{usersStore:t,instructorStudentsStore:s}},data(){return{userId:this.$route.params.id,user:{},image:"",instructors:[],instructorId:null}},async mounted(){this.usersStore.users.length<1&&await this.usersStore.getUsers(),this.instructorStudentsStore.instructorStudentsList.length==0&&await this.instructorStudentsStore.getInstructorStudentsList(),this.getInstructors()},methods:{getUser(){fetch("/users/show/"+this.userId).then(function(t){return t.json()}).then(t=>this.user=t).then(()=>{this.image=this.user.avatar})},getInstructors(){for(let t=0;t<this.usersStore.users.length;t++)this.usersStore.users[t].role=="instructor"&&this.instructors.push(this.usersStore.users[t]);for(let t=0;t<this.instructorStudentsStore.instructorStudentsList.length;t++)this.instructorStudentsStore.instructorStudentsList[t].student_id==this.userId&&(this.instructorId=this.instructorStudentsStore.instructorStudentsList[t].instructor_id);this.getUser()},ValidateForm(){this.user.first_name==""||this.user.first_name==null?alert("Please add a first name."):this.user.last_name==""||this.user.last_name==null?alert("Please add a last name."):this.user.username==""||this.user.username==null?alert("Please add a username."):this.user.email==""||this.user.email==null?alert("Please add an email address."):this.Submit()},ValidateEmail(){/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/.test(this.user.email)||alert("Please enter a valid email address")},Submit(){const t={method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({firstname:this.user.first_name,lastname:this.user.last_name,username:this.user.username,email:this.user.email,avatar:this.user.avatar,role:this.user.role,password:this.user.password})};var s="/users/"+this.userId+"/edit";fetch(s,t).then(()=>{if(this.user.role=="student"){const d={method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({instructor_id:this.instructorId})};var u="/users/"+this.userId+"/edit/instructor";fetch(u,d)}}).then(()=>{this.$router.push("/users")})},onFileChange(t){var s=t.target.files||t.dataTransfer.files;s.length&&this.createImage(s[0])},createImage(t){new Image;var s=new FileReader,u=this;s.onload=d=>{u.image=d.target.result,this.image=d.target.result,this.user.avatar=this.image},s.readAsDataURL(t)},removeImage:function(t){this.image="",this.user.avatar=this.image}}},x={class:"container mt-3"},C=e("h1",null,"Edit User",-1),F={class:"mb-3"},E={for:"firstname",class:"form-label"},L={class:"mb-3"},P=e("label",{for:"lastname",class:"form-label"},"Last name",-1),N={class:"mb-3"},T=e("label",{class:"form-label"},"Username",-1),B={class:"mb-3"},j=e("label",{class:"form-label"},"Email address",-1),O={class:"mb-3 row"},R=e("label",{for:"avatar",class:"form-label"},"Avatar",-1),D={key:0},M=e("p",{style:{"font-size":"14px"}},[e("em",null,"Maximum file size 15mb")],-1),q={key:1},z=["src"],A={class:"mb-3"},J=e("label",{class:"form-label"},"Role",-1),G=e("option",{value:"admin"},"admin",-1),H=e("option",{value:"instructor"},"instructor",-1),K=e("option",{value:"student"},"student",-1),Q=[G,H,K],W={key:0,class:"mb-3"},X=e("label",{class:"form-label"},"Instructor",-1),Y=["value"],Z={class:"mb-3"},$=e("label",{class:"form-label"},"Password",-1),ee={class:"d-flex justify-content-between"};function se(t,s,u,d,i,o){const f=b("router-link");return l(),a("div",x,[C,e("div",F,[e("label",E,"First name "+c(t.firstName),1),n(e("input",{"onUpdate:modelValue":s[0]||(s[0]=r=>i.user.first_name=r),type:"text",class:"form-control"},null,512),[[m,i.user.first_name]])]),e("div",L,[P,n(e("input",{"onUpdate:modelValue":s[1]||(s[1]=r=>i.user.last_name=r),type:"text",class:"form-control"},null,512),[[m,i.user.last_name]])]),e("div",N,[T,n(e("input",{"onUpdate:modelValue":s[2]||(s[2]=r=>i.user.username=r),type:"text",class:"form-control"},null,512),[[m,i.user.username]])]),e("div",B,[j,n(e("input",{"onUpdate:modelValue":s[3]||(s[3]=r=>i.user.email=r),type:"email",class:"form-control",onBlur:s[4]||(s[4]=(...r)=>o.ValidateEmail&&o.ValidateEmail(...r))},null,544),[[m,i.user.email]])]),e("div",O,[R,i.image?(l(),a("div",q,[e("p",null,[e("img",{src:i.image,height:"200",style:{"background-color":"lightgrey"}},null,8,z)]),e("p",null,[e("button",{class:"btn btn-warning",onClick:s[6]||(s[6]=(...r)=>o.removeImage&&o.removeImage(...r))},"Remove image")])])):(l(),a("div",D,[e("input",{class:"form-control",type:"file",accept:"image/*",onChange:s[5]||(s[5]=(...r)=>o.onFileChange&&o.onFileChange(...r))},null,32),M]))]),e("div",A,[J,n(e("select",{"onUpdate:modelValue":s[7]||(s[7]=r=>i.user.role=r),class:"form-select"},Q,512),[[h,i.user.role]])]),i.user.role=="student"?(l(),a("div",W,[X,n(e("select",{"onUpdate:modelValue":s[8]||(s[8]=r=>i.instructorId=r),class:"form-select"},[(l(!0),a(v,null,S(i.instructors,r=>(l(),a("option",{value:r.id},c(r.username),9,Y))),256))],512),[[h,i.instructorId]])])):w("",!0),e("div",Z,[$,n(e("input",{"onUpdate:modelValue":s[9]||(s[9]=r=>i.user.password=r),type:"text",class:"form-control"},null,512),[[m,i.user.password]])]),e("div",ee,[y(f,{class:"btn btn-dark",to:"/users"},{default:I(()=>[U(" Cancel ")]),_:1}),e("button",{class:"btn btn-dark",onClick:s[10]||(s[10]=r=>o.ValidateForm())},"Submit")])])}const te=g(k,[["render",se]]),ne={__name:"EditUserView",setup(t){return(s,u)=>(l(),V(te))}};export{ne as default};
