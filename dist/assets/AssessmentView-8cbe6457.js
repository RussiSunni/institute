import{_ as k,u as p,E as _,o as l,c as r,a as n,t as c,F as f,r as y,w as m,R as S,v as g,d as a,e as Q,h as b}from"./main-57f5b5f9.js";import{u as v}from"./UserSkillsStore-8f7bdeb2.js";import{u as w}from"./SettingsStore-5b2a27ab.js";import{u as q}from"./SkillsStore-68f758ac.js";const I={setup(){const e=p(),s=v(),t=w(),h=q();return{userDetailsStore:e,userSkillsStore:s,settingsStore:t,skillsStore:h}},data(){return{skillId:this.$route.params.id,mcQuestions:[],essayQuestions:[],questions:[],question:{},questionNumber:0,score:0,assessmentId:null,numMCQuestions:0,numEssayQuestions:0,totalNumOfQuestions:0,isAllQuestionsAnswered:!1}},async created(){this.settingsStore.quizMaxQuestions==null&&await this.settingsStore.getSettings();let e;for(let s=0;s<this.skillsStore.skillsList.length;s++)this.skillsStore.skillsList[s].id==this.skillId&&(e=this.skillsStore.skillsList[s].type);if(e!="super")await this.fetchMCQuestions(this.skillId),await this.fetchEssayQuestions(this.skillId);else{let s=[];for(let t=0;t<this.skillsStore.skillsList.length;t++)this.skillsStore.skillsList[t].parent==this.skillId&&this.skillsStore.skillsList[t].type=="sub"&&s.push(this.skillsStore.skillsList[t]);for(let t=0;t<s.length;t++)await this.fetchMCQuestions(s[t].id),await this.fetchEssayQuestions(s[t].id)}},methods:{fetchMCQuestions(e){fetch("/questions/"+e+"/multiple-choice").then(function(s){return s.json()}).then(s=>{this.mcQuestions=this.mcQuestions.concat(s)}).then(()=>{for(let t=0;t<this.mcQuestions.length;t++)this.mcQuestions[t].userAnswer=null,this.mcQuestions[t].questionType="mc";for(let t=0;t<this.mcQuestions.length;t++){var s=[];s.push({option:this.mcQuestions[t].correct_answer,index:1}),s.push({option:this.mcQuestions[t].incorrect_answer_1,index:2}),s.push({option:this.mcQuestions[t].incorrect_answer_2,index:3}),s.push({option:this.mcQuestions[t].incorrect_answer_3,index:4}),s.push({option:this.mcQuestions[t].incorrect_answer_4,index:5}),s=s.sort((h,i)=>.5-Math.random()),this.mcQuestions[t].answerOptions=s}})},fetchEssayQuestions(e){fetch("/questions/"+e+"/essay").then(function(s){return s.json()}).then(s=>{this.essayQuestions=this.essayQuestions.concat(s)}).then(()=>{for(let s=0;s<this.essayQuestions.length;s++)this.essayQuestions[s].userAnswer=null,this.essayQuestions[s].questionType="essay"}).then(()=>{this.questions=this.essayQuestions.concat(this.mcQuestions),this.questions=this.questions.sort((s,t)=>.5-Math.random()),this.questions.length>this.settingsStore.quizMaxQuestions&&(this.questions.length=this.settingsStore.quizMaxQuestions),this.question=this.questions[0],this.totalNumOfQuestions=this.questions.length})},Next(){this.questionNumber++,this.question=this.questions[this.questionNumber]},Previous(){this.questionNumber--,this.question=this.questions[this.questionNumber]},Submit(){for(let s=0;s<this.questions.length;s++)this.questions[s].questionType=="mc"?(this.numMCQuestions++,this.questions[s].userAnswer==1&&this.score++):this.numEssayQuestions++;if(this.essayQuestions.length==0)this.score/this.numMCQuestions*100>=90?(this.MakeMastered(this.skillId),alert("Well done! You have now mastered this skill.")):alert("You failed");else{alert("There is at least one question that needs to be marked manually. Please check whether you passed later.");const s={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({totalScore:this.totalNumOfQuestions,currentScore:this.score,numUnmarkedQuestions:this.numEssayQuestions})};var e="/assessments/"+this.userDetailsStore.userId+"/"+this.skillId;fetch(e,s).then(function(t){return t.json()}).then(t=>{this.assessmentId=t.id,fetch("/unmarked-answers/delete/"+this.assessmentId,{method:"DELETE"}).then(()=>{for(let i=0;i<this.questions.length;i++)if(this.questions[i].questionType=="essay"){const u={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({answer:this.questions[i].userAnswer,questionId:this.questions[i].id})};var h="/unmarked-answers/add/"+this.assessmentId;fetch(h,u).then(function(o){_.push({name:"post-login"})})}})})}this.$router.push("/skills/"+this.skillId)},async MakeMastered(e){await this.userSkillsStore.MakeMastered(this.userDetailsStore.userId,e)},UserAnswer(){for(let e=0;e<this.questions.length;e++)if(this.questions[e].userAnswer==null){this.isAllQuestionsAnswered=!1;return}else this.isAllQuestionsAnswered=!0},TestPass(){this.MakeMastered(this.skillId)}}},A={key:0,class:"container mt-3 mb-3"},N={class:"row mt-3"},x={key:0},M={class:"form-check"},L=["value"],T={class:"form-check-label"},C={key:1},$={class:"form-group"},E={class:"mt-3 d-flex justify-content-end"},P={key:1};function U(e,s,t,h,i,u){return this.questions.length>0?(l(),r("div",A,[n("div",N,[n("h3",null," Question "+c(this.questionNumber+1)+": "+c(i.question.question),1),this.question.questionType=="mc"?(l(),r("div",x,[(l(!0),r(f,null,y(this.question.answerOptions,(o,R)=>(l(),r("div",M,[m(n("input",{onInput:s[0]||(s[0]=d=>u.UserAnswer()),class:"form-check-input",type:"radio",value:o.index,"onUpdate:modelValue":s[1]||(s[1]=d=>i.questions[this.questionNumber].userAnswer=d)},null,40,L),[[S,i.questions[this.questionNumber].userAnswer]]),n("label",T,c(o.option),1)]))),256))])):this.question.questionType=="essay"?(l(),r("div",C,[n("div",$,[m(n("textarea",{onInput:s[2]||(s[2]=o=>u.UserAnswer()),class:"form-control","onUpdate:modelValue":s[3]||(s[3]=o=>i.questions[this.questionNumber].userAnswer=o),rows:"3"},null,544),[[g,i.questions[this.questionNumber].userAnswer]])])])):a("",!0)]),n("div",E,[this.questionNumber>0?(l(),r("button",{key:0,onClick:s[4]||(s[4]=o=>u.Previous()),class:"btn green-btn me-2"}," Previous ")):a("",!0),this.questionNumber!=i.questions.length-1?(l(),r("button",{key:1,onClick:s[5]||(s[5]=o=>u.Next()),class:"btn green-btn"}," Next ")):a("",!0),this.questionNumber==i.questions.length-1?(l(),r("button",{key:2,onClick:s[6]||(s[6]=o=>u.Submit()),class:"btn green-btn"}," Submit ")):a("",!0)])])):(l(),r("div",P," There is no quiz for this skill yet. Please check again soon. "))}const D=k(I,[["render",U],["__scopeId","data-v-80dba6ee"]]),j={setup(){return{skillsStore:q()}},data(){return{skillId:this.$route.params.id,skill:{name:null,image:null,firstAncestorId:null,levelInHierarchy:null}}},async mounted(){this.skillsStore.skillsList.length==0&&await this.skillsStore.getSkillsList();for(let e=0;e<this.skillsStore.skillsList.length;e++)this.skillId==this.skillsStore.skillsList[e].id&&(this.skill.name=this.skillsStore.skillsList[e].name,this.skill.image=this.skillsStore.skillsList[e].image,this.skill.firstAncestorId=this.skillsStore.skillsList[e].first_ancestor,this.skill.levelInHierarchy=this.skillsStore.skillsList[e].hierarchy_level)},components:{Assessment:D}},V={id:"banner"},z=["src"],B={class:"container mt-3"},H={class:"d-flex"},O=["src"],F={class:"ms-3"};function J(e,s,t,h,i,u){const o=Q("Assessment");return l(),r(f,null,[n("div",V,[n("img",{src:"/images/banners/skills/"+this.skill.firstAncestorId+"/"+this.skill.levelInHierarchy+".png",class:"img-fluid"},null,8,z)]),n("div",B,[n("div",H,[n("img",{src:this.skill.image},null,8,O),n("h1",F,c(this.skill.name)+" Quiz",1)]),b(o)])],64)}const X=k(j,[["render",J]]);export{X as default};
